import{r as s,j as e,a as ms}from"./index-M4YNaQtK.js";import{f as zt,g as fs,a as Mt,b as cn,c as gs,W as hs,d as xs,e as ys,h as bs,i as vs,A as Ss,M as ks,H as js}from"./AudioMeterSidebar-DaB-wz6h.js";import{R as H,c as ws}from"./grpcStream-6CgmIi4o.js";const Cs=(h,S)=>{const v=Math.max(1,Math.min(2,h.numberOfChannels||1)),y=Array.from({length:v},()=>new Array(400).fill(0)),j=Array.from({length:v},()=>new Array(400).fill(0)),m=Array.from({length:v},()=>new Array(400).fill(0));let G=1e-9,te=1e-9;const M=h.duration/400;for(let z=0;z<v;z++){const B=h.getChannelData(z),Oe=Math.floor(B.length/400);for(let F=0;F<400;F++){const le=F*Oe,Se=Math.min(B.length,le+Oe);let de=0,We=0,ce=0;for(let Y=le;Y<Se;Y++){const c=Math.abs(B[Y]);c>de&&(de=c),We+=B[Y]*B[Y],ce++}const C=ce>0?Math.sqrt(We/ce):0;y[z][F]=de,j[z][F]=C,m[z][F]=C,de>G&&(G=de),C>te&&(te=C)}}const _e=G>0?G:1,x=te>0?te:1;return{peaks:y.map(z=>z.map(B=>B/_e)),rms:j.map(z=>z.map(B=>B/x)),rmsAbsolute:m,sampleDuration:M,duration:h.duration,sampleCount:400,channelCount:v}};var xr={};const ae=`http://localhost:${xr.AIWISPER_HTTP_PORT||18080}`,Ts=typeof window<"u"&&window.require?window.require("electron"):null,ve=Ts?.ipcRenderer,et=h=>{const S=Math.floor(h/60),b=Math.floor(h%60);return`${S.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`},It=h=>new Date(h).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),Dt=["#2196f3","#e91e63","#ff9800","#9c27b0","#00bcd4","#8bc34a"],Rs=h=>{if(h==="mic"||h==="–í—ã")return{name:"–í—ã",color:"#4caf50"};if(h?.startsWith("Speaker ")){const S=parseInt(h.replace("Speaker ",""),10);return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${S+1}`,color:Dt[S%Dt.length]}}else return h==="sys"?{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}:{name:h||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}},zs=h=>{const S=h.match(/sessions\/([a-f0-9\-]{36})/i);return S?S[1]:null},Ms=h=>{const S=b=>!Number.isFinite(b)||b<=0?0:b>1e11?b/1e9:b>1e6?b/1e3:b;if(typeof h=="number")return S(h);if(typeof h=="string"){const b=Number(h);if(!Number.isNaN(b))return S(b);const v=/(-?\d+(?:\.\d+)?)(ns|¬µs|us|ms|s|m|h)/g;let y,j=0;for(;(y=v.exec(h))!==null;){const m=Number(y[1]),G=y[2];if(!Number.isNaN(m))switch(G){case"ns":j+=m/1e9;break;case"¬µs":case"us":j+=m/1e6;break;case"ms":j+=m/1e3;break;case"s":j+=m;break;case"m":j+=m*60;break;case"h":j+=m*3600;break}}return j}return 0},Is=async()=>{try{const{ipcRenderer:h}=require("electron"),S=await h.invoke("open-data-folder");S.success||console.error("Failed to open data folder:",S.error)}catch(h){console.error("Failed to open data folder:",h)}},Ds=(h=800,S=150,b=.3)=>{try{const v=new(window.AudioContext||window.webkitAudioContext),y=v.createOscillator(),j=v.createGain();y.connect(j),j.connect(v.destination),y.frequency.value=h,y.type="sine",j.gain.setValueAtTime(b,v.currentTime),j.gain.exponentialRampToValueAtTime(.01,v.currentTime+S/1e3),y.start(v.currentTime),y.stop(v.currentTime+S/1e3)}catch(v){console.error("Failed to play beep:",v)}};function Os(){const[h,S]=s.useState([]),[b,v]=s.useState("Disconnected"),[y,j]=s.useState("ru"),m=s.useRef(null),[G,te]=s.useState(0),[M,_e]=s.useState(0),[x,z]=s.useState(!1),[B,Oe]=s.useState(0),[F,le]=s.useState(null),Se=s.useRef(null),[de,We]=s.useState(Array(24).fill(.3)),ce=s.useRef(null),[C,Y]=s.useState([]),[c,L]=s.useState(null),[ke,tt]=s.useState(new Set),[un,$t]=s.useState(!1),[Le,Ne]=s.useState([]),[pn,At]=s.useState([]),[mn,yr]=s.useState(!1),[fn,Pe]=s.useState(null),re=s.useRef(null),[gn,hn]=s.useState([]),[br,xn]=s.useState(""),[ue,Et]=s.useState(!0),[rt,vr]=s.useState("auto"),[nt,Sr]=s.useState("auto"),[_t,yn]=s.useState(!1),[bn,Ot]=s.useState(!1),[st,kr]=s.useState(.4),[Be,jr]=s.useState(!1),[je,wr]=s.useState("system"),w=s.useRef(null),[k,it]=s.useState(null),[$,Wt]=s.useState(!1),[Cr,ne]=s.useState(0),[Tr,ot]=s.useState(0),[Lt,at]=s.useState(0),[vn,Nt]=s.useState(0),[Sn,Pt]=s.useState(0),[_,lt]=s.useState(null),[Rr,Fe]=s.useState("idle"),[kn,Bt]=s.useState(null),J=s.useRef(null),pe=s.useRef(null),me=s.useRef(null),zr=s.useRef(!1),U=s.useRef(null),Je=s.useRef(null),we=s.useRef(null),Ce=s.useRef(null),Ft=s.useRef(null),Te=s.useRef(0),se=s.useRef(0),Re=s.useRef(null),[ze,W]=s.useState(!1),[Mr,Ir]=s.useState(!1),[jn,dt]=s.useState(!1),[wn,Dr]=s.useState(null),[Cn,$r]=s.useState(null),[Ar,Jt]=s.useState(!1),[Ut,fe]=s.useState(!1),[I,Er]=s.useState([]),[T,Vt]=s.useState(null),[ct,_r]=s.useState(!1),[Me,Ht]=s.useState("dialogue"),[Or,Kt]=s.useState(!1),[Tn,Gt]=s.useState(null),[E,qt]=s.useState("llama3.2"),[N,Rn]=s.useState("http://localhost:11434"),[zn,Wr]=s.useState([]),[Mn,Lr]=s.useState(!1),[In,Xt]=s.useState(null),[ie,Nr]=s.useState(!1),[Ue,Dn]=s.useState(!1),[Ve,Pr]=s.useState(!0),[Q,ut]=s.useState(!1),[Br,He]=s.useState(0),[Fr,Ke]=s.useState(null),[Jr,Ge]=s.useState(null),[V,Yt]=s.useState(!1),[Z,pt]=s.useState(!1),[Ur,mt]=s.useState(null),[ee,ft]=s.useState(!1),[Vr,gt]=s.useState(null),[Qt,Zt]=s.useState(!1),[$n,er]=s.useState(""),[An,oe]=s.useState(!1),[En,Ie]=s.useState(null),[De,tr]=s.useState(""),[$e,rr]=s.useState(""),[ge,nr]=s.useState("auto"),[ht,xt]=s.useState(!1),yt=s.useRef(!1),bt=s.useRef(!1),[D,Hr]=s.useState({enabled:!1,secondaryModelId:"",confidenceThreshold:.7,contextWords:3,useLLMForMerge:!1,mode:"parallel"}),[he,sr]=s.useState(!1),[vt,Ae]=s.useState(!1),[_n,q]=s.useState(null),[qe,Kr]=s.useState(""),[Xe,ir]=s.useState(null),[On,St]=s.useState(!1),Ye=s.useRef(null),xe=s.useRef(null),Wn=s.useRef(null),or=s.useRef(new Map),[ye,Gr]=s.useState(!0),Ln=s.useRef(I),qr=s.useRef(T),Nn=s.useRef(y),Xr=s.useRef(vt);s.useEffect(()=>{Ln.current=I},[I]),s.useEffect(()=>{qr.current=T},[T]),s.useEffect(()=>{Nn.current=y},[y]),s.useEffect(()=>{Xr.current=vt},[vt]);const l=s.useCallback(t=>{const r=new Date().toLocaleTimeString();S(o=>[`[${r}] ${t}`,...o].slice(0,100))},[]);s.useEffect(()=>{(async()=>{if(ve)try{const r=await ve.invoke("load-settings");r&&(j(r.language||"ru"),Vt(r.modelId||"ggml-large-v3-turbo"),kr(r.echoCancel??.4),jr(r.useVoiceIsolation??!1),vr(r.vadMode||"auto"),Sr(r.vadMethod||"auto"),Et(r.captureSystem??!0),qt(r.ollamaModel||"llama3.2"),Rn(r.ollamaUrl||"http://localhost:11434"),wr(r.theme||"dark"),r.diarizationEnabled!==void 0&&xt(r.diarizationEnabled),r.diarizationSegModelId&&tr(r.diarizationSegModelId),r.diarizationEmbModelId&&rr(r.diarizationEmbModelId),r.diarizationProvider&&nr(r.diarizationProvider),r.showSessionStats!==void 0&&Pr(r.showSessionStats),r.hybridTranscription&&Hr(r.hybridTranscription),l("Settings loaded"),r.diarizationEnabled&&l(`Diarization settings: enabled=${r.diarizationEnabled}, seg=${r.diarizationSegModelId}, emb=${r.diarizationEmbModelId}`)),_r(!0)}catch(r){console.error("Failed to load settings:",r),_r(!0)}})()},[l]),s.useEffect(()=>{if(!ct||!ve)return;(async()=>{try{await ve.invoke("save-settings",{language:y,modelId:T,echoCancel:st,useVoiceIsolation:Be,vadMode:rt,vadMethod:nt,captureSystem:ue,ollamaModel:E,ollamaUrl:N,theme:je,diarizationEnabled:ht,diarizationSegModelId:De,diarizationEmbModelId:$e,diarizationProvider:ge,showSessionStats:Ve,hybridTranscription:D})}catch(r){console.error("Failed to save settings:",r)}})()},[y,T,st,Be,rt,nt,ue,E,N,je,ct,ht,De,$e,ge,Ve,D]),s.useEffect(()=>{document.documentElement.setAttribute("data-theme",je),document.body.setAttribute("data-theme",je)},[je]);const Yr=c?.id||(k?zs(k):null);s.useEffect(()=>{const t=Yr;if(!t){Re.current=null,lt(null),Fe("idle"),Bt(null),Ft.current=null;return}if(Re.current===t&&_)return;let r=!1;return Fe("loading"),Bt(null),(async()=>{try{const a=await fetch(`${ae}/api/waveform/${t}`);if(a.ok&&a.status!==204){const f=await a.json();if(!r&&f){console.log("[Waveform] Loaded from cache"),lt(f),Re.current=t,Fe("ready");return}}console.log("[Waveform] Computing from audio...");const i=`${ae}/api/sessions/${t}/full.mp3`,u=await fetch(i);if(!u.ok)throw new Error(`HTTP ${u.status}`);const n=await u.arrayBuffer();if(r)return;const d=new AudioContext,g=await d.decodeAudioData(n);if(r){d.close();return}const p=Cs(g);d.close(),r||(lt(p),Re.current=t,Fe("ready"),fetch(`${ae}/api/waveform/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(()=>{console.log("[Waveform] Saved to cache")}).catch(f=>{console.warn("[Waveform] Failed to save cache:",f)}))}catch(a){if(r)return;console.error("Failed to build waveform",a),lt(null),Re.current=null,Fe("error"),Bt(a instanceof Error?a.message:String(a))}})(),()=>{r=!0}},[Yr]),s.useEffect(()=>{if(!_){Ft.current=null;return}const t=_.rmsAbsolute?.[0]||_.peaks[0]||[],r=_.rmsAbsolute?.[1]||_.rmsAbsolute?.[0]||_.peaks[1]||t;Ft.current={mic:t,sys:r,sliceDuration:_.sampleDuration,duration:_.duration,sessionId:Re.current||void 0}},[_]),s.useEffect(()=>{Te.current=Lt},[Lt]),s.useEffect(()=>{let t=null;return x?(Se.current=Date.now(),t=setInterval(()=>{Se.current&&Oe(Math.floor((Date.now()-Se.current)/1e3))},1e3)):(Oe(0),Se.current=null),()=>{t&&clearInterval(t)}},[x]),s.useEffect(()=>{if(!x){We(Array(24).fill(.3));return}const t=()=>{We(r=>r.map((o,a)=>{const i=.3+Math.sin(Date.now()/180+a*.6)*.2,u=Math.random()*.35;return Math.min(1,Math.max(.15,i+u))})),ce.current=requestAnimationFrame(t)};return t(),()=>{ce.current&&cancelAnimationFrame(ce.current)}},[x]),s.useEffect(()=>{let t;const r=async()=>{const a=xr.AIWISPER_GRPC_ADDR;if(a&&a.trim().length>0)return a;try{const{ipcRenderer:i}=require("electron");if(i?.invoke){const u=await i.invoke("get-grpc-address");if(u&&typeof u=="string"&&u.trim().length>0)return u}}catch{}},o=async()=>{const a=await r();if(!a){console.error("gRPC address is not available"),t=setTimeout(o,3e3);return}const i=ws(a);i.onopen=()=>{v("Connected"),l(`Connected to backend (gRPC ${a})`),i.send(JSON.stringify({type:"get_devices"})),i.send(JSON.stringify({type:"get_sessions"})),i.send(JSON.stringify({type:"get_models"})),i.send(JSON.stringify({type:"get_diarization_status"})),i.send(JSON.stringify({type:"get_voiceprints"}))},i.onmessage=u=>{try{const n=JSON.parse(u.data);switch(n.type){case"devices":hn(n.devices||[]),yn(n.screenCaptureKitAvailable||!1),n.screenCaptureKitAvailable&&Et(!0);break;case"sessions_list":Y(n.sessions||[]);break;case"session_started":le(n.session),z(!0),Ds(800,150,.3),l(`Session started: ${n.session.id.substring(0,8)}...`);break;case"session_stopped":z(!1),Nr(!1),le(null),l("Session stopped"),i.send(JSON.stringify({type:"get_sessions"})),n.session&&L(n.session);break;case"session_deleted":Y(p=>p.filter(f=>f.id!==n.sessionId)),l(`Session deleted: ${n.sessionId?.substring(0,8)}...`);break;case"chunk_created":l(`Chunk ${n.chunk.index} created (${(n.chunk.duration/1e9).toFixed(1)}s)`),le(p=>!p||p.id!==n.sessionId?p:{...p,chunks:[...p.chunks,n.chunk]}),Jt(!0);break;case"chunk_transcribed":const d=n.chunk.transcription||"";l(`Chunk ${n.chunk.index}: ${d.substring(0,50)}${d.length>50?"...":""}`),le(p=>{if(!p||p.id!==n.sessionId)return p;const f=p.chunks.map(A=>A.id===n.chunk.id?n.chunk:A);return{...p,chunks:f}}),x&&Jt(!0),L(p=>{if(!p||p.id!==n.sessionId)return p;const f=p.chunks.map(A=>A.id===n.chunk.id?n.chunk:A);return{...p,chunks:f}}),$r(p=>p===n.chunk.id?null:p),Dr(n.chunk.id),setTimeout(()=>Dr(null),2e3),n.sessionId&&m.current?.send(JSON.stringify({type:"get_session_speakers",sessionId:n.sessionId}));break;case"session_details":L(n.session);break;case"audio_level":te(Math.min((n.micLevel||0)*500,100)),_e(Math.min((n.systemLevel||0)*500,100));break;case"error":l(`Error: ${n.data}`);break;case"status":l(`Status: ${n.data}`);break;case"models_list":Er(n.models||[]);const g=(n.models||[]).find(p=>p.status==="active");if(g)bt.current=!0,Vt(g.id);else{const p=qr.current;if(p){const f=(n.models||[]).find(A=>A.id===p);f&&f.status==="downloaded"&&(console.log("Syncing saved active model to backend:",p),i.send(JSON.stringify({type:"set_active_model",modelId:p})))}}break;case"model_progress":Er(p=>p.map(f=>f.id===n.modelId?{...f,status:n.data,progress:n.progress,error:n.error}:f));break;case"download_started":l(`Downloading model: ${n.modelId}`);break;case"download_cancelled":l(`Download cancelled: ${n.modelId}`),i.send(JSON.stringify({type:"get_models"}));break;case"model_deleted":l(`Model deleted: ${n.modelId}`);break;case"active_model_changed":bt.current=!0,Vt(n.modelId),l(`Active model: ${n.modelId}`);break;case"summary_started":Kt(!0),Gt(null),l("Generating summary...");break;case"summary_completed":Kt(!1),Gt(null),L(p=>!p||p.id!==n.sessionId?p:{...p,summary:n.summary}),l("Summary generated");break;case"summary_error":Kt(!1),Gt(n.error||"Unknown error"),l(`Summary error: ${n.error}`);break;case"ollama_models":if(Lr(!1),n.error)Xt(n.error),Wr([]);else{Xt(null),Wr(n.ollamaModels||[]);const p=(n.ollamaModels||[]).map(f=>f.name);if(p.length>0&&!p.includes(E)){const f=(n.ollamaModels||[]).find(A=>A.isCloud);qt(f?.name||p[0])}}break;case"full_transcription_started":ut(!0),He(0),Ke("–ù–∞—á–∞–ª–æ –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏..."),Ge(null),l("Full transcription started");break;case"full_transcription_progress":He(n.progress||0),Ke(n.data||null),Xr.current&&q(n.data||`–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è: ${Math.round((n.progress||0)*100)}%`);break;case"full_transcription_completed":ut(!1),He(1),Ke(null),Ge(null),Ae(!1),q(null),n.session&&(L(n.session),m.current?.send(JSON.stringify({type:"get_session_speakers",sessionId:n.session.id}))),l("Full transcription completed");break;case"full_transcription_error":ut(!1),He(0),Ke(null),Ge(n.error||"Unknown error"),Ae(!1),q(null),l(`Full transcription error: ${n.error}`);break;case"full_transcription_cancelled":ut(!1),He(0),Ke(null),Ge(null),Yt(!1),l("Full transcription cancelled");break;case"session_imported":l(`Session imported: ${n.sessionId}`),m.current?.send(JSON.stringify({type:"get_sessions"}));break;case"import_transcription_started":q("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è..."),l("Import transcription started");break;case"import_transcription_progress":q(`–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è: ${Math.round((n.progress||0)*100)}%`);break;case"import_transcription_completed":Ae(!1),q(null),l("Import transcription completed"),m.current?.send(JSON.stringify({type:"get_sessions"})),n.sessionId&&setTimeout(()=>{m.current?.send(JSON.stringify({type:"get_session",sessionId:n.sessionId}))},500);break;case"import_transcription_error":Ae(!1),q(null),l(`Import transcription error: ${n.error}`);break;case"improve_started":pt(!0),mt(null),l("AI improvement started");break;case"improve_completed":pt(!1),mt(null),n.session&&L(n.session),l("AI improvement completed");break;case"improve_error":pt(!1),mt(n.error||"Unknown error"),l(`AI improvement error: ${n.error}`);break;case"diarize_started":ft(!0),gt(null),l("AI diarization started");break;case"diarize_completed":ft(!1),gt(null),n.session&&L(n.session),l("AI diarization completed");break;case"diarize_error":ft(!1),gt(n.error||"Unknown error"),l(`AI diarization error: ${n.error}`);break;case"diarization_enabled":Zt(!0),er(n.diarizationProvider||"cpu"),oe(!1),Ie(null),l(`Diarization enabled (${n.diarizationProvider||"cpu"})`);break;case"diarization_disabled":Zt(!1),er(""),oe(!1),l("Diarization disabled");break;case"diarization_status":Zt(n.diarizationEnabled||!1),er(n.diarizationProvider||"");break;case"diarization_error":oe(!1),Ie(n.error||"Unknown diarization error"),l(`Diarization error: ${n.error}`);break;case"session_speakers":Ne(n.speakers||[]),l(`Session speakers loaded: ${(n.speakers||[]).length}`);break;case"speaker_renamed":Ne(p=>p.map(f=>f.localId===n.localSpeakerId?{...f,displayName:n.speakerName,isRecognized:n.voiceprintId?!0:f.isRecognized}:f)),l(`Speaker renamed: ${n.speakerName}`),n.sessionId&&m.current?.send(JSON.stringify({type:"get_session_speakers",sessionId:n.sessionId}));break;case"session_renamed":L(p=>!p||p.id!==n.sessionId?p:{...p,title:n.data}),Y(p=>p.map(f=>f.id===n.sessionId?{...f,title:n.data}:f)),l(`Session renamed: ${n.data}`);break;case"search_results":St(!1),ir(n.searchResults||[]);break;case"voiceprint_saved":l(`Voiceprint saved: ${n.name} (${n.voiceprintId?.substring(0,8)}...)`),i.send(JSON.stringify({type:"get_voiceprints"}));break;case"voiceprints_list":At(n.voiceprints||[]),yr(!1),l(`Voiceprints loaded: ${(n.voiceprints||[]).length}`);break;case"voiceprint_updated":At(p=>p.map(f=>f.id===n.voiceprintId?{...f,name:n.name,updatedAt:new Date().toISOString()}:f)),l(`Voiceprint updated: ${n.name}`);break;case"voiceprint_deleted":At(p=>p.filter(f=>f.id!==n.voiceprintId)),l(`Voiceprint deleted: ${n.voiceprintId?.substring(0,8)}...`);break}}catch{}},i.onclose=()=>{v("Disconnected"),z(!1),bt.current=!1,yt.current=!1,l("Disconnected. Reconnecting in 3s..."),m.current=null,t=setTimeout(o,3e3)},i.onerror=u=>{console.error("gRPC stream error:",u,"addr=",a)},m.current=i};return o(),()=>{m.current&&m.current.readyState===H.OPEN&&m.current.close(),clearTimeout(t)}},[l]),s.useEffect(()=>{if(!ct||!ht||yt.current||b!=="Connected"||!T||!bt.current)return;if(ge==="coreml"){yt.current=!0,console.log("[Diarization] Auto-enabling FluidAudio (coreml)..."),l("Auto-enabling FluidAudio diarization..."),oe(!0),Ie(null),m.current?.send(JSON.stringify({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"}));return}if(!De||!$e||I.length===0)return;const t=I.find(i=>i.id===De),r=I.find(i=>i.id===$e);if(!t||!r){console.log("[Diarization] Auto-enable skipped: models not found in registry");return}const o=t.status==="downloaded"||t.status==="active",a=r.status==="downloaded"||r.status==="active";if(!o||!a){console.log("[Diarization] Auto-enable skipped: models not downloaded",{segStatus:t.status,embStatus:r.status});return}if(!t.path||!r.path){console.log("[Diarization] Auto-enable skipped: model paths missing");return}yt.current=!0,console.log("[Diarization] Auto-enabling with saved settings:",{segModelId:De,embModelId:$e,provider:ge}),l(`Auto-enabling diarization (${ge})...`),oe(!0),Ie(null),m.current?.send(JSON.stringify({type:"enable_diarization",segmentationModelPath:t.path,embeddingModelPath:r.path,diarizationProvider:ge}))},[ct,ht,De,$e,ge,I,b,T,l]);const be=()=>{const t=m.current;if(!t||t.readyState!==H.OPEN){l("gRPC channel not connected");return}if(x)Nr(!0),t.send(JSON.stringify({type:"stop_session"}));else{L(null),Ne([]),W(!1),Ht("dialogue");const r=I.find(i=>i.id===T),o=r?.id||T;if(console.log("handleStartStop: activeModelId=",T,"activeModel=",r,"models=",I),l(`Starting recording with model: ${o}`),!(r?.status==="downloaded"||r?.status==="active")&&T){l(`–ú–æ–¥–µ–ª—å –Ω–µ —Å–∫–∞—á–∞–Ω–∞ (status: ${r?.status}). –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.`),fe(!0);return}if(!o){l("–ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö."),fe(!0);return}t.send(JSON.stringify({type:"start_session",language:y,model:o,micDevice:br,captureSystem:ue,vadMode:rt,vadMethod:nt,useNativeCapture:_t&&ue,useVoiceIsolation:_t&&ue&&Be,echoCancel:ue&&!Be?st:0,hybridEnabled:D.enabled,hybridSecondaryModelId:D.secondaryModelId,hybridConfidenceThreshold:D.confidenceThreshold,hybridContextWords:D.contextWords,hybridUseLLMForMerge:D.useLLMForMerge,hybridMode:D.mode,hybridHotwords:D.hotwords,hybridOllamaModel:E,hybridOllamaUrl:N})),l("start_session sent to backend")}},Qe=t=>{m.current?.send(JSON.stringify({type:"get_session",sessionId:t})),m.current?.send(JSON.stringify({type:"get_session_speakers",sessionId:t}))},kt=s.useMemo(()=>{if(C.length===0)return{totalSessions:0,totalDuration:0,avgDuration:0,totalChunks:0};let t=0,r=0;return C.forEach(o=>{t+=(o.totalDuration||0)/1e3,r+=o.chunksCount||0}),{totalSessions:C.length,totalDuration:t,avgDuration:t/C.length,totalChunks:r}},[C]),Pn=t=>{if(!c)return;const r=I.find(a=>a.id===T),o=r?.id||T;L(a=>{if(!a)return a;const i=a.chunks.map(u=>u.id===t?{...u,status:"transcribing",error:void 0,transcription:"",micText:"",sysText:"",dialogue:[]}:u);return{...a,chunks:i}}),$r(t),m.current?.send(JSON.stringify({type:"retranscribe_chunk",sessionId:c.id,data:t,model:o,language:y,hybridEnabled:D.enabled,hybridSecondaryModelId:D.secondaryModelId,hybridConfidenceThreshold:D.confidenceThreshold,hybridContextWords:D.contextWords,hybridUseLLMForMerge:D.useLLMForMerge,hybridMode:D.mode,hybridHotwords:D.hotwords,hybridOllamaModel:E,hybridOllamaUrl:N})),l(`Retranscribing chunk with model: ${r?.name||"default"}, language: ${y}, hybrid: ${D.enabled?`${D.mode} (LLM: ${E})`:"disabled"}`)},Bn=s.useCallback(()=>{if(c){if(!m.current||m.current.readyState!==H.OPEN){l("gRPC channel not connected");return}pt(!0),mt(null),m.current.send(JSON.stringify({type:"improve_transcription",sessionId:c.id,ollamaModel:E,ollamaUrl:N})),l(`Improving transcription with AI model: ${E}`)}},[c,E,N,l]),Fn=s.useCallback(()=>{if(c){if(!m.current||m.current.readyState!==H.OPEN){l("gRPC channel not connected");return}ft(!0),gt(null),m.current.send(JSON.stringify({type:"diarize_with_llm",sessionId:c.id,ollamaModel:E,ollamaUrl:N})),l(`Diarizing text with AI model: ${E}`)}},[c,E,N,l]),Jn=s.useCallback(()=>{!m.current||m.current.readyState!==H.OPEN||(Lr(!0),Xt(null),m.current.send(JSON.stringify({type:"get_ollama_models",ollamaUrl:N})))},[N]),Un=s.useCallback((t,r,o)=>{if(!m.current||m.current.readyState!==H.OPEN)return;if(oe(!0),Ie(null),o==="coreml"){xt(!0),tr(""),rr(""),nr("coreml"),m.current.send(JSON.stringify({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"})),l("Enabling FluidAudio diarization...");return}const a=I.find(u=>u.id===t),i=I.find(u=>u.id===r);if(!a?.path||!i?.path){Ie("–ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ —Å–∫–∞—á–∞–Ω—ã"),oe(!1);return}xt(!0),tr(t),rr(r),nr(o),m.current.send(JSON.stringify({type:"enable_diarization",segmentationModelPath:a.path,embeddingModelPath:i.path,diarizationProvider:o})),l(`Enabling diarization (${o})...`)},[I,l]),Vn=s.useCallback(()=>{!m.current||m.current.readyState!==H.OPEN||(oe(!0),xt(!1),m.current.send(JSON.stringify({type:"disable_diarization"})),l("Disabling diarization..."))},[l]),Hn=s.useCallback((t,r,o)=>{c&&(!m.current||m.current.readyState!==H.OPEN||(m.current.send(JSON.stringify({type:"rename_session_speaker",sessionId:c.id,localSpeakerId:t,speakerName:r,saveAsVoiceprint:o})),l(`Renaming speaker ${t} to "${r}"${o?" (saving voiceprint)":""}`)))},[c,l]),ar=s.useCallback(()=>{re.current&&(re.current.pause(),re.current.currentTime=0,re.current=null),Pe(null)},[]),Kn=s.useCallback(t=>{if(!c)return;ar();const r=`${ae}/api/speaker-sample/${c.id}/${t}`,o=new Audio(r);re.current=o,Pe(t),o.onended=()=>{Pe(null),re.current=null},o.onerror=()=>{Pe(null),re.current=null,l("Failed to play speaker sample")},o.play().catch(a=>{console.error("Failed to play speaker sample:",a),l(`Failed to play speaker sample: ${a.message}`),Pe(null),re.current=null}),l(`Playing sample for speaker ${t}`)},[c,l,ar]),Gn=s.useCallback(()=>{!m.current||m.current.readyState!==H.OPEN||(yr(!0),m.current.send(JSON.stringify({type:"get_voiceprints"})))},[]),qn=s.useCallback((t,r)=>{!m.current||m.current.readyState!==H.OPEN||(m.current.send(JSON.stringify({type:"update_voiceprint",voiceprintId:t,name:r})),l(`Renaming voiceprint to "${r}"`))},[l]),Xn=s.useCallback(t=>{!m.current||m.current.readyState!==H.OPEN||(m.current.send(JSON.stringify({type:"delete_voiceprint",voiceprintId:t})),l(`Deleting voiceprint ${t.substring(0,8)}...`))},[l]),P=s.useCallback(t=>{if(!t)return{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"};if(Le.length>0){const r=Le.find(o=>{if(t==="mic"||t==="–í—ã")return o.isMic;if(t==="sys"||t==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫")return!o.isMic&&o.localId===0;if(t.startsWith("Speaker ")){const a=parseInt(t.replace("Speaker ",""),10);return!o.isMic&&o.localId===a}if(t.startsWith("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ")){const a=parseInt(t.replace("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ",""),10);return!o.isMic&&o.localId===a-1}return o.displayName===t});if(r){const o=r.isMic?-1:r.localId,a=r.isMic?"#4caf50":Dt[Math.abs(o)%Dt.length];return{name:r.displayName,color:a}}}return Rs(t)},[Le]),lr=s.useCallback(()=>{c&&m.current?.send(JSON.stringify({type:"generate_summary",sessionId:c.id,ollamaModel:E,ollamaUrl:N}))},[c,E,N]),dr=s.useCallback(()=>{if(!c)return;const t=I.find(a=>a.id===T),r=t?.id||T;if(!(t?.status==="downloaded"||t?.status==="active")&&T){l(`–ú–æ–¥–µ–ª—å –Ω–µ —Å–∫–∞—á–∞–Ω–∞ (status: ${t?.status}). –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.`),fe(!0);return}if(!r){l("–ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö."),fe(!0);return}Ge(null),m.current?.send(JSON.stringify({type:"retranscribe_full",sessionId:c.id,model:r,language:y,diarizationEnabled:Qt})),l(`Starting full retranscription with model: ${t?.name||"default"}${Qt?" (with diarization)":""}`)},[c,I,T,y,l]),Yn=s.useCallback(()=>{!c||V||(Yt(!0),m.current?.send(JSON.stringify({type:"cancel_full_transcription",sessionId:c.id})),l("Cancelling full transcription..."),setTimeout(()=>Yt(!1),2e3))},[c,V,l]),Qn=s.useCallback(()=>{c&&(m.current?.send(JSON.stringify({type:"delete_session",sessionId:c.id})),l(`–£–¥–∞–ª–µ–Ω–∞ —Å–µ—Å—Å–∏—è: ${c.title||c.id}`),L(null),Ne([]),dt(!1))},[c,l]),Zn=s.useCallback(()=>{m.current?.send(JSON.stringify({type:"get_sessions"})),l("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π...")},[l]),es=s.useCallback(t=>{if(Kr(t),Ye.current&&clearTimeout(Ye.current),!t.trim()){ir(null),St(!1);return}St(!0),Ye.current=setTimeout(()=>{m.current?.send(JSON.stringify({type:"search_sessions",searchQuery:t.trim()}))},300)},[]),Qr=s.useCallback(()=>{Kr(""),ir(null),St(!1),Ye.current&&clearTimeout(Ye.current)},[]),Zr=t=>{const r=w.current;if(!r)return;U.current!==null&&(cancelAnimationFrame(U.current),U.current=null);const o=()=>{Nt(0),Pt(0),U.current!==null&&(cancelAnimationFrame(U.current),U.current=null)};if(k===t){r.pause(),r.currentTime=0,it(null),ne(0),se.current=0,at(0),Te.current=0,o();return}if(r.src=t,ne(0),se.current=0,J.current||(J.current=new AudioContext),J.current.state==="suspended"&&J.current.resume(),!zr.current&&J.current){const n=J.current.createMediaElementSource(r),d=J.current.createChannelSplitter(2);pe.current=J.current.createAnalyser(),me.current=J.current.createAnalyser(),pe.current.fftSize=128,me.current.fftSize=128,pe.current.smoothingTimeConstant=0,me.current.smoothingTimeConstant=0,we.current=new Float32Array(pe.current.fftSize),Ce.current=new Float32Array(me.current.fftSize);const g=J.current.createChannelMerger(2);n.connect(d),d.connect(pe.current,0),d.connect(me.current,1),pe.current.connect(g,0,0),me.current.connect(g,0,1),g.connect(J.current.destination),zr.current=!0}const a=n=>{let d=0;for(let g=0;g<n.length;g++){const p=n[g];d+=p*p}return Math.sqrt(d/n.length)},i=n=>{if(n<=0)return 0;const d=20*Math.log10(n),g=-50,f=(d-g)/(0-g)*100;return Math.max(0,Math.min(100,f))},u=()=>{const n=pe.current,d=me.current,g=w.current;if(!g||g.paused||g.ended){o();return}const p=g.currentTime;if(Math.abs(p-se.current)>.02&&(se.current=p,ne(p)),n&&d){(!we.current||we.current.length!==n.fftSize)&&(we.current=new Float32Array(n.fftSize)),(!Ce.current||Ce.current.length!==d.fftSize)&&(Ce.current=new Float32Array(d.fftSize)),n.getFloatTimeDomainData(we.current),d.getFloatTimeDomainData(Ce.current);const f=a(we.current),A=a(Ce.current),gr=i(f),hr=i(A);ms.flushSync(()=>{Nt(gr),Pt(hr)})}U.current=requestAnimationFrame(u)};r.play().then(()=>{it(t),U.current=requestAnimationFrame(u)}).catch(n=>{console.error("Failed to play audio:",n),o(),it(null)})},ts=(t,r)=>{if(!t)return 0;const o=t.chunks.find(a=>a.index===r);return o?.startMs!==void 0?o.startMs/1e3:t.chunks.filter(a=>a.index<r).reduce((a,i)=>a+(i.duration||0)/1e9,0)},Ze=s.useCallback(t=>{at(0),Te.current=0,_?.duration&&ot(_.duration),Zr(`${ae}/api/sessions/${t}/full.mp3`)},[_?.duration]),rs=(t,r)=>{const o=c&&c.id===t?c:F&&F.id===t?F:c,a=ts(o||null,r);at(a),Te.current=a;const i=o?.chunks.find(u=>u.index===r);i?.duration&&ot(i.duration/1e9),Zr(`${ae}/api/sessions/${t}/chunk/${r}.mp3`)},ns=()=>{it(null),Wt(!1),Nt(0),Pt(0),se.current=0,at(0),Te.current=0,U.current!==null&&(cancelAnimationFrame(U.current),U.current=null)},jt=s.useCallback(t=>{const r=t.chunks||[],o=r.filter(i=>i.status==="completed").sort((i,u)=>i.index-u.index).flatMap(i=>i.dialogue&&i.dialogue.length>0?i.dialogue.map(u=>({...u,start:u.start,end:u.end})):[]);if(o.length>0){const i=`–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–ø–∏—Å–∏ –æ—Ç ${It(t.startTime)}
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${et(t.totalDuration/1e3)}
${"=".repeat(50)}

`,u=o.map(n=>{const d=Math.floor(n.start/1e3),g=Math.floor(d/60),p=d%60,f=`${g.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`,{name:A}=P(n.speaker);return`[${f}] ${A}: ${n.text}`}).join(`

`);return i+u}const a=r.filter(i=>i.status==="completed"&&(i.transcription||i.micText||i.sysText)).sort((i,u)=>i.index-u.index).map(i=>{if(i.micText||i.sysText){const u=[];return i.micText&&u.push(`–í—ã: ${i.micText}`),i.sysText&&u.push(`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ${i.sysText}`),u.join(`
`)}return i.transcription}).join(`

`);return a?`–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–ø–∏—Å–∏ –æ—Ç ${It(t.startTime)}
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${et(t.totalDuration/1e3)}
${"=".repeat(50)}

${a}`:"–ù–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏"},[P]),cr=s.useCallback(async()=>{if(!c)return;const t=jt(c);try{await navigator.clipboard.writeText(t),Ir(!0),W(!1),l("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞"),setTimeout(()=>Ir(!1),2e3)}catch(r){l("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä"),console.error("Copy failed:",r)}},[c,jt,l]),ur=s.useCallback(()=>{if(!c)return;const t=jt(c),r=new Date(c.startTime),o=r.toISOString().slice(0,10),a=r.toTimeString().slice(0,5).replace(":","-"),i=`transcription_${o}_${a}.txt`,u=new Blob([t],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),W(!1),l(`–§–∞–π–ª ${i} —Å–∫–∞—á–∞–Ω`)},[c,jt,l]),en=s.useCallback(t=>{const o=(t.chunks||[]).filter(i=>i.status==="completed").sort((i,u)=>i.index-u.index).flatMap(i=>i.dialogue&&i.dialogue.length>0?i.dialogue.map(u=>({...u,start:u.start,end:u.end})):[]);if(o.length===0)return"";const a=i=>{const u=Math.floor(i/1e3),n=Math.floor(u/3600),d=Math.floor(u%3600/60),g=u%60,p=i%1e3;return`${n.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")},${p.toString().padStart(3,"0")}`};return o.map((i,u)=>{const{name:n}=P(i.speaker),d=a(i.start),g=a(i.end);return`${u+1}
${d} --> ${g}
${n}: ${i.text}`}).join(`

`)},[P]),ss=s.useCallback(()=>{if(!c)return;const t=en(c);if(!t){l("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ SRT");return}const r=new Date(c.startTime),o=r.toISOString().slice(0,10),a=r.toTimeString().slice(0,5).replace(":","-"),i=`transcription_${o}_${a}.srt`,u=new Blob([t],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),W(!1),l(`–§–∞–π–ª ${i} —Å–∫–∞—á–∞–Ω`)},[c,en,l]),tn=s.useCallback(t=>{const o=(t.chunks||[]).filter(n=>n.status==="completed").sort((n,d)=>n.index-d.index).flatMap(n=>n.dialogue&&n.dialogue.length>0?n.dialogue.map(d=>({...d,start:d.start,end:d.end})):[]);if(o.length===0)return"";const a=n=>{const d=Math.floor(n/1e3),g=Math.floor(d/3600),p=Math.floor(d%3600/60),f=d%60,A=n%1e3;return`${g.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}.${A.toString().padStart(3,"0")}`},i=`WEBVTT

`,u=o.map((n,d)=>{const{name:g}=P(n.speaker),p=a(n.start),f=a(n.end);return`${d+1}
${p} --> ${f}
<v ${g}>${n.text}`}).join(`

`);return i+u},[P]),is=s.useCallback(()=>{if(!c)return;const t=tn(c);if(!t){l("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ VTT");return}const r=new Date(c.startTime),o=r.toISOString().slice(0,10),a=r.toTimeString().slice(0,5).replace(":","-"),i=`transcription_${o}_${a}.vtt`,u=new Blob([t],{type:"text/vtt;charset=utf-8"}),n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),W(!1),l(`–§–∞–π–ª ${i} —Å–∫–∞—á–∞–Ω`)},[c,tn,l]),rn=s.useCallback(t=>{const r=t.chunks||[],o=r.filter(i=>i.status==="completed").sort((i,u)=>i.index-u.index).flatMap(i=>i.dialogue&&i.dialogue.length>0?i.dialogue.map(u=>({...u,start:u.start,end:u.end})):[]),a={metadata:{sessionId:t.id,startTime:t.startTime,totalDuration:t.totalDuration,chunksCount:r.length,exportedAt:new Date().toISOString(),version:"1.0"},segments:o.map((i,u)=>{const{name:n}=P(i.speaker);return{index:u,start:i.start,end:i.end,duration:i.end-i.start,speaker:n,speakerId:i.speaker,text:i.text}}),summary:t.summary||null};return JSON.stringify(a,null,2)},[P]),os=s.useCallback(()=>{if(!c)return;const t=rn(c);if(!t||t==='{"metadata":{},"segments":[],"summary":null}'){l("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ JSON");return}const r=new Date(c.startTime),o=r.toISOString().slice(0,10),a=r.toTimeString().slice(0,5).replace(":","-"),i=`transcription_${o}_${a}.json`,u=new Blob([t],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),W(!1),l(`–§–∞–π–ª ${i} —Å–∫–∞—á–∞–Ω`)},[c,rn,l]),nn=s.useCallback(t=>{const o=(t.chunks||[]).filter(d=>d.status==="completed").sort((d,g)=>d.index-g.index).flatMap(d=>d.dialogue&&d.dialogue.length>0?d.dialogue.map(g=>({...g,start:g.start,end:g.end})):[]);if(o.length===0)return"";const a=d=>{const g=Math.floor(d/1e3),p=Math.floor(g/60),f=g%60;return`${p}:${f.toString().padStart(2,"0")}`},i=`# –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è

**–î–∞—Ç–∞:** ${It(t.startTime)}  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ${et(t.totalDuration/1e3)}

---

`,u=o.map(d=>{const{name:g}=P(d.speaker);return`**[${a(d.start)}] ${g}:**  
${d.text}
`}).join(`
`),n=t.summary?`
---

## –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

${t.summary}
`:"";return i+u+n},[P]),as=s.useCallback(()=>{if(!c)return;const t=nn(c);if(!t){l("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Markdown");return}const r=new Date(c.startTime),o=r.toISOString().slice(0,10),a=r.toTimeString().slice(0,5).replace(":","-"),i=`transcription_${o}_${a}.md`,u=new Blob([t],{type:"text/markdown;charset=utf-8"}),n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),W(!1),l(`–§–∞–π–ª ${i} —Å–∫–∞—á–∞–Ω`)},[c,nn,l]),pr=["mp3","wav","m4a","ogg","flac"],sn=s.useCallback(async t=>{const r=t.name.split(".").pop()?.toLowerCase();if(!r||!pr.includes(r)){l(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: ${r}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: ${pr.join(", ")}`);return}const o=new FormData;o.append("audio",t),o.append("model",T||"ggml-large-v3-turbo"),o.append("language",y),Ae(!0),q("–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞..."),l(`–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞: ${t.name} (${(t.size/1024/1024).toFixed(2)} MB)`);try{const a=await fetch(`${ae}/api/import`,{method:"POST",body:o});if(!a.ok){const u=await a.text();throw new Error(u||`HTTP ${a.status}`)}const i=await a.json();if(i.success)l(`–§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: ${i.title}, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${Math.round(i.duration)}—Å`),q("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞...");else throw new Error(i.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")}catch(a){const i=a instanceof Error?a.message:String(a);l(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${i}`),Ae(!1),q(null)}},[T,y,l]),on=s.useCallback(t=>{t.preventDefault(),t.stopPropagation()},[]),an=s.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.types.includes("Files")&&sr(!0)},[]),ln=s.useCallback(t=>{t.preventDefault(),t.stopPropagation();const r=t.currentTarget.getBoundingClientRect(),o=t.clientX,a=t.clientY;(o<r.left||o>=r.right||a<r.top||a>=r.bottom)&&sr(!1)},[]),dn=s.useCallback(t=>{t.preventDefault(),t.stopPropagation(),sr(!1);const r=Array.from(t.dataTransfer.files),o=r.find(a=>{const i=a.name.split(".").pop()?.toLowerCase();return i&&pr.includes(i)});o?sn(o):r.length>0&&l(`–§–∞–π–ª ${r[0].name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç–æ–º`)},[sn,l]);s.useEffect(()=>{Ar&&xe.current&&(requestAnimationFrame(()=>{setTimeout(()=>{xe.current&&xe.current.scrollTo({top:xe.current.scrollHeight+1e3,behavior:"smooth"})},50)}),Jt(!1))},[Ar]),s.useEffect(()=>{const t=r=>{const o=r.target;ze&&!o.closest("[data-share-menu]")&&W(!1)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[ze]);const[mr,wt]=s.useState(!1),[ls,Ct]=s.useState(!1),[ds,fr]=s.useState("guide");s.useEffect(()=>{if(!ve)return;const t={"show-help":()=>{fr("guide"),Ct(!0)},"show-shortcuts":()=>{fr("shortcuts"),Ct(!0)},"show-about":()=>{fr("about"),Ct(!0)},"open-settings":()=>{x||Ot(!0)},"start-recording":()=>{!x&&b==="Connected"&&be()},"stop-recording":()=>{x&&be()},"copy-transcription":()=>{c&&cr()},"export-transcription":()=>{c&&W(!0)},"retranscribe-session":()=>{c&&!x&&dr()},"generate-summary":()=>{c&&!x&&lr()},"delete-session":()=>{c&&!x&&dt(!0)},"toggle-playback":()=>{!x&&c&&(k&&$?w.current?.pause():k&&!$?w.current?.play():Ze(c.id))}};return Object.entries(t).forEach(([r,o])=>{ve.on(r,o)}),()=>{Object.entries(t).forEach(([r,o])=>{ve.removeListener(r,o)})}},[x,b,c,k,$,be,cr,dr,lr,Ze]),s.useEffect(()=>{const t=r=>{const o=r.target,a=document.activeElement;if((o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||a?.tagName==="INPUT"||a?.tagName==="TEXTAREA"||a?.isContentEditable)&&r.code!=="Escape")return;const u=r.metaKey||r.ctrlKey;if((r.key==="?"||r.shiftKey&&r.code==="Slash")&&!u){r.preventDefault(),wt(n=>!n);return}if(r.code==="Space"&&!x&&c){r.preventDefault(),k&&$?w.current?.pause():k&&!$?w.current?.play():Ze(c.id);return}if(r.code==="KeyR"&&!u){r.preventDefault(),be();return}if(u&&r.code==="KeyF"){r.preventDefault();const n=document.querySelector('input[placeholder*="–ü–æ–∏—Å–∫"]');n&&(n.focus(),n.select());return}if(u&&r.code.match(/^Digit[1-9]$/)){r.preventDefault();const n=parseInt(r.code.replace("Digit",""),10)-1;C[n]&&Qe(C[n].id);return}if(!k&&C.length>0&&(r.code==="ArrowUp"||r.code==="ArrowDown")){r.preventDefault();const n=c?C.findIndex(g=>g.id===c.id):-1;let d;r.code==="ArrowUp"?d=n<=0?C.length-1:n-1:d=n>=C.length-1?0:n+1,C[d]&&Qe(C[d].id);return}if(!(u&&r.code==="KeyC"&&!window.getSelection()?.toString()&&c)){if(u&&r.code==="KeyS"&&c){r.preventDefault(),ur();return}if(u&&r.code==="KeyE"&&c){r.preventDefault(),W(n=>!n);return}if(r.code==="Escape"){if(mr){wt(!1);return}ze&&W(!1),Ut&&fe(!1);return}if(k&&w.current){if(r.code==="ArrowLeft"){r.preventDefault(),w.current.currentTime=Math.max(0,w.current.currentTime-5);return}if(r.code==="ArrowRight"){r.preventDefault(),w.current.currentTime=Math.min(w.current.duration||0,w.current.currentTime+5);return}}}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[x,c,k,ze,Ut,mr,C,be,ur,Qe]);const O=c||F,X=O?.chunks||[],Tt=Ms(O?.totalDuration),cs=_?.duration||Tr||Tt;s.useEffect(()=>{Tt>0&&ot(t=>t&&t>0?t:Tt)},[Tt]),s.useEffect(()=>{if(!k)return;const t=()=>{const r=w.current;if(r&&!Number.isNaN(r.currentTime)){const o=r.currentTime;Math.abs(o-se.current)>.01&&(se.current=o,ne(o))}Je.current=requestAnimationFrame(t)};return Je.current=requestAnimationFrame(t),()=>{Je.current!==null&&(cancelAnimationFrame(Je.current),Je.current=null)}},[k]);const R=X.filter(t=>t.status==="completed").flatMap(t=>t.dialogue&&t.dialogue.length>0?t.dialogue.map(r=>({...r,start:r.start,end:r.end})):[]).sort((t,r)=>t.start-r.start),Ee=Cr*1e3,Rt=s.useMemo(()=>{if(!$||R.length===0)return-1;for(let t=0;t<R.length;t++){const r=R[t];if(Ee>=r.start&&Ee<r.end||t<R.length-1&&Ee>=r.end&&Ee<R[t+1].start)return t}return R.length>0&&Ee>=R[R.length-1].start?R.length-1:-1},[Ee,$,R]);s.useEffect(()=>{if(!$||!ye||Rt<0)return;const t=or.current.get(Rt);if(t&&xe.current){const r=xe.current,o=t.getBoundingClientRect(),a=r.getBoundingClientRect();o.top>=a.top&&o.bottom<=a.bottom||t.scrollIntoView({behavior:"smooth",block:"center"})}},[Rt,$,ye]);const us=s.useCallback((t,r)=>{r?or.current.set(t,r):or.current.delete(t)},[]),ps=s.useCallback(t=>{const r=w.current;if(!r)return;const o=t/1e3;r.currentTime=o,ne(o)},[]);return e.jsxs("div",{className:"app-frame",style:{display:"flex",flexDirection:"column",height:"100vh",background:"var(--app-bg)",color:"var(--text-primary)",position:"relative"},onDragOver:on,onDragEnter:an,onDragLeave:ln,onDrop:dn,children:[he&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(139, 92, 246, 0.15)",backdropFilter:"blur(4px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:e.jsxs("div",{style:{background:"var(--surface)",borderRadius:"var(--radius-xl)",padding:"3rem 4rem",border:"3px dashed var(--primary)",textAlign:"center",boxShadow:"var(--shadow-glass)"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üì•"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600,color:"var(--text-primary)"},children:"–û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞"}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"0.5rem"},children:"MP3, WAV, M4A, OGG, FLAC"})]})}),e.jsx("audio",{ref:w,crossOrigin:"anonymous",onEnded:ns,onPlay:()=>Wt(!0),onPause:()=>Wt(!1),onTimeUpdate:t=>{const r=t.target.currentTime;se.current=r,ne(r)},onLoadedMetadata:t=>ot(t.target.duration),style:{display:"none"}}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs("aside",{className:"glass-surface-elevated",style:{position:"relative",width:"260px",minWidth:"260px",flexShrink:0,margin:"var(--spacing-inset)",marginRight:0,borderRadius:"var(--radius-xl)",background:"var(--sidebar-bg)",backdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",WebkitBackdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",border:"1px solid var(--glass-border)",boxShadow:"var(--shadow-glass)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"1rem 1.25rem",paddingTop:"0.5rem",marginTop:"28px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.2rem",fontWeight:"var(--font-weight-bold)",letterSpacing:"-0.02em",color:"var(--text-primary)"},children:"–í—Å–µ –∑–∞–ø–∏—Å–∏"}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:Zn,title:"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫",style:{width:"32px",height:"32px"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:Is,title:"–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É —Å –∑–∞–ø–∏—Å—è–º–∏",style:{width:"32px",height:"32px"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:()=>Pr(!Ve),title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",style:{width:"32px",height:"32px",background:Ve?"var(--primary-alpha)":void 0},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})})]})]}),e.jsxs("div",{style:{padding:"0 1rem 0.75rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"var(--text-muted)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",left:"0.75rem",pointerEvents:"none",opacity:.6},children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π...",value:qe,onChange:t=>es(t.target.value),style:{width:"100%",padding:"0.5rem 2rem 0.5rem 2.25rem",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)",color:"var(--text-primary)",fontSize:"0.85rem",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:t=>{t.target.style.borderColor="var(--primary)",t.target.style.boxShadow="0 0 0 2px var(--primary-alpha)"},onBlur:t=>{t.target.style.borderColor="var(--glass-border-subtle)",t.target.style.boxShadow="none"}}),qe&&e.jsx("button",{onClick:Qr,style:{position:"absolute",right:"0.5rem",padding:"0.25rem",background:"transparent",border:"none",cursor:"pointer",color:"var(--text-muted)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%"},title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),qe&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--text-muted)"},children:On?"–ü–æ–∏—Å–∫...":Xe?`–ù–∞–π–¥–µ–Ω–æ: ${Xe.length}`:""})]}),Ve&&C.length>0&&!qe&&e.jsx("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--primary)"},children:kt.totalSessions}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ó–∞–ø–∏—Å–µ–π"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--success)"},children:zt(kt.totalDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–í—Å–µ–≥–æ"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--warning)"},children:zt(kt.avgDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–°—Ä–µ–¥–Ω—è—è"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--info)"},children:kt.totalChunks}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ß–∞–Ω–∫–æ–≤"})]})]})}),ke.size>0&&e.jsxs("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid var(--glass-border-subtle)",background:"rgba(139, 92, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0.5rem"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-primary)"},children:[e.jsx("span",{style:{fontWeight:600},children:ke.size}),e.jsx("span",{style:{color:"var(--text-muted)",marginLeft:"4px"},children:ke.size===1?"–∑–∞–ø–∏—Å—å":ke.size<5?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"})]}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{onClick:()=>$t(!0),style:{padding:"4px 10px",fontSize:"0.75rem",background:"var(--primary)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:500},children:"üì¶ –≠–∫—Å–ø–æ—Ä—Ç"}),e.jsx("button",{onClick:()=>tt(new Set),style:{padding:"4px 8px",fontSize:"0.75rem",background:"transparent",color:"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"6px",cursor:"pointer"},children:"‚úï"})]})]}),e.jsx("div",{className:"scroll-soft-edges",style:{flex:1,overflowY:"auto",paddingBottom:"1rem"},children:qe&&Xe!==null?Xe.length===0?e.jsx("div",{style:{padding:"2rem 1rem",color:"var(--text-muted)",textAlign:"center",fontSize:"0.9rem"},children:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"}):e.jsx("div",{children:Xe.map(t=>{const r=c?.id===t.id,o=t.totalDuration/1e3;return e.jsxs("div",{className:`session-item ${r?"selected":""}`,onClick:()=>{Qe(t.id),Qr()},children:[e.jsx("div",{style:{fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||`–ó–∞–ø–∏—Å—å ${Mt(t.startTime)}`}),t.matchContext&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"0.35rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:"italic",background:"rgba(139, 92, 246, 0.1)",padding:"0.25rem 0.5rem",borderRadius:"4px"},children:['"',t.matchContext,'"']}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem",color:"var(--text-muted)"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:[Mt(t.startTime),", ",cn(t.startTime)]}),e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.jsx("span",{children:zt(o)})]})]},t.id)})}):C.length===0?e.jsx("div",{style:{padding:"2rem 1rem",color:"var(--text-muted)",textAlign:"center",fontSize:"0.9rem"},children:"–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π"}):fs(C).map(t=>e.jsxs("div",{children:[e.jsx("div",{className:"group-header",children:t.label}),t.sessions.map(r=>{const o=c?.id===r.id,a=r.totalDuration/1e3,i=ke.has(r.id);return e.jsxs("div",{className:`session-item ${o?"selected":""} ${i?"multi-selected":""}`,onClick:u=>{u.metaKey||u.ctrlKey?(u.preventDefault(),tt(n=>{const d=new Set(n);return d.has(r.id)?d.delete(r.id):d.add(r.id),d})):(Qe(r.id),tt(new Set))},children:[e.jsx("div",{style:{fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.title||`–ó–∞–ø–∏—Å—å ${Mt(r.startTime)}`}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem",color:"var(--text-muted)"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:[Mt(r.startTime),", ",cn(r.startTime)]}),e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.jsx("span",{children:zt(a)})]})]},r.id)})]},t.label))}),e.jsx("div",{style:{padding:"0.75rem 1rem",borderTop:"1px solid var(--glass-border-subtle)"},children:e.jsxs("button",{className:"btn-capsule",onClick:be,disabled:b!=="Connected"||ie||x,title:"–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å (R)",style:{width:"100%",justifyContent:"center",padding:"0.6rem 1rem",gap:"0.4rem",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",border:"none",color:"white",boxShadow:x?"none":"var(--shadow-glow-primary)",opacity:x?.4:1,cursor:x?"not-allowed":"pointer",transition:"opacity 0.2s ease, box-shadow 0.2s ease"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å"]})}),x&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(4px) saturate(0.8)",WebkitBackdropFilter:"blur(4px) saturate(0.8)",borderRadius:"var(--radius-xl)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"0.75rem",cursor:"not-allowed"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.6rem",padding:"0.75rem 1.5rem",background:"rgba(239, 68, 68, 0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderRadius:"var(--radius-capsule)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 12px rgba(239, 68, 68, 0.8)",animation:"pulse 1s infinite"}}),e.jsx("span",{style:{fontSize:"0.95rem",fontWeight:600,color:"#ef4444"},children:"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å"})]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"rgba(255, 255, 255, 0.6)"},children:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥—Ä—É–≥–æ–π –∑–∞–ø–∏—Å–∏"})]})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,overflow:"hidden"},children:[e.jsxs("header",{style:{padding:"0.75rem 1.5rem",paddingLeft:"88px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"transparent",WebkitAppRegion:"drag",userSelect:"none",minHeight:"52px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:b==="Connected"?"var(--success)":"var(--danger)",boxShadow:b==="Connected"?"0 0 12px var(--success)":"0 0 12px var(--danger)",transition:"all var(--duration-normal) var(--transition-smooth)"}})}),x&&e.jsxs("div",{className:"animate-scale-in",style:{flex:1,margin:"0 1rem",padding:"0.5rem 1.5rem",borderRadius:"var(--radius-capsule)",background:"rgba(239, 68, 68, 0.1)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",border:"1px solid rgba(239, 68, 68, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",WebkitAppRegion:"no-drag"},children:[e.jsxs("div",{style:{position:"relative",width:"10px",height:"10px"},children:[e.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"#ef4444",animation:"recordPulseRing 1.5s infinite"}}),e.jsx("div",{style:{position:"absolute",inset:"1px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 8px rgba(239, 68, 68, 0.8)"}})]}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:700,color:"#ef4444",textTransform:"uppercase",letterSpacing:"0.08em"},children:"REC"}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"2.5px",height:"24px",flex:1,maxWidth:"400px",justifyContent:"center"},children:de.map((t,r)=>e.jsx("div",{style:{width:"3px",height:`${t*100}%`,minHeight:"4px",background:`linear-gradient(to top, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, ${.3+t*.7}))`,borderRadius:"2px",transition:"height 0.08s ease-out"}},r))}),e.jsx("span",{style:{fontFamily:"SF Mono, Menlo, Monaco, monospace",fontSize:"0.95rem",fontWeight:600,color:"var(--text-primary)",minWidth:"52px",letterSpacing:"0.02em"},children:et(B)}),e.jsxs("button",{onClick:be,disabled:ie,style:{display:"flex",alignItems:"center",gap:"0.35rem",padding:"0.35rem 0.75rem",background:"rgba(239, 68, 68, 0.9)",border:"none",borderRadius:"9999px",color:"white",fontSize:"0.8rem",fontWeight:600,cursor:ie?"wait":"pointer",transition:"all 0.15s ease",opacity:ie?.7:1},onMouseEnter:t=>!ie&&(t.currentTarget.style.background="rgba(220, 38, 38, 1)"),onMouseLeave:t=>!ie&&(t.currentTarget.style.background="rgba(239, 68, 68, 0.9)"),children:[ie?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",style:{animation:"spin 1s linear infinite"},children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}):e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})}),ie?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ":"–°—Ç–æ–ø"]})]}),e.jsx("style",{children:`
                        @keyframes recordPulseRing {
                            0%, 100% { transform: scale(1); opacity: 1; }
                            50% { transform: scale(2); opacity: 0; }
                        }
                    `}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",WebkitAppRegion:"no-drag"},children:e.jsx("button",{className:"btn-icon",onClick:()=>!x&&Ot(!0),title:x?"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–ø–∏—Å—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º":"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",disabled:x,style:{width:"36px",height:"36px",opacity:x?.4:1,cursor:x?"not-allowed":"pointer",transition:"opacity 0.2s ease"},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]}),e.jsx(gs,{isOpen:bn,onClose:()=>Ot(!1),devices:gn,micDevice:br,setMicDevice:xn,captureSystem:ue,setCaptureSystem:Et,vadMode:rt,setVADMode:vr,vadMethod:nt,setVADMethod:Sr,screenCaptureKitAvailable:_t,useVoiceIsolation:Be,setUseVoiceIsolation:jr,echoCancel:st,setEchoCancel:kr,language:y,setLanguage:j,theme:je,setTheme:wr,ollamaModel:E,setOllamaModel:qt,ollamaContextSize:8,setOllamaContextSize:()=>{},ollamaModels:zn,ollamaModelsLoading:Mn,ollamaError:In,loadOllamaModels:Jn,onShowModelManager:()=>fe(!0),activeModelId:T,models:I,diarizationStatus:{enabled:Qt,provider:$n},diarizationLoading:An,diarizationError:En,segmentationModels:I.filter(t=>t.engine==="diarization"&&t.diarizationType==="segmentation"),embeddingModels:I.filter(t=>t.engine==="diarization"&&t.diarizationType==="embedding"),onEnableDiarization:Un,onDisableDiarization:Vn,hybridTranscription:D,onHybridTranscriptionChange:Hr,voiceprints:pn,voiceprintsLoading:mn,onRenameVoiceprint:qn,onDeleteVoiceprint:Xn,onRefreshVoiceprints:Gn}),e.jsxs("main",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minWidth:0},children:[(c||x)&&e.jsxs("div",{style:{flexShrink:0,backgroundColor:"var(--app-bg)",borderBottom:"1px solid var(--border)",padding:"0 1.5rem"},children:[c&&!x&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"1rem 1.25rem",background:"linear-gradient(135deg, rgba(108, 92, 231, 0.08) 0%, rgba(162, 155, 254, 0.04) 100%)",borderRadius:"16px",border:"1px solid rgba(108, 92, 231, 0.2)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.75rem"},children:[e.jsx("button",{onClick:()=>{k?.includes(c.id)&&$?w.current?.pause():k?.includes(c.id)&&!$?w.current?.play():Ze(c.id)},title:k?.includes(c.id)&&$?"–ü–∞—É–∑–∞ (Space)":"–°–ª—É—à–∞—Ç—å –∑–∞–ø–∏—Å—å (Space)",style:{width:"56px",height:"56px",padding:0,background:k?.includes(c.id)&&$?"linear-gradient(135deg, #f44336, #e91e63)":"linear-gradient(135deg, #6c5ce7, #a29bfe)",color:"#fff",border:"none",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:k?.includes(c.id)&&$?"0 4px 20px rgba(244, 67, 54, 0.4)":"0 4px 20px rgba(108, 92, 231, 0.4)",transition:"all 0.3s ease",transform:"scale(1)",flexShrink:0},onMouseEnter:t=>{t.currentTarget.style.transform="scale(1.08)"},onMouseLeave:t=>{t.currentTarget.style.transform="scale(1)"},children:k?.includes(c.id)&&$?e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("rect",{x:"6",y:"5",width:"4",height:"14",rx:"1"}),e.jsx("rect",{x:"14",y:"5",width:"4",height:"14",rx:"1"})]}):e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700,color:"var(--text-primary)",fontSize:"1.1rem",marginBottom:"0.2rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.title||"–ó–∞–ø–∏—Å—å"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--text-muted)",fontSize:"0.8rem",flexWrap:"wrap"},children:[e.jsx("span",{children:It(c.startTime)}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:et(c.totalDuration/1e9)}),c.chunks.length>0&&c.chunks[0].isStereo&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{style:{fontSize:"0.7rem",color:"var(--success)",backgroundColor:"rgba(0, 184, 148, 0.12)",padding:"2px 6px",borderRadius:"999px"},children:"–°—Ç–µ—Ä–µ–æ"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.4rem",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{style:{position:"relative"},"data-share-menu":!0,children:[e.jsx("button",{onClick:()=>W(!ze),title:"–≠–∫—Å–ø–æ—Ä—Ç (‚åòE)",style:{width:"36px",height:"36px",padding:0,backgroundColor:Mr?"rgba(76, 175, 80, 0.2)":"var(--surface-strong)",color:Mr?"#4caf50":"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13"})})}),ze&&e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"4px",backgroundColor:"var(--surface)",border:"1px solid var(--border)",borderRadius:"8px",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",zIndex:100,minWidth:"160px",overflow:"hidden"},children:[e.jsx("button",{onClick:cr,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"}),e.jsx("button",{onClick:ur,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üìÑ –°–∫–∞—á–∞—Ç—å .txt"}),e.jsx("button",{onClick:ss,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üé¨ –°–∫–∞—á–∞—Ç—å .srt (—Å—É–±—Ç–∏—Ç—Ä—ã)"}),e.jsx("button",{onClick:is,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üåê –°–∫–∞—á–∞—Ç—å .vtt (WebVTT)"}),e.jsx("div",{style:{borderTop:"1px solid var(--border)",margin:"0.3rem 0"}}),e.jsx("button",{onClick:os,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üìä –°–∫–∞—á–∞—Ç—å .json (–¥–∞–Ω–Ω—ã–µ)"}),e.jsx("button",{onClick:as,style:{width:"100%",padding:"0.6rem 1rem",background:"none",border:"none",color:"var(--text-primary)",textAlign:"left",cursor:"pointer",fontSize:"0.85rem"},children:"üìù –°–∫–∞—á–∞—Ç—å .md (Markdown)"})]})]}),e.jsx("button",{onClick:dr,disabled:Q,title:"–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ",style:{width:"36px",height:"36px",padding:0,backgroundColor:Q?"rgba(156, 39, 176, 0.2)":"var(--surface-strong)",color:Q?"#9c27b0":"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"8px",cursor:Q?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",animation:Q?"pulse 1.5s ease-in-out infinite":"none"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsx("button",{onClick:Bn,disabled:Z||ee||Q||R.length===0,title:"–£–ª—É—á—à–∏—Ç—å —Å AI",style:{width:"36px",height:"36px",padding:0,backgroundColor:Z?"rgba(156, 39, 176, 0.2)":"var(--surface-strong)",color:Z?"#9c27b0":(R.length===0,"var(--text-muted)"),border:"1px solid var(--border)",borderRadius:"8px",cursor:Z||ee||R.length===0?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",animation:Z?"pulse 1.5s ease-in-out infinite":"none",opacity:R.length===0?.5:1},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),e.jsx("path",{d:"M2 17l10 5 10-5"}),e.jsx("path",{d:"M2 12l10 5 10-5"})]})}),e.jsx("button",{onClick:Fn,disabled:ee||Z||Q||R.length===0,title:"–†–∞–∑–±–∏—Ç—å –ø–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º (AI)",style:{width:"36px",height:"36px",padding:0,backgroundColor:ee?"rgba(33, 150, 243, 0.2)":"var(--surface-strong)",color:ee?"#2196f3":(R.length===0,"var(--text-muted)"),border:"1px solid var(--border)",borderRadius:"8px",cursor:ee||Z||R.length===0?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",animation:ee?"pulse 1.5s ease-in-out infinite":"none",opacity:R.length===0?.5:1},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsx("button",{onClick:()=>dt(!0),title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",style:{width:"36px",height:"36px",padding:0,backgroundColor:"var(--surface-strong)",color:"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})}),e.jsx("button",{onClick:()=>{L(null),Ne([]),W(!1),Ht("dialogue")},title:"–ó–∞–∫—Ä—ã—Ç—å",style:{width:"36px",height:"36px",padding:0,backgroundColor:"var(--surface-strong)",color:"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:"‚úï"})]})]}),jn&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px",padding:"1.5rem",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0,0,0,0.4)"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"var(--text-primary)",fontSize:"1.1rem"},children:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?"}),e.jsxs("p",{style:{margin:"0 0 1.5rem",color:"var(--text-secondary)",fontSize:"0.9rem"},children:['–ó–∞–ø–∏—Å—å "',c?.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",'" –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.']}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>dt(!1),style:{padding:"0.6rem 1.2rem",backgroundColor:"var(--surface-strong)",color:"var(--text-primary)",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"0.9rem"},children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{onClick:Qn,style:{padding:"0.6rem 1.2rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.9rem"},children:"–£–¥–∞–ª–∏—Ç—å"})]})]})}),e.jsx(hs,{currentTime:Cr,playbackOffset:Lt,totalDuration:cs,isPlaying:!!k?.includes(c.id),waveformData:_,loading:Rr==="loading",error:Rr==="error"?kn||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ":null,channelLabels:["Mic","Sys"],onSeek:t=>{const r=w.current;if(!r)return;const o=r.duration||Tr||0,a=t-Te.current;if((a<0||a>o)&&c){const n=()=>{if(w.current){const d=Math.max(0,Math.min(w.current.duration||0,t));w.current.currentTime=d,ne(d)}w.current?.removeEventListener("loadedmetadata",n)};w.current?.addEventListener("loadedmetadata",n),Ze(c.id);return}const u=Math.max(0,Math.min(o,a));r.currentTime=u,ne(u)}})]}),Q&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(156, 39, 176, 0.1)",borderRadius:"6px",border:"1px solid #9c27b0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{animation:"pulse 1s infinite"},children:"üîÑ"}),e.jsx("span",{style:{color:"#9c27b0",fontWeight:"bold"},children:"–ü–æ–ª–Ω–∞—è —Ä–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"}),e.jsxs("span",{style:{color:"#888",fontSize:"0.85rem"},children:[Math.round(Br*100),"%"]}),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:Yn,title:V?"–û—Ç–º–µ–Ω–∞...":"–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",disabled:V,style:{padding:"0.25rem 0.5rem",backgroundColor:V?"rgba(244, 67, 54, 0.1)":"transparent",color:V?"#888":"#f44336",border:"1px solid",borderColor:V?"#666":"#f44336",borderRadius:"4px",cursor:V?"wait":"pointer",fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:V?.7:1},children:[V?e.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid #888",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),V?"–û—Ç–º–µ–Ω–∞...":"–û—Ç–º–µ–Ω–∞"]})]}),e.jsx("div",{style:{height:"6px",backgroundColor:"var(--surface-strong)",borderRadius:"3px",overflow:"hidden",marginBottom:"0.3rem"},children:e.jsx("div",{style:{width:`${Br*100}%`,height:"100%",backgroundColor:"#9c27b0",transition:"width 0.3s ease"}})}),Fr&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#888"},children:Fr})]}),Jr&&!Q&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(244, 67, 54, 0.1)",borderRadius:"6px",border:"1px solid rgba(244, 67, 54, 0.3)",color:"#f44336",fontSize:"0.85rem"},children:["‚ùå –û—à–∏–±–∫–∞: ",Jr]}),Z&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(156, 39, 176, 0.1)",borderRadius:"6px",border:"1px solid #9c27b0",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid #9c27b0",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("span",{style:{color:"#9c27b0",fontSize:"0.9rem"},children:"–£–ª—É—á—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é AI..."})]}),Ur&&!Z&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(244, 67, 54, 0.1)",borderRadius:"6px",border:"1px solid rgba(244, 67, 54, 0.3)",color:"#f44336",fontSize:"0.85rem"},children:["‚ùå –û—à–∏–±–∫–∞ AI: ",Ur]}),ee&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(33, 150, 243, 0.1)",borderRadius:"6px",border:"1px solid #2196f3",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid #2196f3",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("span",{style:{color:"#2196f3",fontSize:"0.9rem"},children:"–†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º —Å –ø–æ–º–æ—â—å—é AI..."})]}),Vr&&!ee&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"rgba(244, 67, 54, 0.1)",borderRadius:"6px",border:"1px solid rgba(244, 67, 54, 0.3)",color:"#f44336",fontSize:"0.85rem"},children:["‚ùå –û—à–∏–±–∫–∞ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏: ",Vr]}),O&&X.length>0&&!x&&e.jsx(xs,{activeTab:Me,onTabChange:Ht,hasSummary:!!O.summary,isGeneratingSummary:Or,isRecording:x,speakersCount:Le.length})]}),e.jsx("div",{ref:xe,style:{flex:1,padding:"1rem 1.5rem",overflowY:"auto",overflowX:"hidden",minWidth:0},onScroll:()=>{$&&Gr(!1)},children:X.length===0&&!x&&!c?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"2rem",textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:"2.5rem"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"24px",background:"linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem",boxShadow:"var(--shadow-glow-primary)"},children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),e.jsx("h1",{style:{fontSize:"1.75rem",fontWeight:700,color:"var(--text-primary)",margin:"0 0 0.5rem",letterSpacing:"-0.02em"},children:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AIWisper"}),e.jsx("p",{style:{fontSize:"1rem",color:"var(--text-secondary)",margin:0,maxWidth:"400px"},children:"–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –≥–æ–≤–æ—Ä—è—â–∏—Ö"})]}),e.jsxs("div",{style:{background:"var(--surface)",borderRadius:"var(--radius-xl)",padding:"1.5rem",width:"100%",maxWidth:"420px",border:"1px solid var(--glass-border-subtle)"},children:[e.jsx("h3",{style:{fontSize:"0.9rem",fontWeight:600,color:"var(--text-secondary)",margin:"0 0 1rem",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç"}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"1rem",marginBottom:"1rem",textAlign:"left"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",fontWeight:700,flexShrink:0},children:"1"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem"},children:"–ù–∞–∂–º–∏—Ç–µ ¬´–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å¬ª"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:"–ö–Ω–æ–ø–∫–∞ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∑–∞–ø–∏—Å—å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∑–≤—É–∫–∞"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"1rem",marginBottom:"1rem",textAlign:"left"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",fontWeight:700,flexShrink:0},children:"2"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem"},children:"–ì–æ–≤–æ—Ä–∏—Ç–µ –∏–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–π—Ç–µ –∞—É–¥–∏–æ"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:"AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç —Ä–µ—á—å –ø–æ –≥–æ–≤–æ—Ä—è—â–∏–º"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"1rem",textAlign:"left"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",fontWeight:700,flexShrink:0},children:"3"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem"},children:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–µ–∫—Å—Ç"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å —Ç–∞–π–º–∫–æ–¥–∞–º–∏ –∏ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É"})]})]})]}),e.jsx("div",{onDragOver:on,onDragEnter:an,onDragLeave:ln,onDrop:dn,style:{marginTop:"1.5rem",padding:"1.25rem 2rem",border:`2px dashed ${he?"var(--primary)":"var(--glass-border)"}`,borderRadius:"var(--radius-xl)",background:he?"rgba(139, 92, 246, 0.1)":"var(--surface)",textAlign:"center",transition:"all 0.2s ease",width:"100%",maxWidth:"420px",cursor:"pointer",transform:he?"scale(1.02)":"scale(1)"},children:vt?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.75rem"},children:_n||"–ò–¥–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–∏–µ"}),e.jsx("div",{style:{width:"100%",height:"4px",background:"var(--glass-border)",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{width:"30%",height:"100%",background:"linear-gradient(90deg, var(--primary), var(--primary-dark))",borderRadius:"2px",animation:"importProgress 1.5s ease-in-out infinite"}})}),e.jsx("style",{children:`
                                                @keyframes importProgress {
                                                    0% { transform: translateX(-100%); }
                                                    100% { transform: translateX(400%); }
                                                }
                                            `})]}):e.jsx("div",{style:{fontSize:"0.95rem",color:he?"var(--primary)":"var(--text-muted)",fontWeight:he?600:400},children:he?"–û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞":"–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ MP3, WAV, M4A, OGG –∏–ª–∏ FLAC"})})]}):X.length===0&&x?e.jsxs("div",{style:{color:"var(--text-muted)",textAlign:"center",marginTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üî¥"}),e.jsx("div",{children:"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å... –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"})]}):X.length===0&&c?e.jsxs("div",{style:{color:"var(--text-muted)",textAlign:"center",marginTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üì≠"}),e.jsx("div",{children:"–≠—Ç–∞ –∑–∞–ø–∏—Å—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏"}),e.jsx("div",{style:{fontSize:"0.85rem",marginTop:"0.5rem",opacity:.7},children:"–í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–ø–∏—Å—å –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞–Ω–∫–æ–≤"})]}):e.jsxs(e.Fragment,{children:[Me==="dialogue"&&e.jsx(e.Fragment,{children:R.length>0?e.jsxs("div",{ref:Wn,style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"var(--surface)",borderRadius:"8px",lineHeight:"1.9",fontSize:"0.95rem",position:"relative",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h4",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.9rem"},children:"–î–∏–∞–ª–æ–≥"}),$&&e.jsx("button",{onClick:()=>Gr(!ye),style:{padding:"4px 8px",fontSize:"0.75rem",backgroundColor:ye?"var(--primary)":"transparent",color:ye?"white":"var(--text-muted)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},title:ye?"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–∫–ª—é—á—ë–Ω":"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤—ã–∫–ª—é—á–µ–Ω",children:ye?"üìç –°–ª–µ–¥–∏—Ç—å":"üìç –ù–µ —Å–ª–µ–¥–∏—Ç—å"})]}),R.map((t,r)=>{const{name:o,color:a}=P(t.speaker),i=t.start,u=Math.floor(i/6e4),n=Math.floor(i%6e4/1e3),d=Math.floor(i%1e3/100),g=`${u.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}.${d}`,p=r===Rt;return e.jsxs("div",{ref:f=>us(r,f),onClick:()=>ps(t.start),style:{marginBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.25rem",paddingBottom:"0.25rem",borderLeft:`3px solid ${p?"var(--primary)":a}`,backgroundColor:p?"rgba(138, 43, 226, 0.15)":"transparent",borderRadius:p?"0 4px 4px 0":"0",transition:"all 0.2s ease",cursor:"pointer",position:"relative"},children:[p&&e.jsx("div",{style:{position:"absolute",left:"-3px",top:0,bottom:0,width:"3px",backgroundColor:"var(--primary)",boxShadow:"0 0 8px var(--primary)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsxs("span",{style:{color:p?"var(--primary)":"var(--text-muted)",fontSize:"0.8rem",fontFamily:"monospace",fontWeight:p?"bold":"normal"},children:["[",g,"]"]})," ",e.jsxs("span",{style:{color:a,fontWeight:"bold"},children:[o,":"]})," ",e.jsx("span",{style:{color:"var(--text-primary)",wordBreak:"break-word"},children:t.text})]},r)})]}):e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"var(--surface)",borderRadius:"8px",lineHeight:"1.8",fontSize:"0.95rem"},children:[X.filter(t=>t.status==="completed").sort((t,r)=>t.index-r.index).map(t=>t.micText||t.sysText?e.jsxs("div",{style:{marginBottom:"1rem"},children:[t.micText&&e.jsxs("div",{style:{marginBottom:"0.5rem",borderLeft:"3px solid #4caf50",paddingLeft:"0.75rem",backgroundColor:"rgba(76, 175, 80, 0.05)",padding:"0.4rem 0.75rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold",fontSize:"0.85rem"},children:"–í—ã: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t.micText})]}),t.sysText&&e.jsxs("div",{style:{borderLeft:"3px solid #2196f3",paddingLeft:"0.75rem",backgroundColor:"rgba(33, 150, 243, 0.05)",padding:"0.4rem 0.75rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#2196f3",fontWeight:"bold",fontSize:"0.85rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t.sysText})]})]},t.id):t.transcription?e.jsx("div",{style:{marginBottom:"0.8rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.03)",borderRadius:"4px",color:"#ccc"},children:t.transcription},t.id):null),X.filter(t=>t.status==="completed").length===0&&e.jsx("div",{style:{color:"#666",textAlign:"center",padding:"2rem"},children:"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è..."})]})}),Me==="chunks"&&e.jsxs("div",{style:{fontSize:"0.85rem"},children:[e.jsxs("h4",{style:{margin:"0 0 0.75rem 0",color:"#888"},children:["–ß–∞–Ω–∫–∏ (",X.length,")"]}),X.map(t=>{const r=O?`${ae}/api/sessions/${O.id}/chunk/${t.index}.mp3`:"",o=k===r,a=wn===t.id,i=Cn===t.id||t.status==="transcribing";return e.jsxs("div",{style:{padding:"0.6rem 0.8rem",marginBottom:"0.4rem",backgroundColor:i?"#2a2a1a":a?"#1a3a2a":"#12121f",borderRadius:"4px",borderLeft:`3px solid ${t.status==="completed"?"#4caf50":t.status==="failed"?"#f44336":"#ff9800"}`,transition:"background-color 0.3s ease",animation:i?"transcribing-pulse 1s ease-in-out infinite":a?"highlight-pulse 0.5s ease-in-out 2":"none"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{color:"#888"},children:["#",t.index," ‚Ä¢ ",(t.duration/1e9).toFixed(1),"s ‚Ä¢",e.jsx("span",{style:{marginLeft:"0.3rem",color:t.status==="completed"?"#4caf50":t.status==="failed"?"#f44336":"#ff9800"},children:t.status==="completed"?"‚úì":t.status==="failed"?"‚úó":"‚è≥"}),t.processingTime&&t.processingTime>0&&e.jsxs("span",{style:{marginLeft:"0.3rem",color:"#9c27b0",fontSize:"0.75rem"},title:"Real-Time Factor (—Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏)",children:[(t.duration/1e9/(t.processingTime/1e3)).toFixed(1),"x"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.3rem"},children:[O&&e.jsx("button",{onClick:()=>rs(O.id,t.index),style:{padding:"0.15rem 0.4rem",fontSize:"0.7rem",backgroundColor:o?"#f44336":"#2196f3",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},children:o?"‚èπ":"‚ñ∂"}),c&&(t.status==="completed"||t.status==="transcribing"||t.status==="failed")&&e.jsx("button",{onClick:()=>Pn(t.id),title:"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",style:{padding:"0.15rem 0.4rem",fontSize:"0.7rem",backgroundColor:"#333",border:"none",borderRadius:"3px",color:"#888",cursor:"pointer"},children:"üîÑ"})]})]}),t.dialogue&&t.dialogue.length>0?e.jsx("div",{style:{marginTop:"0.4rem",lineHeight:"1.7"},children:t.dialogue.map((u,n)=>{const{name:d,color:g}=P(u.speaker),p=u.start,f=Math.floor(p/6e4),A=Math.floor(p%6e4/1e3),gr=Math.floor(p%1e3/100),hr=`${f.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}.${gr}`;return e.jsxs("div",{style:{marginBottom:"0.3rem",paddingLeft:"0.4rem",borderLeft:`2px solid ${g}`},children:[e.jsxs("span",{style:{color:"#666",fontSize:"0.7rem",fontFamily:"monospace"},children:["[",hr,"]"]})," ",e.jsxs("span",{style:{color:g,fontSize:"0.8rem",fontWeight:"bold"},children:[d,":"]})," ",e.jsx("span",{style:{color:"#ccc"},children:u.text})]},n)})}):t.micText||t.sysText?e.jsxs("div",{style:{marginTop:"0.4rem",lineHeight:"1.5"},children:[t.micText&&e.jsxs("div",{style:{color:"#4caf50",marginBottom:"0.3rem"},children:[e.jsx("span",{style:{color:"#888",fontSize:"0.8rem"},children:"–í—ã: "}),t.micText]}),t.sysText&&e.jsxs("div",{style:{color:"#2196f3"},children:[e.jsx("span",{style:{color:"#888",fontSize:"0.8rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),t.sysText]})]}):t.transcription&&e.jsx("div",{style:{marginTop:"0.4rem",color:"#ccc",lineHeight:"1.5"},children:t.transcription}),i&&e.jsxs("div",{style:{marginTop:"0.4rem",color:"#ff9800",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{animation:"pulse 1s infinite"},children:"‚è≥"})," –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è..."]}),t.error&&e.jsxs("div",{style:{marginTop:"0.4rem",color:"#f44336",fontSize:"0.8rem"},children:["–û—à–∏–±–∫–∞: ",t.error]})]},t.id)})]}),Me==="speakers"&&O&&e.jsx(ys,{sessionId:O.id,speakers:Le,onRename:Hn,onPlaySample:Kn,onStopSample:ar,playingSpeakerId:fn}),Me==="summary"&&O&&e.jsx(bs,{summary:O.summary||null,isGenerating:Or,error:Tn,onGenerate:lr,hasTranscription:X.some(t=>t.status==="completed"&&(t.transcription||t.micText||t.sysText||t.dialogue?.length)),sessionDate:O.startTime,ollamaModel:E}),Me==="stats"&&O&&e.jsx(vs,{dialogue:R,totalDuration:O.totalDuration/1e6})]})})]})]}),e.jsx("style",{children:`
                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.5; }
                    }
                    @keyframes highlight-pulse {
                        0% { background-color: #12121f; }
                        50% { background-color: #2a4a3a; }
                        100% { background-color: #1a3a2a; }
                    }
                    @keyframes transcribing-pulse {
                        0%, 100% { background-color: #2a2a1a; }
                        50% { background-color: #3a3a2a; }
                    }
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                `}),e.jsx(Ss,{micLevel:k?vn:G,sysLevel:k?Sn:M,isActive:x||!!k})]}),e.jsxs("footer",{style:{height:Ue?"150px":"32px",borderTop:"1px solid #333",backgroundColor:"#0a0a14",transition:"height 0.2s ease-out",overflow:"hidden",flexShrink:0},children:[e.jsxs("div",{onClick:()=>Dn(!Ue),style:{padding:"0.3rem 1rem",backgroundColor:"#12121f",fontSize:"0.75rem",color:"#666",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",userSelect:"none"},children:[e.jsxs("span",{children:[Ue?"‚ñº":"‚ñ∂"," Console",!Ue&&h.length>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",color:"#444"},children:["‚Äî ",h[0]?.substring(0,50),h[0]?.length>50?"...":""]})]}),e.jsxs("span",{style:{fontSize:"0.65rem",color:"#444"},children:[h.length," –∑–∞–ø–∏—Å–µ–π"]})]}),Ue&&e.jsx("div",{style:{padding:"0.5rem 1rem",overflowY:"auto",height:"calc(100% - 28px)",fontSize:"0.7rem",fontFamily:"monospace"},children:h.map((t,r)=>e.jsx("div",{style:{color:"#555"},children:t},r))})]}),Ut&&e.jsx(ks,{models:I,activeModelId:T,onDownload:t=>{m.current?.send(JSON.stringify({type:"download_model",modelId:t}))},onCancelDownload:t=>{m.current?.send(JSON.stringify({type:"cancel_download",modelId:t}))},onDelete:t=>{confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –º–æ–¥–µ–ª—å?")&&m.current?.send(JSON.stringify({type:"delete_model",modelId:t}))},onSetActive:t=>{m.current?.send(JSON.stringify({type:"set_active_model",modelId:t}))},onClose:()=>fe(!1)}),un&&e.jsx($s,{sessionIds:Array.from(ke),onClose:()=>$t(!1),onExportComplete:()=>{$t(!1),tt(new Set)}}),e.jsx(js,{isOpen:ls,onClose:()=>Ct(!1),initialTab:ds,appVersion:"1.35.0"}),mr&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>wt(!1),children:e.jsxs("div",{style:{background:"var(--surface-strong)",borderRadius:"16px",border:"1px solid var(--border)",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.2rem",fontWeight:600},children:"‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏"}),e.jsx("button",{onClick:()=>wt(!1),style:{background:"transparent",border:"none",color:"var(--text-muted)",fontSize:"1.5rem",cursor:"pointer",padding:"4px 8px",lineHeight:1},children:"√ó"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px",fontWeight:500},children:"–ù–∞–≤–∏–≥–∞—Ü–∏—è"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[e.jsx(K,{keys:["‚Üë","‚Üì"],description:"–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏"}),e.jsx(K,{keys:["‚åò","1-9"],description:"–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞–ø–∏—Å–∏ –ø–æ –Ω–æ–º–µ—Ä—É"}),e.jsx(K,{keys:["‚åò","F"],description:"–§–æ–∫—É—Å –Ω–∞ –ø–æ–∏—Å–∫–µ"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px",fontWeight:500},children:"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[e.jsx(K,{keys:["Space"],description:"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ / –ü–∞—É–∑–∞"}),e.jsx(K,{keys:["‚Üê"],description:"–ü–µ—Ä–µ–º–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥ –Ω–∞ 5 —Å–µ–∫"}),e.jsx(K,{keys:["‚Üí"],description:"–ü–µ—Ä–µ–º–æ—Ç–∫–∞ –≤–ø–µ—Ä—ë–¥ –Ω–∞ 5 —Å–µ–∫"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px",fontWeight:500},children:"–ó–∞–ø–∏—Å—å"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:e.jsx(K,{keys:["R"],description:"–ù–∞—á–∞—Ç—å / –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å"})})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px",fontWeight:500},children:"–≠–∫—Å–ø–æ—Ä—Ç"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[e.jsx(K,{keys:["‚åò","S"],description:"–°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT"}),e.jsx(K,{keys:["‚åò","E"],description:"–ú–µ–Ω—é —ç–∫—Å–ø–æ—Ä—Ç–∞"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px",fontWeight:500},children:"–û–±—â–∏–µ"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[e.jsx(K,{keys:["?"],description:"–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"}),e.jsx(K,{keys:["Esc"],description:"–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞"})]})]})]}),e.jsxs("div",{style:{marginTop:"20px",paddingTop:"16px",borderTop:"1px solid var(--border)",fontSize:"0.75rem",color:"var(--text-muted)",textAlign:"center"},children:["–ù–∞–∂–º–∏—Ç–µ ",e.jsx("kbd",{style:{padding:"2px 6px",background:"var(--glass-bg)",borderRadius:"4px",border:"1px solid var(--border)"},children:"Esc"})," –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –≤–Ω–µ –æ–∫–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è"]})]})})]})}const K=({keys:h,description:S})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:S}),e.jsx("div",{style:{display:"flex",gap:"4px"},children:h.map((b,v)=>e.jsx("kbd",{style:{padding:"3px 8px",background:"var(--glass-bg)",borderRadius:"6px",border:"1px solid var(--border)",fontSize:"0.8rem",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:500,color:"var(--text-primary)",minWidth:"24px",textAlign:"center"},children:b},v))})]}),$s=({sessionIds:h,onClose:S,onExportComplete:b})=>{const[v,y]=s.useState("txt"),[j,m]=s.useState(!1),G=async()=>{m(!0);try{const M=await fetch(`http://localhost:${xr.AIWISPER_HTTP_PORT||18080}/api/export/batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionIds:h,format:v})});if(!M.ok)throw new Error("Export failed");const _e=await M.blob(),x=window.URL.createObjectURL(_e),z=document.createElement("a");z.href=x,z.download=`aiwisper-export-${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(x),b()}catch(M){console.error("Batch export failed:",M),alert("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.")}finally{m(!1)}},te=[{id:"txt",label:"–¢–µ–∫—Å—Ç (.txt)",icon:"üìù"},{id:"srt",label:"–°—É–±—Ç–∏—Ç—Ä—ã (.srt)",icon:"üé¨"},{id:"vtt",label:"WebVTT (.vtt)",icon:"üåê"},{id:"json",label:"JSON (.json)",icon:"üìä"},{id:"md",label:"Markdown (.md)",icon:"üìÑ"}];return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:S,children:e.jsxs("div",{style:{background:"var(--surface-strong)",borderRadius:"16px",border:"1px solid var(--border)",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)"},onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.2rem",fontWeight:600},children:"üì¶ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–ø–∏—Å–µ–π"}),e.jsx("button",{onClick:S,style:{background:"transparent",border:"none",color:"var(--text-muted)",fontSize:"1.5rem",cursor:"pointer",padding:"4px 8px",lineHeight:1},children:"√ó"})]}),e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginBottom:"16px"},children:["–í—ã–±—Ä–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: ",e.jsx("strong",{children:h.length})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"var(--text-muted)",marginBottom:"8px"},children:"–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:te.map(M=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 12px",background:v===M.id?"rgba(139, 92, 246, 0.15)":"var(--glass-bg)",borderRadius:"8px",border:v===M.id?"1px solid var(--primary)":"1px solid transparent",cursor:"pointer",transition:"all 0.15s ease"},children:[e.jsx("input",{type:"radio",name:"format",value:M.id,checked:v===M.id,onChange:()=>y(M.id),style:{accentColor:"var(--primary)"}}),e.jsx("span",{style:{fontSize:"1.1rem"},children:M.icon}),e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-primary)"},children:M.label})]},M.id))})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:S,style:{padding:"10px 20px",background:"transparent",border:"1px solid var(--border)",borderRadius:"8px",color:"var(--text-secondary)",cursor:"pointer",fontSize:"0.9rem"},children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{onClick:G,disabled:j,style:{padding:"10px 20px",background:"var(--primary)",border:"none",borderRadius:"8px",color:"white",cursor:j?"wait":"pointer",fontSize:"0.9rem",fontWeight:500,opacity:j?.7:1},children:j?"‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...":"üì• –°–∫–∞—á–∞—Ç—å ZIP"})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:"16px",textAlign:"center"},children:"üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ‚åò+Click –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π"})]})})};export{Os as default};
