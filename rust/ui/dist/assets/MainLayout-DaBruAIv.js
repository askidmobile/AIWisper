import{r,j as e,_ as bt,a as ir}from"./index-Br3NuR-L.js";import{u as de,j as fe,a as De,g as ar,f as Je,b as lr,W as dr,k as vt,d as cr,i as ut,e as ur,h as pr,A as mr,M as gr,c as hr,H as fr}from"./AudioMeterSidebar-CNcLsAB7.js";import{invoke as Ve}from"./core-DhEqZVGG.js";const St=r.createContext(null),an=({children:t})=>{const{sendMessage:n,subscribe:s,isConnected:o}=de(),[c,y]=r.useState([]),[u,a]=r.useState(null),[l,p]=r.useState(!1),[h,d]=r.useState([]),[i,g]=r.useState(null),[v,w]=r.useState(!1),C=r.useRef(!1);r.useEffect(()=>{if(!o||C.current)return;C.current=!0,(async()=>{try{const m=await n({type:"get_settings"});console.log("[Model] Loaded settings from backend:",m);const k=m?.whisperModel||m?.whisper_model;k&&(console.log("[Model] Setting active model from backend settings:",k),a(k))}catch(m){console.error("[Model] Failed to load settings:",m)}})()},[o,n]),r.useEffect(()=>{console.log("[Model] isConnected changed to:",o),o&&(async()=>{console.log("[Model] Fetching models...");try{const m=await n({type:"get_models"});console.log("[Model] Result from sendMessage:",m),console.log("[Model] Result type:",typeof m),console.log("[Model] Result keys:",m?Object.keys(m):"null"),m&&m.models?(console.log("[Model] Setting models from direct result:",m.models.length,"models"),console.log("[Model] Downloaded models:",m.models.filter(k=>k.status==="downloaded").map(k=>k.id)),y(m.models)):console.warn("[Model] No models in result, result was:",m)}catch(m){console.error("[Model] Error fetching models:",m)}})()},[o,n]),r.useEffect(()=>{if(!o||c.length===0||!u)return;const f=c.find(m=>m.id===u);f&&(f.status==="downloaded"||f.status==="active")&&(console.log("[Model] Confirming active model with backend:",u),n({type:"set_active_model",modelId:u}))},[o,c]),r.useEffect(()=>{o||p(!1)},[o]),r.useEffect(()=>{const f=s("models_list",M=>{console.log("[Model] models_list event received:",M),console.log("[Model] Downloaded models from event:",(M.models||[]).filter(I=>I.status==="downloaded").map(I=>I.id)),y(M.models||[]);const U=(M.models||[]).find(I=>I.status==="active");U&&(console.log("[Model] Backend confirmed active model from models_list:",U.id),p(!0),a(U.id))}),m=s("model_progress",M=>{y(U=>U.map(I=>I.id===M.modelId?{...I,status:M.data,progress:M.progress,error:M.error}:I))}),k=s("active_model_changed",M=>{console.log("[Model] Backend confirmed active model changed:",M.modelId),p(!0),a(M.modelId)}),L=s("model_deleted",()=>n({type:"get_models"})),B=s("ollama_models",M=>{w(!1),M.error?(g(M.error),d([])):(g(null),d(M.ollamaModels||[]))});return()=>{f(),m(),k(),L(),B()}},[s,n]);const T=f=>n({type:"download_model",modelId:f}),j=f=>n({type:"cancel_download",modelId:f}),A=f=>n({type:"delete_model",modelId:f}),z=f=>{n({type:"set_active_model",modelId:f})},b=async f=>{w(!0),g(null);try{const m=await n({type:"get_ollama_models",url:f});if(m&&Array.isArray(m)){const k=m.map(L=>({name:L.name||L.id,size:L.sizeBytes||L.size||0,isCloud:!1,family:"",parameters:""}));d(k)}}catch(m){g(m.message||"Failed to fetch Ollama models")}finally{w(!1)}};return e.jsx(St.Provider,{value:{models:c,activeModelId:u,backendModelConfirmed:l,ollamaModels:h,ollamaError:i,ollamaModelsLoading:v,downloadModel:T,cancelDownload:j,deleteModel:A,setActiveModel:z,fetchOllamaModels:b},children:t})},ot=()=>{const t=r.useContext(St);if(!t)throw new Error("useModelContext must be used within a ModelProvider");return t},xr=typeof window<"u"&&window.require?window.require("electron"):null,He=xr?.ipcRenderer,rt=()=>"__TAURI__"in window;let Me=null;rt()&&bt(()=>import("./core-DhEqZVGG.js"),[],import.meta.url).then(t=>{Me=t.invoke});const pt={language:"ru",modelId:"ggml-large-v3-turbo",micDevice:"",captureSystem:!0,useVoiceIsolation:!1,echoCancel:.4,vadMode:"auto",vadMethod:"auto",pauseThreshold:.5,enableStreaming:!1,streamingChunkSeconds:15,streamingConfirmationThreshold:.85,ollamaModel:"llama3.2",ollamaUrl:"http://localhost:11434",ollamaContextSize:8,theme:"dark",diarizationEnabled:!1,diarizationSegModelId:"",diarizationEmbModelId:"",diarizationProvider:"auto",showSessionStats:!0,hybridTranscription:{enabled:!1,secondaryModelId:"",confidenceThreshold:.7,contextWords:3,useLLMForMerge:!1,mode:"parallel"}},yr=()=>{const[t,n]=r.useState(pt),[s,o]=r.useState(!1);r.useEffect(()=>{(async()=>{if(rt()){try{let h=0;for(;!Me&&h<50;)await new Promise(d=>setTimeout(d,100)),h++;if(Me){const d=await Me("load_ui_settings");console.log("[useSettings] Loaded from Tauri:",d),d&&n(i=>({...i,...d}))}else console.warn("[useSettings] Tauri invoke not available, using defaults")}catch(p){console.error("[useSettings] Failed to load settings from Tauri:",p)}o(!0);return}if(He){try{const p=await He.invoke("load-settings");p&&n(h=>({...h,...p})),o(!0)}catch(p){console.error("Failed to load settings:",p),o(!0)}return}try{const p=localStorage.getItem("aiwisper_settings");if(p){const h=JSON.parse(p);n(d=>({...d,...h}))}}catch(p){console.error("Failed to load settings from localStorage:",p)}o(!0)})()},[]),r.useEffect(()=>{if(!s)return;(async()=>{if(rt()){try{Me&&(await Me("save_ui_settings",{settings:t}),console.log("[useSettings] Saved to Tauri"))}catch(p){console.error("[useSettings] Failed to save settings to Tauri:",p)}return}if(He){try{await He.invoke("save-settings",t)}catch(p){console.error("Failed to save settings:",p)}return}try{localStorage.setItem("aiwisper_settings",JSON.stringify(t))}catch(p){console.error("Failed to save settings to localStorage:",p)}})()},[t,s]),r.useEffect(()=>{let l=t.theme;t.theme==="system"&&(l=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme",l),document.body.setAttribute("data-theme",l)},[t.theme]);const c=r.useCallback((l,p)=>{n(h=>({...h,[l]:p}))},[]),y=r.useCallback(l=>{n(p=>({...p,...l}))},[]),u=r.useCallback(()=>{n(pt)},[]),a=r.useCallback(()=>{n(l=>({...l,theme:l.theme==="dark"?"light":"dark"}))},[]);return{settings:t,isLoaded:s,updateSetting:c,updateSettings:y,resetSettings:u,toggleTheme:a,language:t.language,setLanguage:l=>c("language",l),theme:t.theme,setTheme:l=>c("theme",l),micDevice:t.micDevice,setMicDevice:l=>c("micDevice",l),captureSystem:t.captureSystem,setCaptureSystem:l=>c("captureSystem",l),useVoiceIsolation:t.useVoiceIsolation,setUseVoiceIsolation:l=>c("useVoiceIsolation",l),echoCancel:t.echoCancel,setEchoCancel:l=>c("echoCancel",l),pauseThreshold:t.pauseThreshold,setPauseThreshold:l=>c("pauseThreshold",l),enableStreaming:t.enableStreaming,setEnableStreaming:l=>c("enableStreaming",l),streamingChunkSeconds:t.streamingChunkSeconds,setStreamingChunkSeconds:l=>c("streamingChunkSeconds",l),streamingConfirmationThreshold:t.streamingConfirmationThreshold,setStreamingConfirmationThreshold:l=>c("streamingConfirmationThreshold",l),ollamaModel:t.ollamaModel,setOllamaModel:l=>c("ollamaModel",l),ollamaUrl:t.ollamaUrl,setOllamaUrl:l=>c("ollamaUrl",l),ollamaContextSize:t.ollamaContextSize,setOllamaContextSize:l=>c("ollamaContextSize",l),hybridTranscription:t.hybridTranscription,setHybridTranscription:l=>c("hybridTranscription",l)}},jt=r.createContext(null),ln=({children:t})=>{const n=yr(),s={...n,vadMode:n.settings.vadMode,setVADMode:o=>n.updateSetting("vadMode",o),vadMethod:n.settings.vadMethod,setVADMethod:o=>n.updateSetting("vadMethod",o),showSessionStats:n.settings.showSessionStats,setShowSessionStats:o=>n.updateSetting("showSessionStats",o)};return e.jsx(jt.Provider,{value:s,children:t})},kt=()=>{const t=r.useContext(jt);if(!t)throw new Error("useSettingsContext must be used within a SettingsProvider");return t},br=typeof window<"u"&&window.require?window.require("electron"):null,_e=br?.ipcRenderer,nt="aiwisper_settings",wt=r.createContext(null),vr=async()=>{try{let t=null;if(_e)t=await _e.invoke("load-settings");else{const n=localStorage.getItem(nt);n&&(t=JSON.parse(n))}if(t&&t.diarizationEnabled!==void 0)return{enabled:t.diarizationEnabled,segModelId:t.diarizationSegModelId||"",embModelId:t.diarizationEmbModelId||"",provider:t.diarizationProvider||"auto"}}catch(t){console.error("Failed to load diarization settings:",t)}return null},Qe=async t=>{try{let n={};if(_e){n=await _e.invoke("load-settings")||{};const s={...n,diarizationEnabled:t.enabled,diarizationSegModelId:t.segModelId,diarizationEmbModelId:t.embModelId,diarizationProvider:t.provider};await _e.invoke("save-settings",s)}else{const s=localStorage.getItem(nt);s&&(n=JSON.parse(s));const o={...n,diarizationEnabled:t.enabled,diarizationSegModelId:t.segModelId,diarizationEmbModelId:t.embModelId,diarizationProvider:t.provider};localStorage.setItem(nt,JSON.stringify(o))}}catch(n){console.error("Failed to save diarization settings:",n)}},dn=({children:t})=>{const{sendMessage:n,subscribe:s,isConnected:o}=de(),{models:c,downloadModel:y,backendModelConfirmed:u,activeModelId:a}=ot(),[l,p]=r.useState({enabled:!1,provider:""}),[h,d]=r.useState(!1),[i,g]=r.useState(null),[v,w]=r.useState(null),C=r.useRef(!1),T=r.useRef(!1),j=c.filter(m=>m.engine==="diarization"&&m.diarizationType==="segmentation"),A=c.filter(m=>m.engine==="diarization"&&m.diarizationType==="embedding");r.useEffect(()=>{T.current||(T.current=!0,vr().then(m=>{console.log("[Diarization] Loaded settings:",m),w(m)}))},[]),r.useEffect(()=>{o?n({type:"get_diarization_status"}):C.current=!1},[o,n]),r.useEffect(()=>{if(!o||C.current||!v)return;if(console.log("[Diarization] Auto-enable check:",{isConnected:o,autoEnableAttempted:C.current,savedSettingsEnabled:v?.enabled,provider:v?.provider,modelsCount:c.length,backendModelConfirmed:u,activeModelId:a}),!v.enabled){console.log("[Diarization] Auto-enable skipped: savedSettings.enabled is false");return}if(v.provider==="coreml"){C.current=!0,console.log("[Diarization] Auto-enabling FluidAudio (coreml)..."),d(!0),g(null),n({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"});return}if(c.length===0){console.log("[Diarization] Auto-enable waiting: models not loaded yet");return}const m=c.find(L=>L.id===v.segModelId),k=c.find(L=>L.id===v.embModelId);if(console.log("[Diarization] Models found:",{segModel:m?{id:m.id,status:m.status,path:m.path}:null,embModel:k?{id:k.id,status:k.status,path:k.path}:null}),!m||!k){console.log("[Diarization] Auto-enable skipped: models not found");return}if(m.status!=="downloaded"&&m.status!=="active"){console.log("[Diarization] Auto-enable skipped: segModel not downloaded");return}if(k.status!=="downloaded"&&k.status!=="active"){console.log("[Diarization] Auto-enable skipped: embModel not downloaded");return}if(!m.path||!k.path){console.log("[Diarization] Auto-enable skipped: model paths missing");return}C.current=!0,console.log("[Diarization] Auto-enabling with settings:",v),d(!0),g(null),n({type:"enable_diarization",segmentationModelPath:m.path,embeddingModelPath:k.path,diarizationProvider:v.provider})},[o,v,c,n,u,a]),r.useEffect(()=>{const m=s("diarization_enabled",M=>{console.log("[Diarization] Enabled successfully:",M.diarizationProvider),p({enabled:!0,provider:M.diarizationProvider||"cpu"}),d(!1),g(null)}),k=s("diarization_disabled",()=>{p({enabled:!1,provider:""}),d(!1)}),L=s("diarization_status",M=>{console.log("[Diarization] Status received:",{enabled:M.diarizationEnabled,provider:M.diarizationProvider}),p({enabled:M.diarizationEnabled||!1,provider:M.diarizationProvider||""})}),B=s("diarization_error",M=>{console.error("[Diarization] Error from backend:",M.error),g(M.error||"–û—à–∏–±–∫–∞ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏"),d(!1)});return()=>{m(),k(),L(),B()}},[s]);const z=r.useCallback((m,k,L="auto")=>{if(d(!0),g(null),L==="coreml"){console.log("[Diarization] Enabling FluidAudio (coreml)...");const I={enabled:!0,segModelId:"",embModelId:"",provider:"coreml"};Qe(I),w(I),n({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"});return}const B=j.find(I=>I.id===m),M=A.find(I=>I.id===k);if(!B||!M){g("–ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),d(!1);return}if(B.status!=="downloaded"&&B.status!=="active"){g("–°–Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏"),y(m),d(!1);return}if(M.status!=="downloaded"&&M.status!=="active"){g("–°–Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤"),y(k),d(!1);return}if(!B.path||!M.path){g("–ü—É—Ç–∏ –∫ –º–æ–¥–µ–ª—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),d(!1);return}const U={enabled:!0,segModelId:m,embModelId:k,provider:L};Qe(U),w(U),n({type:"enable_diarization",segmentationModelPath:B.path,embeddingModelPath:M.path,diarizationProvider:L})},[j,A,n,y]),b=r.useCallback(()=>{if(d(!0),v){const m={...v,enabled:!1};Qe(m),w(m)}n({type:"disable_diarization"})},[n,v]),f=r.useCallback(()=>{n({type:"get_diarization_status"})},[n]);return e.jsx(wt.Provider,{value:{status:l,isLoading:h,error:i,segmentationModels:j,embeddingModels:A,savedSettings:v,enableDiarization:z,disableDiarization:b,refreshStatus:f},children:t})},Sr=()=>{const t=r.useContext(wt);if(!t)throw new Error("useDiarizationContext must be used within a DiarizationProvider");return t},jr=r.createContext(null),cn=({children:t})=>{const[n,s]=r.useState(0),[o,c]=r.useState(0),[y,u]=r.useState(0),[a,l]=r.useState(0),p=r.useRef(null),h=r.useRef(null),d=r.useRef(null),i=r.useRef(null),g=r.useRef(null),v=r.useRef(null),[w,C]=r.useState(!1),T=r.useCallback((b=800,f=150,m=.3)=>{try{const k=new(window.AudioContext||window.webkitAudioContext),L=k.createOscillator(),B=k.createGain();L.connect(B),B.connect(k.destination),L.frequency.value=b,L.type="sine",B.gain.setValueAtTime(m,k.currentTime),B.gain.exponentialRampToValueAtTime(.01,k.currentTime+f/1e3),L.start(k.currentTime),L.stop(k.currentTime+f/1e3),setTimeout(()=>k.close(),f+100)}catch(k){console.error("[AudioContext] Failed to play beep:",k)}},[]),j=r.useCallback(b=>{try{p.current||(p.current=new(window.AudioContext||window.webkitAudioContext));const f=p.current;if(i.current)try{i.current.disconnect()}catch{}i.current=f.createMediaElementSource(b),g.current=f.createChannelSplitter(2),h.current=f.createAnalyser(),d.current=f.createAnalyser(),h.current.fftSize=256,d.current.fftSize=256,i.current.connect(g.current),g.current.connect(h.current,0),g.current.connect(d.current,1),i.current.connect(f.destination),C(!0),z(),console.log("[AudioContext] Analysers connected")}catch(f){console.error("[AudioContext] Failed to connect analysers:",f)}},[]),A=r.useCallback(()=>{if(v.current&&(cancelAnimationFrame(v.current),v.current=null),i.current){try{i.current.disconnect()}catch{}i.current=null}u(0),l(0),C(!1),console.log("[AudioContext] Analysers disconnected")},[]),z=r.useCallback(()=>{const b=()=>{if(!h.current||!d.current)return;const f=new Uint8Array(h.current.frequencyBinCount),m=new Uint8Array(d.current.frequencyBinCount);h.current.getByteFrequencyData(f),d.current.getByteFrequencyData(m);const k=mt(f),L=mt(m);u(k),l(L),v.current=requestAnimationFrame(b)};b()},[]);return r.useEffect(()=>()=>{v.current&&cancelAnimationFrame(v.current),p.current&&p.current.close()},[]),e.jsx(jr.Provider,{value:{micLevel:n,sysLevel:o,setMicLevel:s,setSysLevel:c,playbackMicLevel:y,playbackSysLevel:a,playBeep:T,connectAnalysers:j,disconnectAnalysers:A,isAnalyserConnected:w},children:t})},mt=t=>{let n=0;for(let o=0;o<t.length;o++){const c=t[o]/255;n+=c*c}const s=Math.sqrt(n/t.length);return Math.min(100,s*200)},kr=async()=>{try{if("__TAURI__"in window){const{invoke:n}=await bt(async()=>{const{invoke:o}=await import("./core-DhEqZVGG.js");return{invoke:o}},[],import.meta.url),s=await n("open_data_folder");console.log("[Sidebar] Opened data folder:",s);return}const t=window.require?window.require("electron"):null;t&&await t.ipcRenderer.invoke("open-data-folder")}catch(t){console.error("[Sidebar] Failed to open data folder:",t),alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É: ${t}`)}},wr=({onStartRecording:t})=>{const{sessions:n,selectedSession:s,selectSession:o,deleteSession:c,isRecording:y,isFullTranscribing:u,fullTranscriptionSessionId:a,fullTranscriptionProgress:l}=fe(),{sendMessage:p}=de(),[h,d]=r.useState(!1),[i,g]=r.useState(""),[v,w]=r.useState(null),[C,T]=r.useState(null),[j,A]=r.useState(null),[z,b]=r.useState(""),f=r.useRef(null);r.useEffect(()=>{j&&f.current&&(f.current.focus(),f.current.select())},[j]);const m=(I,P)=>{A(I),b(P)},k=I=>{z.trim()&&p({type:"rename_session",sessionId:I,data:z.trim()}),A(null),b("")},L=()=>{A(null),b("")},B=r.useMemo(()=>{if(!i.trim())return n;const I=i.toLowerCase().trim();return n.filter(P=>!!((P.title||`–ó–∞–ø–∏—Å—å ${De(P.startTime)}`).toLowerCase().includes(I)||De(P.startTime).toLowerCase().includes(I)))},[n,i]),M=r.useMemo(()=>ar(B),[B]),U=r.useMemo(()=>{if(n.length===0)return{totalSessions:0,totalDuration:0,avgDuration:0,totalChunks:0};let I=0,P=0;return n.forEach(D=>{I+=(D.totalDuration||0)/1e3,P+=D.chunksCount||0}),{totalSessions:n.length,totalDuration:I,avgDuration:I/n.length,totalChunks:P}},[n]);return e.jsxs("aside",{className:"glass-surface-elevated",style:{width:"300px",margin:"var(--spacing-inset)",marginRight:0,borderRadius:"var(--radius-xl)",background:"var(--sidebar-bg)",backdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",WebkitBackdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",border:"1px solid var(--glass-border)",boxShadow:"var(--shadow-glass)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[y&&e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"var(--radius-xl)"},children:e.jsxs("div",{style:{textAlign:"center",padding:"1.5rem"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.2)",border:"2px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem"},children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("div",{style:{color:"var(--text-primary)",fontWeight:600,marginBottom:"0.25rem"},children:"–ó–∞–ø–∏—Å—å –∏–¥—ë—Ç"}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–ù–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞"})]})}),e.jsxs("div",{style:{padding:"0.75rem 1rem",paddingTop:"0.5rem",marginTop:"28px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.2rem",fontWeight:"var(--font-weight-bold)",letterSpacing:"-0.02em",color:"var(--text-primary)"},children:"–í—Å–µ –∑–∞–ø–∏—Å–∏"}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:()=>window.location.reload(),title:"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫",style:{width:"32px",height:"32px"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:kr,title:"–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É —Å –∑–∞–ø–∏—Å—è–º–∏",style:{width:"32px",height:"32px"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:()=>d(!h),title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",style:{width:"32px",height:"32px",background:h?"var(--primary-alpha)":void 0},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})})]})]}),e.jsxs("div",{style:{padding:"0 1rem 0.75rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"var(--text-muted)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",left:"0.75rem",pointerEvents:"none",opacity:.6},children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π...",value:i,onChange:I=>g(I.target.value),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.25rem",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)",color:"var(--text-primary)",fontSize:"0.85rem",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:I=>{I.target.style.borderColor="var(--primary)",I.target.style.boxShadow="0 0 0 2px var(--primary-alpha)"},onBlur:I=>{I.target.style.borderColor="var(--glass-border-subtle)",I.target.style.boxShadow="none"}}),i&&e.jsx("button",{onClick:()=>g(""),style:{position:"absolute",right:"0.5rem",padding:"0.25rem",background:"transparent",border:"none",cursor:"pointer",color:"var(--text-muted)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%"},title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),i&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--text-muted)"},children:["–ù–∞–π–¥–µ–Ω–æ: ",B.length," –∏–∑ ",n.length]})]}),h&&n.length>0&&e.jsx("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--primary)"},children:U.totalSessions}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ó–∞–ø–∏—Å–µ–π"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--success)"},children:Je(U.totalDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–í—Å–µ–≥–æ"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--warning)"},children:Je(U.avgDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–°—Ä–µ–¥–Ω—è—è"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--info)"},children:U.totalChunks}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ß–∞–Ω–∫–æ–≤"})]})]})}),e.jsx("div",{className:"scroll-soft-edges",style:{flex:1,overflowY:"auto",paddingBottom:"1rem"},children:B.length===0?e.jsx("div",{style:{padding:"2rem 1rem",color:"var(--text-muted)",textAlign:"center",fontSize:"0.9rem"},children:n.length===0?"–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π":"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"}):M.map(I=>e.jsxs("div",{children:[e.jsx("div",{className:"group-header",children:I.label}),I.sessions.map(P=>{const D=s?.id===P.id,F=P.totalDuration/1e3,H=v===P.id,K=u&&a===P.id;return e.jsxs("div",{className:`session-item ${D?"selected":""}`,onClick:()=>o(P.id),onMouseEnter:()=>w(P.id),onMouseLeave:()=>w(null),style:{position:"relative"},children:[H&&!y&&e.jsx("button",{onClick:N=>{N.stopPropagation(),T(P.id)},title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",style:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"24px",height:"24px",padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"4px",cursor:"pointer",color:"#ef4444",transition:"all 0.2s"},onMouseEnter:N=>{N.currentTarget.style.background="rgba(239, 68, 68, 0.2)"},onMouseLeave:N=>{N.currentTarget.style.background="rgba(239, 68, 68, 0.1)"},children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),j===P.id?e.jsx("input",{ref:f,type:"text",value:z,onChange:N=>b(N.target.value),onBlur:()=>k(P.id),onKeyDown:N=>{N.key==="Enter"?k(P.id):N.key==="Escape"&&L()},onClick:N=>N.stopPropagation(),style:{width:"100%",fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",padding:"0.125rem 0.25rem",border:"1px solid var(--primary)",borderRadius:"4px",background:"var(--surface-alpha)",outline:"none"}}):e.jsx("div",{onDoubleClick:N=>{N.stopPropagation(),y||m(P.id,P.title||`–ó–∞–ø–∏—Å—å ${De(P.startTime)}`)},title:"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",style:{fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingRight:H?"2rem":0,cursor:y?"default":"text"},children:P.title||`–ó–∞–ø–∏—Å—å ${De(P.startTime)}`}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem",color:"var(--text-muted)"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:[De(P.startTime),", ",lr(P.startTime)]}),e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.jsx("span",{children:Je(F)})]}),K&&e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"var(--primary)",animation:"pulse 1s infinite"}}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--primary)"},children:["–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è ",Math.round(l*100),"%"]})]}),e.jsx("div",{style:{height:"3px",background:"var(--glass-bg)",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${l*100}%`,background:"var(--primary)",borderRadius:"2px",transition:"width 0.3s ease"}})})]})]},P.id)})]},I.label))}),e.jsx("div",{style:{padding:"0.75rem 1rem",borderTop:"1px solid var(--glass-border-subtle)"},children:e.jsx("button",{className:"btn-capsule",onClick:t,disabled:y||u,style:{width:"100%",justifyContent:"center",padding:"0.6rem 1rem",gap:"0.4rem",background:y?"linear-gradient(135deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 38, 0.8))":u?"linear-gradient(135deg, rgba(100, 100, 100, 0.6), rgba(80, 80, 80, 0.6))":"linear-gradient(135deg, var(--primary), var(--primary-dark))",border:"none",color:"white",cursor:y||u?"not-allowed":"pointer",opacity:u?.6:1},children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"white",animation:"pulse 1s infinite"}}),"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å..."]}):u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å"]})})}),C&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>T(null),children:e.jsxs("div",{style:{background:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"var(--radius-lg)",padding:"1.5rem",maxWidth:"320px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset",border:"1px solid rgba(255, 255, 255, 0.15)"},onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"1rem"},children:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:"–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>T(null),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border)",background:"transparent",color:"var(--text-primary)",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{onClick:()=>{c(C),T(null)},style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",border:"none",background:"#ef4444",color:"white",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},children:"–£–¥–∞–ª–∏—Ç—å"})]})]})})]})},Cr=({showSettings:t,setShowSettings:n,onShowHelp:s})=>{const{isConnected:o}=de(),{isRecording:c,isFullTranscribing:y}=fe(),u=c||y;return e.jsxs("header",{style:{padding:"0.75rem 1.5rem",paddingLeft:"88px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"transparent",WebkitAppRegion:"drag",userSelect:"none",minHeight:"52px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:o?"var(--success)":"var(--danger)",boxShadow:o?"0 0 12px var(--success)":"0 0 12px var(--danger)",transition:"all var(--duration-normal) var(--transition-smooth)"}})}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",WebkitAppRegion:"no-drag"},children:[s&&e.jsx("button",{className:"btn-icon",onClick:s,title:"–°–ø—Ä–∞–≤–∫–∞ (?)",style:{width:"36px",height:"36px"},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsx("button",{className:"btn-icon",onClick:()=>n(!t),title:u?"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã":"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (‚åò,)",disabled:u,style:{width:"36px",height:"36px",background:t?"var(--glass-bg-active)":void 0,opacity:u?.4:1,pointerEvents:u?"none":"auto",transition:"opacity 0.2s ease"},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]})]})},Mr=({playbackMicLevel:t,playbackSysLevel:n})=>{const{micLevel:s,sysLevel:o,isRecording:c}=fe(),y=t!==void 0?t:s,u=n!==void 0?n:o;return c||t!==void 0||n!==void 0?e.jsxs("div",{style:{width:"24px",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"4px",padding:"8px 4px",background:"var(--surface)",borderLeft:"1px solid var(--border)"},children:[e.jsx("div",{style:{flex:1,width:"8px",background:"var(--surface-strong)",borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${y}%`,background:"linear-gradient(to top, #4caf50, #8bc34a)",borderRadius:"4px",transition:"height 0.1s ease"}})}),e.jsx("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)"},children:"üé§"}),e.jsx("div",{style:{flex:1,width:"8px",background:"var(--surface-strong)",borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${u}%`,background:"linear-gradient(to top, #2196f3, #03a9f4)",borderRadius:"4px",transition:"height 0.1s ease"}})}),e.jsx("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)"},children:"üîä"})]}):null};class Tr extends r.Component{state={hasError:!1,error:null};static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error("Uncaught error:",n,s)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{style:{padding:"2rem",color:"#ff6b6b"},children:[e.jsx("h2",{children:"Something went wrong."}),e.jsx("pre",{style:{backgroundColor:"#2d2d2d",padding:"1rem",borderRadius:"4px",overflow:"auto"},children:this.state.error?.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"1rem",padding:"0.5rem 1rem",cursor:"pointer"},children:"Reload Application"})]}):this.props.children}}const gt=t=>{const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3),c=t%1e3;return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")},${c.toString().padStart(3,"0")}`},ht=t=>{const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3),c=t%1e3;return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${c.toString().padStart(3,"0")}`},Ce=t=>t==="mic"||t==="–í—ã"?"–í—ã":t==="sys"||t==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫"?"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫":t?.startsWith("Speaker ")?`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${parseInt(t.replace("Speaker ",""),10)+1}`:t||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",Ct=()=>{const t=r.useCallback(async u=>{if(!u?.chunks)return!1;const a=u.chunks.filter(p=>p.status==="completed"&&p.dialogue).flatMap(p=>p.dialogue||[]).sort((p,h)=>(p.start||0)-(h.start||0));if(a.length===0)return!1;const l=a.map(p=>`${Ce(p.speaker)}: ${p.text}`).join(`
`);try{return await navigator.clipboard.writeText(l),!0}catch(p){return console.error("Failed to copy to clipboard:",p),!1}},[]),n=r.useCallback(u=>{if(!u?.chunks)return;const l=u.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)).map(i=>{const g=Math.floor((i.start||0)/6e4),v=Math.floor((i.start||0)%6e4/1e3);return`[${`${g.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`}] ${Ce(i.speaker)}: ${i.text}`}).join(`
`),p=new Blob([l],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(p),d=document.createElement("a");d.href=h,d.download=`${u.title||"transcription"}.txt`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)},[]),s=r.useCallback(u=>{if(!u?.chunks)return;const l=u.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)).map((i,g)=>{const v=gt(i.start||0),w=gt(i.end||i.start||0);return`${g+1}
${v} --> ${w}
${Ce(i.speaker)}: ${i.text}
`}).join(`
`),p=new Blob([l],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(p),d=document.createElement("a");d.href=h,d.download=`${u.title||"transcription"}.srt`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)},[]),o=r.useCallback(u=>{if(!u?.chunks)return;const a=u.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)),l=[`WEBVTT
`].concat(a.map((i,g)=>{const v=ht(i.start||0),w=ht(i.end||i.start||0);return`${g+1}
${v} --> ${w}
${Ce(i.speaker)}: ${i.text}
`})).join(`
`),p=new Blob([l],{type:"text/vtt;charset=utf-8"}),h=URL.createObjectURL(p),d=document.createElement("a");d.href=h,d.download=`${u.title||"transcription"}.vtt`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)},[]),c=r.useCallback(u=>{if(!u?.chunks)return;const a=u.chunks.filter(g=>g.status==="completed"&&g.dialogue).flatMap(g=>g.dialogue||[]).sort((g,v)=>(g.start||0)-(v.start||0)),l={session:{id:u.id,title:u.title,startTime:u.startTime,endTime:u.endTime,totalDuration:u.totalDuration,language:u.language,model:u.model},dialogue:a.map(g=>({start:g.start,end:g.end,speaker:Ce(g.speaker),text:g.text})),summary:u.summary||null},p=JSON.stringify(l,null,2),h=new Blob([p],{type:"application/json;charset=utf-8"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`${u.title||"transcription"}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(d)},[]),y=r.useCallback(u=>{if(!u?.chunks)return;const a=u.chunks.filter(C=>C.status==="completed"&&C.dialogue).flatMap(C=>C.dialogue||[]).sort((C,T)=>(C.start||0)-(T.start||0)),l=new Date(u.startTime).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),p=(u.totalDuration||0)/1e3,h=Math.floor(p/60),d=Math.floor(p%60);let i=`# ${u.title||"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"}

`;i+=`**–î–∞—Ç–∞:** ${l}
`,i+=`**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ${h}:${d.toString().padStart(2,"0")}

`,u.summary&&(i+=`## –°–≤–æ–¥–∫–∞

${u.summary}

`),i+=`## –î–∏–∞–ª–æ–≥

`,a.forEach(C=>{const T=Math.floor((C.start||0)/6e4),j=Math.floor((C.start||0)%6e4/1e3),A=`${T.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`;i+=`**[${A}] ${Ce(C.speaker)}:** ${C.text}

`});const g=new Blob([i],{type:"text/markdown;charset=utf-8"}),v=URL.createObjectURL(g),w=document.createElement("a");w.href=v,w.download=`${u.title||"transcription"}.md`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(v)},[]);return{copyToClipboard:t,exportTXT:n,exportSRT:s,exportVTT:o,exportJSON:c,exportMarkdown:y}},Rr=({session:t,isPlaying:n,isPlayingFullSession:s=!1,onPlayPause:o,onSeek:c,currentTime:y,duration:u,onRetranscribe:a,onImprove:l,waveformData:p,waveformLoading:h,waveformError:d})=>{const i=r.useRef(null),[g,v]=r.useState(null),[w,C]=r.useState(1),[T,j]=r.useState(!1),[A,z]=r.useState(!1),[b,f]=r.useState(!1),[m,k]=r.useState(t.title||""),[L,B]=r.useState(!1),[M,U]=r.useState(""),{sendMessage:I}=de(),{isFullTranscribing:P,fullTranscriptionProgress:D,fullTranscriptionStatus:F,fullTranscriptionError:H,fullTranscriptionSessionId:K,cancelFullTranscription:N,isRecording:ee}=fe();r.useEffect(()=>{k(t.title||"")},[t.title]);const ne=P&&K===t.id,[O,xe]=r.useState(()=>{const S=localStorage.getItem("waveformViewMode");return S==="simple"||S==="detailed"||S==="hidden"?S:"simple"});r.useEffect(()=>{localStorage.setItem("waveformViewMode",O)},[O]);const{copyToClipboard:ie,exportTXT:he,exportSRT:ue,exportVTT:Te,exportJSON:Se,exportMarkdown:ae}=Ct(),je=S=>{if(!i.current||u===0)return;const X=i.current.getBoundingClientRect(),J=S.clientX-X.left,re=Math.min(Math.max(J/X.width,0),1);c(re*u)},Z=S=>{if(!i.current||u===0)return;const X=i.current.getBoundingClientRect(),J=S.clientX-X.left,re=Math.min(Math.max(J/X.width,0),1);v(re*u)},pe=S=>{if(!isFinite(S)||isNaN(S))return"0:00";const X=Math.floor(S/60),J=Math.floor(S%60);return`${X}:${J.toString().padStart(2,"0")}`},V=(t.totalDuration||0)/1e3,te=isFinite(u)&&u>0?u:V,Y=S=>{const X=Math.max(0,Math.min(y+S,te));c(X)},oe=()=>{const S=[.5,.75,1,1.25,1.5,2],J=(S.indexOf(w)+1)%S.length;C(S[J])},se=s&&V>0?y/V*100:0,ke=()=>{m.trim()&&m!==t.title&&I({type:"update_session_title",sessionId:t.id,title:m.trim()}),f(!1)},me=()=>{k(t.title||""),f(!1)},we=()=>{const S=M.trim();if(S&&!t.tags?.includes(S)){const X=[...t.tags||[],S];I({type:"update_session_tags",sessionId:t.id,tags:X}),U("")}},Re=S=>{const X=(t.tags||[]).filter(J=>J!==S);I({type:"update_session_tags",sessionId:t.id,tags:X})};return e.jsxs("div",{className:"glass-surface",style:{margin:"0 1rem 1rem",padding:"1rem 1.25rem",borderRadius:"var(--radius-lg)",background:"var(--glass-bg)",backdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",WebkitBackdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",border:"1px solid var(--glass-border)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",gap:"1rem"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[b?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsx("input",{type:"text",value:m,onChange:S=>k(S.target.value),onKeyDown:S=>{S.key==="Enter"&&ke(),S.key==="Escape"&&me()},autoFocus:!0,style:{flex:1,padding:"0.4rem 0.6rem",fontSize:"1.1rem",fontWeight:600,background:"var(--glass-bg)",border:"1px solid var(--primary)",borderRadius:"8px",color:"var(--text-primary)",outline:"none"}}),e.jsx("button",{onClick:ke,style:{padding:"0.4rem",background:"var(--primary)",border:"none",borderRadius:"6px",color:"white",cursor:"pointer"},title:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",children:"‚úì"}),e.jsx("button",{onClick:me,style:{padding:"0.4rem",background:"var(--glass-bg)",border:"1px solid var(--border)",borderRadius:"6px",color:"var(--text-muted)",cursor:"pointer"},title:"–û—Ç–º–µ–Ω–∞",children:"‚úï"})]}):e.jsxs("h3",{onClick:()=>f(!0),style:{margin:0,fontSize:"1.1rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},title:"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",children:[t.title||"–ó–∞–ø–∏—Å—å –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.4},children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:t.startTime?new Date(t.startTime).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞"}),t.tags&&t.tags.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-muted)",opacity:.4},children:"‚Ä¢"}),t.tags.map(S=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.2rem",padding:"0.1rem 0.4rem",fontSize:"0.7rem",background:"var(--primary-alpha)",color:"var(--primary)",borderRadius:"4px",fontWeight:500},children:[S,e.jsx("button",{onClick:()=>Re(S),style:{background:"none",border:"none",padding:"0 0 0 2px",cursor:"pointer",color:"var(--primary)",fontSize:"0.6rem",lineHeight:1,opacity:.6},title:"–£–¥–∞–ª–∏—Ç—å —Ç–µ–≥",children:"‚úï"})]},S))]})]})]}),e.jsx("div",{style:{position:"relative"},children:L?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[e.jsx("input",{type:"text",value:M,onChange:S=>U(S.target.value),onKeyDown:S=>{S.key==="Enter"&&we(),S.key==="Escape"&&(B(!1),U(""))},placeholder:"–ù–æ–≤—ã–π —Ç–µ–≥...",autoFocus:!0,style:{width:"120px",padding:"0.35rem 0.6rem",fontSize:"0.8rem",background:"var(--glass-bg)",border:"1px solid var(--primary)",borderRadius:"8px",color:"var(--text-primary)",outline:"none"}}),e.jsx("button",{onClick:we,disabled:!M.trim(),style:{padding:"0.35rem 0.5rem",background:M.trim()?"var(--primary)":"var(--glass-bg)",border:"none",borderRadius:"6px",color:M.trim()?"white":"var(--text-muted)",cursor:M.trim()?"pointer":"not-allowed",fontSize:"0.8rem"},children:"+"}),e.jsx("button",{onClick:()=>{B(!1),U("")},style:{padding:"0.35rem 0.5rem",background:"var(--glass-bg)",border:"1px solid var(--border)",borderRadius:"6px",color:"var(--text-muted)",cursor:"pointer",fontSize:"0.8rem"},children:"‚úï"})]}):e.jsxs("button",{className:"btn-capsule",onClick:()=>B(!0),style:{padding:"0.35rem 0.75rem",fontSize:"0.8rem",gap:"0.3rem"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥"]})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx("button",{className:"btn-icon",onClick:()=>Y(-10),title:"–ù–∞–∑–∞–¥ 10 —Å–µ–∫",style:{width:"36px",height:"36px"},children:e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"var(--font-weight-semibold)"},children:"10"})}),e.jsx("button",{className:"btn-icon btn-icon-lg",onClick:o,title:n?"–ü–∞—É–∑–∞":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",style:{width:"52px",height:"52px",background:"var(--glass-bg-elevated)",border:"1px solid var(--glass-border)"},children:n?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("polygon",{points:"6 3 20 12 6 21 6 3"})})}),e.jsx("button",{className:"btn-icon",onClick:()=>Y(10),title:"–í–ø–µ—Ä—ë–¥ 10 —Å–µ–∫",style:{width:"36px",height:"36px"},children:e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"var(--font-weight-semibold)"},children:"10"})}),e.jsxs("button",{className:"btn-capsule",onClick:oe,title:"–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è",style:{marginLeft:"0.5rem",padding:"0.3rem 0.6rem",fontSize:"0.8rem",minWidth:"42px"},children:[w,"x"]}),e.jsxs("div",{style:{display:"flex",gap:"2px",marginLeft:"0.75rem",background:"var(--glass-bg-elevated)",borderRadius:"var(--radius-sm)",padding:"2px",border:"1px solid var(--glass-border-subtle)"},children:[e.jsx("button",{onClick:()=>xe("simple"),title:"–ü—Ä–æ—Å—Ç–æ–π –≤–∏–¥",style:{padding:"6px 8px",background:O==="simple"?"var(--primary)":"transparent",color:O==="simple"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"10",width:"3",height:"4",rx:"1"}),e.jsx("rect",{x:"8",y:"7",width:"3",height:"10",rx:"1"}),e.jsx("rect",{x:"13",y:"9",width:"3",height:"6",rx:"1"}),e.jsx("rect",{x:"18",y:"6",width:"3",height:"12",rx:"1"})]})}),e.jsx("button",{onClick:()=>xe("detailed"),title:"–î–µ—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥ (Mic/Sys)",style:{padding:"6px 8px",background:O==="detailed"?"var(--primary)":"transparent",color:O==="detailed"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M2 6h20"}),e.jsx("path",{d:"M4 6v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1z"}),e.jsx("path",{d:"M10 6v-2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z"}),e.jsx("path",{d:"M2 18h20"}),e.jsx("path",{d:"M6 18v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-1z"}),e.jsx("path",{d:"M12 18v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1z"})]})}),e.jsx("button",{onClick:()=>xe("hidden"),title:"–°–≤–µ—Ä–Ω—É—Ç—å",style:{padding:"6px 8px",background:O==="hidden"?"var(--primary)":"transparent",color:O==="hidden"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"4 14 10 14 10 20"}),e.jsx("polyline",{points:"20 10 14 10 14 4"}),e.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),e.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[e.jsxs("button",{className:"btn-capsule",onClick:a,title:"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å",disabled:P||ee,style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem",opacity:P||ee?.5:1,cursor:P||ee?"not-allowed":"pointer"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),ne?"–ò–¥—ë—Ç...":"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å"]}),e.jsxs("button",{className:"btn-capsule btn-capsule-primary",onClick:l,title:"–£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç",style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),"–£–ª—É—á—à–∏—Ç—å"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{className:"btn-capsule",onClick:()=>j(!T),title:"–≠–∫—Å–ø–æ—Ä—Ç",style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"–≠–∫—Å–ø–æ—Ä—Ç"]}),T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>j(!1)}),e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:0,background:"rgba(30, 30, 35, 0.75)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",borderRadius:"var(--radius-lg)",border:"1px solid rgba(255, 255, 255, 0.12)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.08)",padding:"0.5rem",minWidth:"180px",zIndex:100},children:[e.jsxs("button",{onClick:async()=>{await ie(t)&&(z(!0),setTimeout(()=>z(!1),2e3)),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:["–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç ",A&&"(–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!)"]}),e.jsx("div",{style:{height:"1px",background:"rgba(255, 255, 255, 0.08)",margin:"0.25rem 0.5rem"}}),e.jsx("button",{onClick:()=>{he(t),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:"–¢–µ–∫—Å—Ç (.txt)"}),e.jsx("button",{onClick:()=>{ue(t),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:"–°—É–±—Ç–∏—Ç—Ä—ã (.srt)"}),e.jsx("button",{onClick:()=>{Te(t),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:"WebVTT (.vtt)"}),e.jsx("button",{onClick:()=>{Se(t),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:"JSON (.json)"}),e.jsx("button",{onClick:()=>{ae(t),j(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:"Markdown (.md)"})]})]})]})]})]}),O!=="hidden"&&e.jsx("div",{children:O==="simple"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:i,onClick:je,onMouseMove:Z,onMouseLeave:()=>v(null),style:{height:"48px",background:"var(--glass-bg)",borderRadius:"var(--radius-md)",position:"relative",cursor:"pointer",overflow:"hidden",border:"1px solid var(--glass-border-subtle)"},children:[e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",gap:"2px",padding:"0 4px"},children:(t.chunks||[]).length>0?(t.chunks||[]).filter(S=>S).map((S,X,J)=>{const re=X/J.length*100<se,ye=30+(S.transcription||"").length%60;return e.jsx("div",{style:{flex:1,height:`${ye}%`,background:re?"linear-gradient(to top, var(--primary), var(--accent))":"var(--glass-bg-hover)",borderRadius:"2px",transition:"background var(--duration-fast)"}},S.id||X)}):Array.from({length:50}).map((S,X)=>{const J=X/50*100<se,re=20+Math.random()*60;return e.jsx("div",{style:{flex:1,height:`${re}%`,background:J?"linear-gradient(to top, var(--primary), var(--accent))":"var(--glass-bg-hover)",borderRadius:"2px",transition:"background var(--duration-fast)"}},X)})}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:`${se}%`,width:"2px",background:"white",boxShadow:"0 0 10px rgba(255, 255, 255, 0.8)",pointerEvents:"none",transition:"left 0.1s linear"}}),g!==null&&e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:`${g/te*100}%`,width:"1px",background:"var(--text-muted)",pointerEvents:"none"},children:e.jsx("div",{style:{position:"absolute",bottom:"calc(100% + 4px)",left:"50%",transform:"translateX(-50%)",background:"var(--glass-bg-elevated)",backdropFilter:"blur(10px)",padding:"2px 6px",borderRadius:"var(--radius-xs)",fontSize:"0.7rem",fontFamily:"SF Mono, monospace",color:"var(--text-primary)",whiteSpace:"nowrap",border:"1px solid var(--glass-border)"},children:pe(g)})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"SF Mono, Menlo, monospace",color:"var(--text-muted)"},children:[e.jsx("span",{children:pe(y)}),e.jsx("span",{children:pe(te)})]})]}):e.jsx(dr,{currentTime:y,playbackOffset:0,totalDuration:p?.duration||te,isPlaying:n,waveformData:p,loading:h,error:d,channelLabels:["Mic","Sys"],onSeek:c})}),ne&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--glass-bg-elevated)",borderRadius:"var(--radius-md)",border:"1px solid var(--primary-alpha)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"var(--primary)",animation:"pulse 1s infinite"}}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:600,color:"var(--text-primary)"},children:"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"})]}),e.jsx("button",{onClick:N,title:"–û—Ç–º–µ–Ω–∏—Ç—å",style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"var(--radius-sm)",color:"#ef4444",cursor:"pointer",transition:"all 0.2s"},children:"–û—Ç–º–µ–Ω–∞"})]}),e.jsx("div",{style:{height:"6px",background:"var(--glass-bg)",borderRadius:"3px",overflow:"hidden",marginBottom:"0.5rem"},children:e.jsx("div",{style:{height:"100%",width:`${D*100}%`,background:"linear-gradient(90deg, var(--primary), var(--accent))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:F||"–û–±—Ä–∞–±–æ—Ç–∫–∞..."}),e.jsxs("span",{style:{fontSize:"0.75rem",fontFamily:"SF Mono, monospace",color:"var(--text-muted)"},children:[Math.round(D*100),"%"]})]})]}),H&&K===t.id&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"0.85rem"},children:[e.jsx("strong",{children:"–û—à–∏–±–∫–∞:"})," ",H]})]})},Ir=({enabled:t,className:n="",compact:s=!1})=>{const{subscribe:o}=de(),[c,y]=r.useState(""),[u,a]=r.useState(""),[l,p]=r.useState(0),[,h]=r.useState(0),d=r.useRef(null),[i,g]=r.useState(!0),[v,w]=r.useState(!1),C=async()=>{const f=c+(u?" "+u:"");if(f.trim())try{await navigator.clipboard.writeText(f.trim()),w(!0),setTimeout(()=>w(!1),2e3)}catch(m){console.error("Failed to copy text:",m)}};r.useEffect(()=>{if(!t){y(""),a(""),p(0);return}const f=o("streaming_update",m=>{const k={text:m.streamingText||"",isConfirmed:m.streamingIsConfirmed||!1,confidence:m.streamingConfidence||0,timestamp:m.streamingTimestamp||Date.now()};h(k.timestamp),p(k.confidence),k.isConfirmed?(y(L=>(L?`${L} ${k.text}`:k.text).trim()),a("")):a(k.text),g(!0)});return()=>f()},[t,o]),r.useEffect(()=>{i&&d.current&&(d.current.scrollTo({top:d.current.scrollHeight,behavior:"smooth"}),g(!1))},[i,c,u]);const T=()=>{if(!d.current)return;const{scrollTop:f,scrollHeight:m,clientHeight:k}=d.current,L=m-f-k<50;g(L)};if(!t)return null;const j=c||u,A=Math.round(l*100),z=l>=.85?"#10b981":l>=.7?"#f59e0b":"#ef4444",b=s?{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem 0.25rem 0",borderRadius:"6px",overflow:"hidden"}:{display:"flex",flexDirection:"column",height:"100%",background:"linear-gradient(180deg, rgba(59, 130, 246, 0.05) 0%, transparent 100%)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)",overflow:"hidden"};return e.jsxs("div",{className:`streaming-transcription ${n}`,style:b,children:[!s&&e.jsxs("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid rgba(59, 130, 246, 0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(59, 130, 246, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#3b82f6",animation:"pulse 2s ease-in-out infinite"}}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1f2937"},children:"Live –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"})]}),j&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"12px",background:"rgba(255, 255, 255, 0.8)",border:`1px solid ${z}20`},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:z}}),e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:600,color:z},children:[A,"%"]})]})]}),e.jsx("button",{onClick:C,title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç",style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.3)",background:v?"rgba(16, 185, 129, 0.1)":"rgba(255, 255, 255, 0.8)",cursor:"pointer",fontSize:"0.75rem",color:v?"#10b981":"#6b7280",transition:"all 0.2s ease"},children:v?e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),e.jsx("span",{children:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),e.jsx("span",{children:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"})]})})]})]}),e.jsx("div",{ref:d,onScroll:T,style:s?{flex:"unset",padding:"0.4rem 0.5rem",overflowY:"hidden",fontSize:"0.9rem",lineHeight:"1.5",color:"#1f2937"}:{flex:1,padding:"1rem",overflowY:"auto",fontSize:"0.9375rem",lineHeight:"1.6",color:"#1f2937"},children:j?e.jsxs("div",{children:[c&&e.jsx("span",{style:{color:"#1f2937",fontWeight:400,transition:"all 0.3s ease"},children:c}),c&&u&&" ",u&&e.jsx("span",{style:{color:"#9ca3af",fontStyle:"italic",fontWeight:300,opacity:.8,transition:"all 0.3s ease",animation:"fadeIn 0.3s ease-in-out"},children:u})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#9ca3af",fontSize:"0.875rem"},children:"–û–∂–∏–¥–∞–Ω–∏–µ –∞—É–¥–∏–æ..."})}),j&&!s&&e.jsxs("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid rgba(59, 130, 246, 0.1)",fontSize:"0.75rem",color:"#9ca3af",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{style:{width:"12px",height:"2px",background:"#1f2937",borderRadius:"1px"}}),e.jsx("span",{children:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{style:{width:"12px",height:"2px",background:"#9ca3af",borderRadius:"1px",opacity:.6}}),e.jsx("span",{style:{fontStyle:"italic"},children:"–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π"})]})]}),e.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                    50% {
                        opacity: 0.5;
                        transform: scale(0.95);
                    }
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(-2px);
                    }
                    to {
                        opacity: 0.8;
                        transform: translateY(0);
                    }
                }

                .streaming-transcription::-webkit-scrollbar {
                    width: 6px;
                }

                .streaming-transcription::-webkit-scrollbar-track {
                    background: rgba(0, 0, 0, 0.05);
                    border-radius: 3px;
                }

                .streaming-transcription::-webkit-scrollbar-thumb {
                    background: rgba(59, 130, 246, 0.3);
                    border-radius: 3px;
                }

                .streaming-transcription::-webkit-scrollbar-thumb:hover {
                    background: rgba(59, 130, 246, 0.5);
                }
            `})]})},zr=`http://localhost:${globalThis.AIWISPER_HTTP_PORT||18080}`,Er=({chunks:t,sessionId:n,transcribingChunkId:s,highlightedChunkId:o,onPlayChunk:c})=>{const y=r.useRef(null),{isTauri:u,sendMessage:a}=de(),[l,p]=r.useState(!0),[h,d]=r.useState(!0),[i,g]=r.useState(0),v=r.useRef(t.length);r.useEffect(()=>{l&&y.current&&(y.current.scrollTo({top:y.current.scrollHeight,behavior:"smooth"}),p(!1),g(0))},[l,t.length]),r.useEffect(()=>{t.length>v.current&&(h?p(!0):g(T=>T+(t.length-v.current))),v.current=t.length},[t.length,h]);const w=()=>{if(!y.current)return;const{scrollTop:T,scrollHeight:j,clientHeight:A}=y.current,z=j-T-A<50;d(z),z&&g(0)},C=()=>p(!0);return t.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-muted)",fontSize:"0.9rem",fontStyle:"italic"},children:"–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞..."}):e.jsxs("div",{style:{position:"relative",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx("div",{ref:y,onScroll:w,style:{flex:1,overflowY:"auto",padding:"1rem",fontSize:"0.9rem"},children:t.map((T,j)=>{const A=j===t.length-1,z=s===T.id||T.status==="transcribing",b=o===T.id;return e.jsx(Ar,{chunk:T,sessionId:n,isTauri:u,sendMessage:a,isLast:A,isTranscribing:z,isHighlighted:b,onPlayChunk:c},T.id)})}),!h&&i>0&&e.jsxs("button",{onClick:C,style:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",padding:"0.5rem 1rem",background:"var(--primary)",color:"white",border:"none",borderRadius:"9999px",fontSize:"0.85rem",fontWeight:600,cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s ease"},children:[e.jsxs("span",{children:["–ù–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤: ",i]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M19 12l-7 7-7-7"})})]})]})},Ze=new Map,Ar=({chunk:t,sessionId:n,isTauri:s,sendMessage:o,isLast:c,isTranscribing:y,isHighlighted:u,onPlayChunk:a})=>{const[l,p]=r.useState(null),[h,d]=r.useState(!1),i=r.useMemo(()=>(t.duration/1e9).toFixed(1),[t.duration]),g=t.status==="completed"?"#4caf50":t.status==="error"?"#f44336":"#ff9800",v=t.status==="completed"?"‚úì":t.status==="error"?"‚úó":"‚è≥",w=async()=>{const C=`${n}:${t.index}`;if(l){a(l);return}const T=Ze.get(C);if(T){p(T),a(T);return}d(!0);try{if(s===!0){const j=await o({type:"get_chunk_audio",sessionId:n,chunkIndex:t.index});j&&typeof j=="string"&&(Ze.set(C,j),p(j),a(j))}else{const j=`${zr}/api/sessions/${n}/chunk/${t.index}.mp3`;Ze.set(C,j),p(j),a(j)}}catch(j){console.error("[LiveChunkItem] Failed to load audio",j)}finally{d(!1)}};return e.jsxs("div",{style:{padding:"0.8rem 1rem",marginBottom:"0.75rem",backgroundColor:y?"rgba(59, 130, 246, 0.08)":u?"rgba(16, 185, 129, 0.08)":"var(--surface)",borderRadius:"10px",border:`1px solid ${y?"rgba(59, 130, 246, 0.3)":u?"rgba(16, 185, 129, 0.3)":"var(--border)"}`,borderLeft:`3px solid ${g}`,transition:"all 0.3s ease",animation:y?"transcribing-pulse 2s ease-in-out infinite":u?"highlight-flash 0.5s ease-in-out 2":"fadeIn 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",fontWeight:600},children:["–ß–∞–Ω–∫ #",t.index]}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:"‚Ä¢"}),e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:[i,"s"]}),e.jsx("span",{style:{color:g,fontSize:"0.9rem"},children:v})]}),t.status==="completed"&&e.jsx("button",{onClick:w,disabled:h,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",opacity:h?.7:1},children:"‚ñ∂"})]}),e.jsx(Dr,{chunk:t}),y&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"#3b82f6",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{animation:"pulse 1s infinite"},children:"‚è≥"})," –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è..."]}),t.error&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"#f44336",fontSize:"0.85rem"},children:["–û—à–∏–±–∫–∞: ",t.error]}),c&&e.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px dashed var(--border)",color:"var(--text-muted)"},children:e.jsx(Ir,{enabled:!0,className:"compact-streaming"})})]})},Dr=({chunk:t})=>{const n=s=>{if(s==="mic"||s==="–í—ã")return{name:"–í—ã",color:"#4caf50"};if(s?.startsWith("Speaker ")){const o=parseInt(s.replace("Speaker ",""),10);return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${o+1}`,color:["#2196f3","#e91e63","#ff9800","#9c27b0","#00bcd4","#8bc34a"][o%6]}}return s==="sys"?{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}:{name:s||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}};return t.dialogue&&t.dialogue.length>0?e.jsx("div",{style:{marginTop:"0.5rem",lineHeight:1.6},children:t.dialogue.map((s,o)=>e.jsx(Lr,{segment:s,getSpeakerDisplayName:n},o))}):t.micText||t.sysText?e.jsxs("div",{style:{marginTop:"0.5rem",lineHeight:1.5},children:[t.micText&&e.jsxs("div",{style:{color:"#4caf50",marginBottom:"0.3rem"},children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–í—ã: "}),t.micText]}),t.sysText&&e.jsxs("div",{style:{color:"#2196f3"},children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),t.sysText]})]}):t.transcription?e.jsx("div",{style:{marginTop:"0.5rem",color:"#ccc",lineHeight:1.5},children:t.transcription}):null},Lr=({segment:t,getSpeakerDisplayName:n})=>{const s=n(t.speaker),o=`${ft(t.start)}‚Äì${ft(t.end)}`;return e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"baseline",marginBottom:"0.35rem"},children:[e.jsx("span",{style:{color:s.color,fontWeight:700,minWidth:"110px",fontSize:"0.85rem"},children:s.name}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",minWidth:"88px",textAlign:"right",fontFamily:"monospace"},children:o}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t.text})]})},ft=t=>{const n=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},Pr=()=>{const{currentSession:t}=fe(),{subscribe:n,sendMessage:s}=de(),o=t?.chunks||[],[c,y]=r.useState(null),[u,a]=r.useState(null);return r.useEffect(()=>{if(!t)return;const l=i=>{i.sessionId===t.id&&(y(i.chunk.id),setTimeout(()=>y(null),1200))},p=i=>{i.sessionId===t.id&&(a(g=>g===i.chunk.id?null:g),y(i.chunk.id),setTimeout(()=>y(null),2e3))},h=n("chunk_created",l),d=n("chunk_transcribed",p);return()=>{h?.(),d?.()}},[t,n]),t?o.length===0?e.jsxs("div",{style:{color:"var(--text-muted)",textAlign:"center",marginTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üéôÔ∏è"}),e.jsx("div",{children:"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å... –û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞"}),e.jsx("div",{style:{fontSize:"0.85rem",marginTop:"0.5rem",opacity:.7},children:"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"})]}):e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.jsx(Er,{chunks:o,sessionId:t.id,transcribingChunkId:u,highlightedChunkId:c,onPlayChunk:l=>{s({type:"play_audio_url",url:l})}})}):e.jsxs("div",{style:{color:"var(--text-muted)",textAlign:"center",marginTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üî¥"}),e.jsx("div",{children:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏..."})]})},_r=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("div",{style:{width:"120px",height:"56px",borderRadius:"28px",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem",marginBottom:"1.5rem",boxShadow:"var(--shadow-glow-primary)"},children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"var(--font-weight-bold)",color:"var(--text-primary)",marginBottom:"0.15rem",textAlign:"center",lineHeight:1.1},children:"AIWisper"}),e.jsx("p",{style:{fontSize:"0.95rem",color:"var(--text-secondary)",marginBottom:"2rem",marginTop:0,textAlign:"center",lineHeight:1.2},children:"–£–º–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ç–æ—Ä —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ø–∏–∫–µ—Ä–æ–≤"}),e.jsxs("div",{style:{width:"100%",background:"var(--glass-bg)",backdropFilter:"blur(var(--glass-blur-light))",borderRadius:"var(--radius-lg)",border:"1px solid var(--glass-border)",padding:"1.25rem",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{fontSize:"0.85rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.04em",marginBottom:"1rem"},children:"–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx(et,{number:1,title:"–ù–∞–∂–º–∏—Ç–µ ¬´–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å¬ª",description:"–ö–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏"}),e.jsx(et,{number:2,title:"–ì–æ–≤–æ—Ä–∏—Ç–µ –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –∑–≤–æ–Ω–æ–∫",description:"–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∑–≤—É–∫"}),e.jsx(et,{number:3,title:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞",description:"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º ¬´–í—ã¬ª / ¬´–°–æ–±–µ—Å–µ–¥–Ω–∏–∫¬ª"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.75rem",width:"100%"},children:[e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),text:"–¢–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),text:"–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∏–∫–µ—Ä–æ–≤"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),text:"AI-—Å–≤–æ–¥–∫–∞"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),text:"–õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:"1.5rem",textAlign:"center"},children:"–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å —Å–ª–µ–≤–∞ –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é"})]}),et=({number:t,title:n,description:s})=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--glass-bg-elevated)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:"0.85rem",fontWeight:"var(--font-weight-semibold)",color:"var(--primary)"},children:t}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"0.9rem",fontWeight:"var(--font-weight-medium)"},children:n}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"0.8rem",marginTop:"2px"},children:s})]})]}),Ne=({icon:t,text:n})=>e.jsxs("div",{style:{padding:"0.75rem 1rem",background:"var(--glass-bg)",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border-subtle)",display:"flex",alignItems:"center",gap:"0.6rem",color:"var(--text-muted)"},children:[e.jsx("span",{style:{display:"flex",alignItems:"center",flexShrink:0},children:t}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:n})]}),xt=["#2196f3","#e91e63","#ff9800","#9c27b0","#00bcd4","#8bc34a"],Br=t=>{if(t==="mic"||t==="–í—ã")return{name:"–í—ã",color:"#4caf50"};if(t?.startsWith("Speaker ")){const n=parseInt(t.replace("Speaker ",""),10);return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${n+1}`,color:xt[n%xt.length]}}else return t==="sys"?{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}:{name:t||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}},$r=t=>{const n=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},tt=new Map,Wr=({chunks:t,sessionId:n,playingUrl:s,highlightedChunkId:o,transcribingChunkId:c,isFullTranscribing:y=!1,onPlayChunk:u,onRetranscribe:a})=>{const{isTauri:l,sendMessage:p}=de(),h=(t||[]).filter(d=>d);return h.length===0?e.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",padding:"2rem"},children:"–ù–µ—Ç —á–∞–Ω–∫–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"}):e.jsx("div",{children:h.map(d=>{const i=d.index??0,g=o===d.id,v=c===d.id||d.status==="transcribing";return e.jsx(Fr,{chunk:d,sessionId:n,chunkIndex:i,isTauri:l,sendMessage:p,playingUrl:s,isHighlighted:g,isTranscribing:v,isRetranscribeDisabled:y,onPlayChunk:u,onRetranscribe:()=>d.id&&a(d.id)},d.id||`chunk-${i}`)})})},Fr=({chunk:t,sessionId:n,chunkIndex:s,isTauri:o,sendMessage:c,playingUrl:y,isHighlighted:u,isTranscribing:a,isRetranscribeDisabled:l=!1,onPlayChunk:p,onRetranscribe:h})=>{const[d,i]=r.useState(null),[g,v]=r.useState(!1),w=((t.duration||0)/1e9).toFixed(1),C=d&&y===d,T=async()=>{const z=`${n}:${s}`;if(d){p(d);return}const b=tt.get(z);if(b){i(b),p(b);return}v(!0);try{if(o===!0){const f=await c({type:"get_chunk_audio",sessionId:n,chunkIndex:s});f&&typeof f=="string"&&(tt.set(z,f),i(f),p(f))}else{const m=`${`http://localhost:${globalThis.AIWISPER_HTTP_PORT||18080}`}/api/sessions/${n}/chunk/${s}.mp3`;tt.set(z,m),i(m),p(m)}}catch(f){console.error("[ChunkItem] Failed to load audio:",f)}finally{v(!1)}},j=t.dialogue&&t.dialogue.length>0,A=t.micText||t.sysText;return e.jsxs("div",{style:{padding:"0.75rem 1rem",marginBottom:"0.5rem",backgroundColor:a?"rgba(255, 152, 0, 0.1)":u?"rgba(76, 175, 80, 0.1)":"var(--surface)",borderRadius:"var(--radius-md)",transition:"background-color 0.3s ease",border:"1px solid var(--glass-border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.85rem"},children:["#",t.index??0," ‚Ä¢ ",w,"s"]}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{onClick:T,disabled:g,title:g?"–ó–∞–≥—Ä—É–∑–∫–∞...":C?"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",style:{padding:"0.25rem 0.5rem",backgroundColor:C?"var(--danger)":"var(--primary)",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:g?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:g?.6:1},children:g?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}):C?e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})})}),e.jsx("button",{onClick:h,disabled:l||a,title:l?"–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",style:{padding:"0.25rem 0.5rem",backgroundColor:"var(--surface-strong)",border:"1px solid var(--glass-border)",borderRadius:"var(--radius-sm)",color:"var(--text-muted)",cursor:l||a?"not-allowed":"pointer",opacity:l||a?.4:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})})]})]}),e.jsx("div",{style:{marginTop:"0.5rem",lineHeight:1.6},children:j?e.jsx(Or,{dialogue:t.dialogue,chunkStartMs:t.startMs}):A?e.jsx(Vr,{micText:t.micText,sysText:t.sysText}):e.jsx("div",{style:{color:"var(--text-secondary)"},children:t.transcription||""})}),a&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--warning)",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),"–†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è..."]}),t.error&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--danger)",fontSize:"0.8rem"},children:["–û—à–∏–±–∫–∞: ",t.error]})]})},Or=({dialogue:t})=>e.jsx("div",{children:t.map((n,s)=>{const{name:o,color:c}=Br(n.speaker),y=$r(n.start);return e.jsxs("div",{style:{marginBottom:"0.4rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderLeft:`3px solid ${c}`,borderRadius:"0 4px 4px 0"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",fontFamily:"monospace"},children:["[",y,"]"]})," ",e.jsxs("span",{style:{color:c,fontWeight:"bold"},children:[o,":"]})," ",e.jsx("span",{style:{color:"var(--text-primary)",wordBreak:"break-word"},children:n.text})]},s)})}),Vr=({micText:t,sysText:n})=>e.jsxs("div",{children:[t&&e.jsxs("div",{style:{marginBottom:"0.4rem",borderLeft:"3px solid #4caf50",paddingLeft:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold",fontSize:"0.85rem"},children:"–í—ã: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t})]}),n&&e.jsxs("div",{style:{marginBottom:"0.4rem",borderLeft:"3px solid #2196f3",paddingLeft:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#2196f3",fontWeight:"bold",fontSize:"0.85rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:n})]})]}),Hr=({currentTimeMs:t,segments:n,dialogueContainerRef:s,segmentRefs:o})=>{const[c,y]=r.useState(null);return r.useEffect(()=>{if(!s.current||n.length===0){y(null);return}const u=s.current;if(n.length>0&&t<n[0].start){const p=o.current.get(0);if(p){const h=p.getBoundingClientRect(),d=u.getBoundingClientRect();y(h.top-d.top-4)}return}for(let p=0;p<n.length;p++){const h=n[p],d=o.current.get(p);if(!d)continue;const i=d.getBoundingClientRect(),g=u.getBoundingClientRect(),v=i.top-g.top,w=i.height;if(t>=h.start&&t<=h.end){const C=h.end-h.start,T=C>0?(t-h.start)/C:0;y(v+w*T);return}if(p<n.length-1){const C=n[p+1];if(t>h.end&&t<C.start){const T=o.current.get(p+1);if(T){const A=T.getBoundingClientRect().top-g.top,z=v+w,b=A,f=C.start-h.end,m=f>0?(t-h.end)/f:0;y(z+(b-z)*m)}else y(v+w+4);return}}}const a=n.length-1,l=n[a];if(t>=l.end){const p=o.current.get(a);if(p){const h=p.getBoundingClientRect(),d=u.getBoundingClientRect();y(h.top-d.top+h.height+2)}}},[t,n,s,o]),c===null?null:e.jsx("div",{style:{position:"absolute",left:0,right:0,top:c,height:"2px",background:"linear-gradient(90deg, var(--primary) 0%, var(--primary) 80%, transparent 100%)",boxShadow:"0 0 8px var(--primary), 0 0 4px var(--primary)",zIndex:50,pointerEvents:"none",transition:"top 0.15s linear"}})},Nr=({currentTimeMs:t,segments:n,scrollContainerRef:s,dialogueContainerRef:o,segmentRefs:c,onClickScrollToPlayback:y})=>{const[u,a]=r.useState({top:0,visible:!1,isOutOfView:!1});return r.useEffect(()=>{const l=s.current,p=o.current;if(!l||!p||n.length===0){a({top:0,visible:!1,isOutOfView:!1});return}let h=null;const d=p.getBoundingClientRect(),i=l.getBoundingClientRect(),g=d.top-i.top+l.scrollTop;for(let z=0;z<n.length;z++){const b=n[z],f=c.current.get(z);if(!f)continue;const m=f.getBoundingClientRect(),k=m.top-d.top,L=g+k,B=m.height;if(t>=b.start&&t<=b.end){const M=b.end-b.start,U=M>0?(t-b.start)/M:0;h=L+B*U;break}if(z<n.length-1){const M=n[z+1];if(t>b.end&&t<M.start){h=L+B;break}}if(z===n.length-1&&t>=b.start){const M=b.end-b.start,U=M>0?Math.min(1,(t-b.start)/M):1;h=L+B*U}}if(h===null){a({top:0,visible:!1,isOutOfView:!1});return}const v=l.scrollHeight,w=l.clientHeight,C=l.scrollTop,j=h/v*w,A=h<C||h>C+w-20;a({top:Math.max(8,Math.min(w-8,j)),visible:!0,isOutOfView:A})},[t,n,s,o,c]),u.visible?e.jsx("div",{onClick:y,style:{position:"absolute",right:"4px",top:u.top,width:u.isOutOfView?"10px":"6px",height:u.isOutOfView?"10px":"6px",borderRadius:"50%",backgroundColor:"var(--primary)",boxShadow:u.isOutOfView?"0 0 10px var(--primary), 0 0 20px var(--primary)":"0 0 4px var(--primary)",zIndex:100,cursor:"pointer",transform:"translateY(-50%)",transition:"top 0.15s linear, width 0.2s ease, height 0.2s ease, box-shadow 0.2s ease",animation:u.isOutOfView?"pulse 1.5s ease-in-out infinite":"none"},title:"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è"}):null},Ur=({word:t,showConfidence:n})=>{if(!n||!t.p||t.p>=.7)return e.jsxs("span",{children:[t.text," "]});const s=t.p<.4,o=t.p<.7,c={backgroundColor:s?"rgba(255, 152, 0, 0.25)":o?"rgba(255, 193, 7, 0.15)":"transparent",borderRadius:"2px",padding:"0 2px",cursor:"help",borderBottom:s?"1px dashed rgba(255, 152, 0, 0.6)":void 0};return e.jsxs("span",{style:c,title:`–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${Math.round(t.p*100)}%`,children:[t.text," "]})},qr=({segment:t,showConfidence:n,isCurrentSegment:s})=>!n||!t.words||t.words.length===0?e.jsx("span",{style:{color:"var(--text-primary)"},children:t.text||""}):e.jsx("span",{style:{color:"var(--text-primary)"},children:t.words.map((o,c)=>e.jsx(Ur,{word:o,showConfidence:n},c))}),Kr=({onPlayChunk:t,playingUrl:n,ollamaModel:s,isPlaying:o,isPlayingFullSession:c,onPlaySession:y,onPauseSession:u,currentTime:a,duration:l,onSeek:p,sessionSpeakers:h=[],onRetranscribeAll:d,onRenameSpeaker:i,onMergeSpeakers:g,onPlaySpeakerSample:v,onStopSpeakerSample:w,playingSpeakerId:C,waveformData:T,waveformLoading:j,waveformError:A})=>{const{currentSession:z,selectedSession:b,isRecording:f,generateSummary:m,isFullTranscribing:k}=fe(),{sendMessage:L,subscribe:B}=de(),{activeModelId:M}=ot(),{sttSettings:U}=vt(),{language:I,hybridTranscription:P,ollamaModel:D,ollamaUrl:F,ollamaContextSize:H}=kt(),[K,N]=r.useState("dialogue"),[ee,ne]=r.useState(!1),[O,xe]=r.useState(!1),ie=r.useRef(null),he=r.useRef(null),ue=r.useRef(new Map),[Te,Se]=r.useState(null),[ae,je]=r.useState(null),[Z,pe]=r.useState(!0),V=b||z,te=V?.chunks||[];r.useEffect(()=>{const x=B("chunk_created",()=>{ne(!0)}),_=B("chunk_transcribed",q=>{f&&ne(!0),je(G=>G===q.chunk.id?null:G),Se(q.chunk.id),setTimeout(()=>Se(null),2e3)});return()=>{x(),_()}},[B,f]),r.useEffect(()=>{ee&&ie.current&&(ie.current.scrollTo({top:ie.current.scrollHeight,behavior:"smooth"}),ne(!1))},[ee]);const Y=r.useMemo(()=>(te||[]).filter(x=>x&&x.status==="completed").flatMap(x=>x.dialogue&&Array.isArray(x.dialogue)&&x.dialogue.length>0?x.dialogue.filter(_=>_&&typeof _.start=="number").map(_=>({..._,start:_.start||0,end:_.end||0,text:_.text||"",speaker:_.speaker||"unknown"})):[]).sort((x,_)=>x.start-_.start),[te]),oe=a*1e3,se=r.useMemo(()=>{if(!o||Y.length===0)return-1;for(let x=0;x<Y.length;x++){const _=Y[x];if(oe>=_.start&&oe<_.end||x<Y.length-1&&oe>=_.end&&oe<Y[x+1].start)return x}return Y.length>0&&oe>=Y[Y.length-1].start?Y.length-1:-1},[oe,o,Y]);r.useEffect(()=>{if(!o||!Z||se<0)return;const x=ue.current.get(se);if(x&&ie.current){const _=ie.current,q=x.getBoundingClientRect(),G=_.getBoundingClientRect();q.top>=G.top&&q.bottom<=G.bottom||x.scrollIntoView({behavior:"smooth",block:"center"})}},[se,o,Z]);const ke=r.useCallback(x=>{const _=x/1e3;p(_)},[p]),me=r.useCallback((x,_)=>{_?ue.current.set(x,_):ue.current.delete(x)},[]),we=r.useCallback(x=>{const _={mic:"#4caf50",sys:"#2196f3",speakers:["#2196f3","#00bcd4","#3f51b5","#03a9f4","#673ab7","#5c6bc0"]};if(h.length>0){const q=h.find(G=>{if(x==="mic"||x==="–í—ã")return G.isMic;if(x==="sys"||x==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫")return!G.isMic&&G.localId===0;if(x.startsWith("Speaker ")){const le=parseInt(x.replace("Speaker ",""),10);return!G.isMic&&G.localId===le}if(x.startsWith("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ")){const le=parseInt(x.replace("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ",""),10);return!G.isMic&&G.localId===le-1}return G.displayName===x});if(q){const G=q.isMic?-1:q.localId,le=q.isMic?_.mic:_.speakers[Math.abs(G)%_.speakers.length];return{name:q.displayName,color:le}}}if(x==="mic"||x==="–í—ã")return{name:"–í—ã",color:_.mic};if(x==="sys"||x==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫")return{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:_.sys};if(x.startsWith("Speaker ")){const q=parseInt(x.replace("Speaker ",""),10)||0;return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${q+1}`,color:_.speakers[Math.abs(q)%_.speakers.length]}}if(x.startsWith("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ")){const q=parseInt(x.replace("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ",""),10)||1;return{name:x,color:_.speakers[Math.abs(q-1)%_.speakers.length]}}return{name:x,color:_.sys}},[h]),Re=x=>{if(!V)return;const _=s||D,q=U.activeProvider||"local";console.log("[handleRetranscribe] sttProvider:",q,"ollamaModel prop:",s,"settingsOllamaModel:",D,"effective:",_),je(x),L({type:"retranscribe_chunk",sessionId:V.id,data:x,model:M,language:I,sttProvider:q,hybridEnabled:P.enabled,hybridSecondaryModelId:P.secondaryModelId,hybridConfidenceThreshold:P.confidenceThreshold,hybridContextWords:P.contextWords,hybridUseLLMForMerge:P.useLLMForMerge,hybridMode:P.mode,hybridHotwords:P.hotwords,hybridOllamaModel:_,hybridOllamaUrl:F})},[S,X]=r.useState(!1),[J,re]=r.useState(null);r.useEffect(()=>{const x=B("summary_started",()=>{X(!0),re(null)}),_=B("summary_completed",()=>{X(!1)}),q=B("summary_error",G=>{X(!1),re(G.error)});return()=>{x(),_(),q()}},[B]);const ye=()=>{V&&m(V.id,s,F||"http://localhost:11434",H)};return e.jsxs("main",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(b||f)&&e.jsxs("div",{style:{flexShrink:0,backgroundColor:"var(--app-bg)",borderBottom:"1px solid var(--border)",padding:"0 0"},children:[V&&!f&&e.jsx(Rr,{session:V,isPlaying:o,isPlayingFullSession:c,onPlayPause:()=>{o?u():y(V.id)},onSeek:p,currentTime:a,duration:l||V.totalDuration/1e3,onRetranscribe:()=>d?.(),onImprove:()=>N("summary"),waveformData:T,waveformLoading:j,waveformError:A}),V&&te.length>0&&e.jsx("div",{style:{padding:"0 1.5rem"},children:e.jsx(cr,{activeTab:K,onTabChange:N,hasSummary:!!V.summary,isGeneratingSummary:S,isRecording:f,speakersCount:h.length})})]}),e.jsxs("div",{ref:ie,style:{flex:1,padding:"1rem 1.5rem",overflowY:"auto",overflowX:"hidden",position:"relative"},onScroll:()=>{o&&pe(!1)},children:[o&&Y.length>0&&K==="dialogue"&&e.jsx(Nr,{currentTimeMs:oe,segments:Y,scrollContainerRef:ie,dialogueContainerRef:he,segmentRefs:ue,onClickScrollToPlayback:()=>pe(!0)}),te.length===0&&!f&&!b?e.jsx(_r,{}):f?e.jsx(Pr,{}):e.jsxs(e.Fragment,{children:[K==="dialogue"&&e.jsx(e.Fragment,{children:Y.length>0?e.jsxs("div",{ref:he,style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"var(--surface)",borderRadius:"8px",lineHeight:"1.9",fontSize:"0.95rem",position:"relative"},children:[o&&e.jsx(Hr,{currentTimeMs:oe,segments:Y,dialogueContainerRef:he,segmentRefs:ue}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("h4",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.9rem"},children:"–î–∏–∞–ª–æ–≥"}),V&&e.jsx(ut,{dialogue:Y,totalDuration:V.totalDuration,isCompact:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o&&e.jsx("button",{onClick:()=>pe(!Z),style:{padding:"4px 10px",fontSize:"0.75rem",backgroundColor:Z?"var(--glass-bg-elevated)":"transparent",color:Z?"var(--text-primary)":"var(--text-muted)",border:Z?"1px solid var(--glass-border)":"1px solid var(--border)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s",backdropFilter:Z?"blur(8px)":"none",WebkitBackdropFilter:Z?"blur(8px)":"none"},title:Z?"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–∫–ª—é—á—ë–Ω":"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤—ã–∫–ª—é—á–µ–Ω",children:"üìç –°–ª–µ–¥–∏—Ç—å"}),e.jsx("button",{onClick:()=>xe(!O),style:{padding:"4px 10px",fontSize:"0.75rem",backgroundColor:O?"var(--glass-bg-elevated)":"transparent",color:O?"var(--text-primary)":"var(--text-muted)",border:O?"1px solid var(--glass-border)":"1px solid var(--border)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s",backdropFilter:O?"blur(8px)":"none",WebkitBackdropFilter:O?"blur(8px)":"none"},title:O?"–°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞ —Å –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–∂—ë–ª—Ç—ã–π <70%, –æ—Ä–∞–Ω–∂–µ–≤—ã–π <40%)",children:"üéØ Confidence"})]})]}),Y.map((x,_)=>{const q=x.start||0,G=Math.floor(q/6e4)||0,le=Math.floor(q%6e4/1e3)||0,Be=Math.floor(q%1e3/100)||0,Ie=`${G.toString().padStart(2,"0")}:${le.toString().padStart(2,"0")}.${Be}`,{name:$e,color:be}=we(x.speaker||""),ge=_===se;return e.jsxs("div",{ref:ze=>me(_,ze),onClick:()=>ke(x.start),style:{marginBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.25rem",paddingBottom:"0.25rem",borderLeft:`3px solid ${be}`,backgroundColor:ge?"rgba(138, 43, 226, 0.15)":"transparent",borderRadius:ge?"0 4px 4px 0":"0",transition:"background-color 0.2s ease",cursor:"pointer",position:"relative"},children:[ge&&e.jsx("div",{style:{position:"absolute",left:"-3px",top:0,bottom:0,width:"3px",backgroundColor:"var(--primary)",boxShadow:"0 0 8px var(--primary)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsxs("span",{style:{color:ge?"var(--primary)":"var(--text-muted)",fontSize:"0.8rem",fontFamily:"monospace",fontWeight:ge?"bold":"normal"},children:["[",Ie,"]"]})," ",e.jsxs("span",{style:{color:be,fontWeight:"bold"},children:[$e,":"]})," ",e.jsx(qr,{segment:x,showConfidence:O,isCurrentSegment:ge})]},_)})]}):(te||[]).filter(x=>x).map(x=>e.jsx("div",{style:{marginBottom:"0.8rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.03)",borderRadius:"4px",color:"#ccc"},children:x.transcription||""},x.id||Math.random()))}),K==="chunks"&&V&&e.jsx(Wr,{chunks:te,sessionId:V.id,playingUrl:n,highlightedChunkId:Te,transcribingChunkId:ae,isFullTranscribing:k,onPlayChunk:t,onRetranscribe:Re}),K==="stats"&&V&&e.jsx(ut,{dialogue:Y,totalDuration:V.totalDuration}),K==="speakers"&&V&&i&&e.jsx(ur,{sessionId:V.id,speakers:h,onRename:i,onMergeSpeakers:g,onPlaySample:v,onStopSample:w,playingSpeakerId:C}),K==="summary"&&V&&e.jsx(pr,{summary:V.summary||null,isGenerating:S,error:J,onGenerate:ye,hasTranscription:te.some(x=>x.status==="completed"),sessionDate:V.startTime,ollamaModel:s})]})]})]})},Xr=t=>{const n=Math.floor(t/3600),s=Math.floor(t%3600/60),o=Math.floor(t%60);return n>0?`${n}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},Yr=({onStop:t})=>{const{isRecording:n,currentSession:s}=fe(),[o,c]=r.useState(0),[y,u]=r.useState(Array(32).fill(.3)),a=r.useRef(null),[l,p]=r.useState(n),[h,d]=r.useState(!1);return r.useEffect(()=>{if(n)p(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d(!0)})});else{d(!1);const i=setTimeout(()=>{p(!1)},300);return()=>clearTimeout(i)}},[n]),r.useEffect(()=>{let i;if(n&&s){const g=new Date(s.startTime).getTime();i=setInterval(()=>{const v=new Date().getTime();c(Math.floor((v-g)/1e3))},100)}else c(0);return()=>clearInterval(i)},[n,s]),r.useEffect(()=>{if(!n)return;const i=()=>{u(g=>g.map((v,w)=>{const C=.3+Math.sin(Date.now()/200+w*.5)*.2,T=Math.random()*.4;return Math.min(1,Math.max(.1,C+T))})),a.current=requestAnimationFrame(i)};return i(),()=>{a.current&&cancelAnimationFrame(a.current)}},[n]),l?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:100,background:"linear-gradient(180deg, rgba(239, 68, 68, 0.15) 0%, transparent 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",borderBottom:"1px solid rgba(239, 68, 68, 0.2)",padding:"0.5rem 1.5rem",paddingTop:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"2rem",WebkitAppRegion:"drag",opacity:h?1:0,transform:h?"translateY(0)":"translateY(-100%)",transition:"opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("div",{style:{position:"relative",width:"12px",height:"12px"},children:[e.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"#ef4444",animation:"recordPulseRing 1.5s infinite"}}),e.jsx("div",{style:{position:"absolute",inset:"2px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 12px rgba(239, 68, 68, 0.8)"}})]}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:600,color:"#ef4444",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ó–∞–ø–∏—Å—å"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"2px",height:"28px"},children:y.map((i,g)=>e.jsx("div",{style:{width:"3px",height:`${i*100}%`,minHeight:"4px",background:`linear-gradient(to top, rgba(239, 68, 68, 0.6), rgba(239, 68, 68, ${.3+i*.7}))`,borderRadius:"2px",transition:"height 0.1s ease-out"}},g))}),e.jsx("div",{style:{fontFamily:"SF Mono, Menlo, Monaco, monospace",fontSize:"1.2rem",fontWeight:700,color:"var(--text-primary)",minWidth:"80px",textAlign:"center",letterSpacing:"0.02em"},children:Xr(o)}),e.jsxs("button",{onClick:t,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1.25rem",background:"rgba(239, 68, 68, 0.9)",border:"none",borderRadius:"9999px",color:"white",fontSize:"0.9rem",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",boxShadow:"0 2px 12px rgba(239, 68, 68, 0.4)",WebkitAppRegion:"no-drag"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(220, 38, 38, 1)",i.currentTarget.style.transform="scale(1.02)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(239, 68, 68, 0.9)",i.currentTarget.style.transform="scale(1)"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})}),"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"]}),e.jsx("style",{children:`
                @keyframes recordPulseRing {
                    0%, 100% {
                        transform: scale(1);
                        opacity: 1;
                    }
                    50% {
                        transform: scale(1.8);
                        opacity: 0;
                    }
                }
            `})]})}):null},Gr=()=>{const t=r.useRef(null),[n,s]=r.useState(null),[o,c]=r.useState(!1),[y,u]=r.useState(0),[a,l]=r.useState(0),[p,h]=r.useState(0),[d,i]=r.useState(0),g=r.useRef(null),v=r.useRef(null),w=r.useRef(null),C=r.useRef(!1),T=r.useRef(null),j=r.useRef(null),A=r.useRef(null),z=r.useRef(0);r.useEffect(()=>{const D=new Audio;return D.crossOrigin="anonymous",D.onended=()=>{s(null),c(!1),b()},D.onerror=F=>{console.error("[useAudioPlayer] Audio error:",F),s(null),c(!1),b()},D.ontimeupdate=()=>u(D.currentTime),D.onloadedmetadata=()=>l(D.duration),D.onplay=()=>c(!0),D.onpause=()=>c(!1),t.current=D,()=>{D.pause(),A.current!==null&&cancelAnimationFrame(A.current),g.current&&g.current.close(),t.current=null}},[]);const b=r.useCallback(()=>{h(0),i(0),A.current!==null&&(cancelAnimationFrame(A.current),A.current=null)},[]),f=D=>{let F=0;for(let H=0;H<D.length;H++){const K=D[H];F+=K*K}return Math.sqrt(F/D.length)},m=D=>{if(D<=0)return 0;const F=20*Math.log10(D),H=-50,N=(F-H)/(0-H)*100;return Math.max(0,Math.min(100,N))},k=r.useCallback(()=>{const D=t.current;if(!D||C.current)return;g.current||(g.current=new AudioContext),g.current.state==="suspended"&&g.current.resume();const F=g.current.createMediaElementSource(D),H=g.current.createChannelSplitter(2);v.current=g.current.createAnalyser(),w.current=g.current.createAnalyser(),v.current.fftSize=128,w.current.fftSize=128,v.current.smoothingTimeConstant=0,w.current.smoothingTimeConstant=0,T.current=new Float32Array(v.current.fftSize),j.current=new Float32Array(w.current.fftSize);const K=g.current.createChannelMerger(2);F.connect(H),H.connect(v.current,0),H.connect(w.current,1),v.current.connect(K,0,0),w.current.connect(K,0,1),K.connect(g.current.destination),C.current=!0},[]),L=r.useCallback(()=>{const D=v.current,F=w.current,H=t.current;if(!H||H.paused||H.ended){b();return}const K=H.currentTime;if(Math.abs(K-z.current)>.02&&(z.current=K,u(K)),D&&F&&T.current&&j.current){D.getFloatTimeDomainData(T.current),F.getFloatTimeDomainData(j.current);const N=f(T.current),ee=f(j.current),ne=m(N),O=m(ee);ir.flushSync(()=>{h(ne),i(O)})}A.current=requestAnimationFrame(L)},[b]),B=r.useCallback(D=>{const F=t.current;if(F){if(A.current!==null&&(cancelAnimationFrame(A.current),A.current=null),n===D){F.pause(),F.currentTime=0,s(null),u(0),z.current=0,b();return}F.src=D,u(0),z.current=0,k(),F.play().then(()=>{s(D),A.current=requestAnimationFrame(L)}).catch(H=>{console.error("Failed to play audio:",H),b(),s(null)})}},[n,k,L,b]),M=r.useCallback(()=>{t.current&&!t.current.paused&&t.current.pause()},[]),U=r.useCallback(()=>{t.current&&(t.current.pause(),t.current.currentTime=0,s(null),c(!1),b())},[b]),I=r.useCallback(D=>{t.current&&(t.current.currentTime=D)},[]),P=r.useCallback(D=>n===D&&o,[n,o]);return{play:B,pause:M,stop:U,seek:I,isPlayingUrl:P,isPlaying:o,playingUrl:n,currentTime:y,duration:a,micLevel:p,sysLevel:d}},Jr=({shortcuts:t,enabled:n=!0})=>{const s=r.useCallback(o=>{if(!n)return;const c=o.target,y=document.activeElement;if(!(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable||y?.tagName==="INPUT"||y?.tagName==="TEXTAREA"||y?.isContentEditable))for(const a of t){if(a.enabled===!1)continue;const l=o.key.toLowerCase()===a.key.toLowerCase(),p=a.ctrl?o.ctrlKey||o.metaKey:!o.ctrlKey,h=a.shift?o.shiftKey:!o.shiftKey,d=a.alt?o.altKey:!o.altKey;if(a.meta&&o.metaKey,a.meta){if(l&&o.metaKey&&!o.shiftKey&&!o.altKey){o.preventDefault(),a.action();return}}else if(a.ctrl){if(l&&(o.ctrlKey||o.metaKey)&&!o.shiftKey&&!o.altKey){o.preventDefault(),a.action();return}}else if(l&&p&&h&&d&&!o.ctrlKey&&!o.metaKey&&!o.altKey){o.preventDefault(),a.action();return}}},[t,n]);return r.useEffect(()=>(window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)),[s]),{shortcuts:t.filter(o=>o.enabled!==!1).map(o=>({key:o.key,modifiers:[o.meta&&"‚åò",o.ctrl&&"Ctrl",o.shift&&"‚áß",o.alt&&"‚å•"].filter(Boolean).join("+"),description:o.description}))}},Qr=t=>{const n=[];return t.onStartStop&&n.push({key:"r",meta:!0,action:t.onStartStop,description:t.isRecording?"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å":"–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"}),t.onPlayPause&&n.push({key:" ",action:t.onPlayPause,description:t.isPlaying?"–ü–∞—É–∑–∞":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",enabled:!t.isRecording}),t.onSeekForward&&n.push({key:"ArrowRight",action:t.onSeekForward,description:"–í–ø–µ—Ä—ë–¥ 10 —Å–µ–∫",enabled:!t.isRecording}),t.onSeekBackward&&n.push({key:"ArrowLeft",action:t.onSeekBackward,description:"–ù–∞–∑–∞–¥ 10 —Å–µ–∫",enabled:!t.isRecording}),t.onToggleSettings&&n.push({key:",",meta:!0,action:t.onToggleSettings,description:"–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"}),t.onCopyTranscription&&n.push({key:"c",meta:!0,shift:!0,action:t.onCopyTranscription,description:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é"}),t.onExportTXT&&n.push({key:"e",meta:!0,action:t.onExportTXT,description:"–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT"}),t.onShowHelp&&n.push({key:"?",action:t.onShowHelp,description:"–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"}),n},Zr=["audio/mp3","audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/m4a","audio/x-m4a","audio/mp4","audio/ogg","audio/webm","audio/flac"],en=({onFileDrop:t,acceptedTypes:n=Zr,enabled:s=!0})=>{const[o,c]=r.useState(!1),[y,u]=r.useState(!1),[a,l]=r.useState(null),[p,h]=r.useState(null),d=r.useRef(0),i=r.useCallback(j=>{if(n.includes(j.type))return!0;const A=j.name.split(".").pop()?.toLowerCase();return!!(A&&["mp3","wav","m4a","ogg","webm","flac","aac"].includes(A))},[n]),g=r.useCallback(j=>{s&&(j.preventDefault(),j.stopPropagation())},[s]),v=r.useCallback(j=>{s&&(j.preventDefault(),j.stopPropagation(),d.current++,j.dataTransfer.items&&j.dataTransfer.items.length>0&&c(!0))},[s]),w=r.useCallback(j=>{s&&(j.preventDefault(),j.stopPropagation(),d.current--,d.current===0&&c(!1))},[s]),C=r.useCallback(async j=>{if(!s)return;j.preventDefault(),j.stopPropagation(),c(!1),d.current=0;const A=Array.from(j.dataTransfer.files);if(A.length===0)return;const z=A[0];if(!i(z)){h(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: ${z.type||z.name.split(".").pop()}`);return}u(!0),l("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞..."),h(null);try{await t(z),l(null)}catch(b){h(b.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞")}finally{u(!1)}},[s,i,t]),T=r.useCallback(()=>{h(null)},[]);return r.useEffect(()=>()=>{d.current=0},[]),{isDragging:o,isProcessing:y,progress:a,error:p,dragHandlers:{onDragOver:g,onDragEnter:v,onDragLeave:w,onDrop:C},clearError:T}},Le={container:{position:"fixed",inset:0,background:"rgba(138, 43, 226, 0.15)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,pointerEvents:"none"},content:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"2px dashed var(--primary)"},icon:{fontSize:"3rem",marginBottom:"1rem"},title:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)"},subtitle:{fontSize:"0.85rem",color:"var(--text-muted)",marginTop:"0.5rem"}},Pe=()=>"__TAURI__"in window,tn=()=>{const[t,n]=r.useState({microphone:!1,screenRecording:!1,loading:!0,error:null}),s=r.useCallback(async()=>{if(!Pe())return!0;try{const a=await Ve("plugin:macos-permissions|check_microphone_permission");return console.log("[Permissions] Microphone permission:",a),n(l=>({...l,microphone:a})),a}catch(a){return console.error("[Permissions] Failed to check microphone permission:",a),n(l=>({...l,error:String(a)})),!1}},[]),o=r.useCallback(async()=>{if(!Pe())return!0;try{return console.log("[Permissions] Requesting microphone permission..."),await Ve("plugin:macos-permissions|request_microphone_permission"),await new Promise(l=>setTimeout(l,1e3)),await s()}catch(a){return console.error("[Permissions] Failed to request microphone permission:",a),n(l=>({...l,error:String(a)})),!1}},[s]),c=r.useCallback(async()=>{if(!Pe())return!0;try{const a=await Ve("plugin:macos-permissions|check_screen_recording_permission");return console.log("[Permissions] Screen recording permission:",a),n(l=>({...l,screenRecording:a})),a}catch(a){return console.error("[Permissions] Failed to check screen recording permission:",a),n(l=>({...l,error:String(a)})),!1}},[]),y=r.useCallback(async()=>{if(!Pe())return!0;try{return console.log("[Permissions] Requesting screen recording permission..."),await Ve("plugin:macos-permissions|request_screen_recording_permission"),await new Promise(l=>setTimeout(l,500)),await c()}catch(a){return console.error("[Permissions] Failed to request screen recording permission:",a),n(l=>({...l,error:String(a)})),!1}},[c]),u=r.useCallback(async()=>{if(!Pe()){n({microphone:!0,screenRecording:!0,loading:!1,error:null});return}n(a=>({...a,loading:!0,error:null}));try{const[a,l]=await Promise.all([s(),c()]);n({microphone:a,screenRecording:l,loading:!1,error:null})}catch(a){n(l=>({...l,loading:!1,error:String(a)}))}},[s,c]);return r.useEffect(()=>{u()},[u]),{status:t,checkMicrophonePermission:s,requestMicrophonePermission:o,checkScreenRecordingPermission:c,requestScreenRecordingPermission:y,checkAllPermissions:u}};var rn={};const yt="2.0.11",un=({addLog:t})=>{const n=`http://localhost:${typeof process<"u"&&rn?.AIWISPER_HTTP_PORT||18080}`,{startSession:s,stopSession:o,isRecording:c,isStopping:y,isProcessingFinalChunks:u,selectedSession:a,micLevel:l,sysLevel:p,isFullTranscribing:h}=fe(),{activeModelId:d,models:i,fetchOllamaModels:g,downloadModel:v,cancelDownload:w,deleteModel:C,setActiveModel:T,ollamaModels:j,ollamaModelsLoading:A,ollamaError:z}=ot(),{sendMessage:b,subscribe:f,isTauri:m}=de(),{status:k,isLoading:L,error:B,segmentationModels:M,embeddingModels:U,enableDiarization:I,disableDiarization:P}=Sr(),{sttSettings:D}=vt(),{play:F,pause:H,playingUrl:K,seek:N,currentTime:ee,duration:ne,isPlaying:O,micLevel:xe,sysLevel:ie}=Gr(),{settings:he,isLoaded:ue,theme:Te,setTheme:Se,language:ae,setLanguage:je,micDevice:Z,setMicDevice:pe,captureSystem:V,setCaptureSystem:te,useVoiceIsolation:Y,setUseVoiceIsolation:oe,echoCancel:se,setEchoCancel:ke,ollamaModel:me,setOllamaModel:we,ollamaContextSize:Re,setOllamaContextSize:S,enableStreaming:X,pauseThreshold:J,streamingChunkSeconds:re,streamingConfirmationThreshold:ye,hybridTranscription:x,setHybridTranscription:_,ollamaUrl:q}=kt(),{requestMicrophonePermission:G,checkMicrophonePermission:le}=tn(),[Be,Ie]=r.useState(!1),[$e,be]=r.useState(!1),[ge,ze]=r.useState(!1),[Mt,Ue]=r.useState(!1),[Tt,qe]=r.useState(""),[Rt,It]=r.useState([]),[zt,Ke]=r.useState([]),[Et,Ee]=r.useState(null),ce=r.useRef(null),[At,st]=r.useState([]),[Dt,it]=r.useState(!1),[at,Xe]=r.useState(null),[lt,Ae]=r.useState("idle"),[Lt,We]=r.useState(null),Fe=r.useRef(null),[Pt,_t]=r.useState("auto"),[Bt,$t]=r.useState("auto");r.useEffect(()=>{const R=a?.id;if(!R){Fe.current=null,Xe(null),Ae("idle"),We(null);return}if(Fe.current===R&&at)return;let E=!1;return Ae("loading"),We(null),(async()=>{try{if(!m){Ae("error"),We("–¢—Ä–µ–±—É–µ—Ç—Å—è Tauri backend");return}const W=await b({type:"get_waveform",sessionId:R});if(E)return;if(W?.waveform)Xe(W.waveform),Fe.current=R,Ae("ready");else throw W?.error?new Error(W.error):new Error("waveform not available")}catch(W){if(E)return;console.error("Failed to build waveform",W),Xe(null),Fe.current=null,Ae("error"),We(W instanceof Error?W.message:String(W))}})(),()=>{E=!0}},[a?.id,m,b]),r.useEffect(()=>{(async()=>{try{const $=(await navigator.mediaDevices.enumerateDevices()).filter(W=>W.kind==="audioinput").map(W=>({id:W.deviceId,name:W.label||`Microphone ${W.deviceId}`,isInput:!0,isOutput:!1}));It($)}catch(E){console.error("Error fetching devices",E)}})()},[]),r.useEffect(()=>{const R=f("model_loading",W=>{Ue(!0),qe(W.modelName||W.modelId||"–º–æ–¥–µ–ª—å"),t(`–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏: ${W.modelName||W.modelId}...`)}),E=f("model_loaded",W=>{Ue(!1),qe(""),t(`–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${W.modelName||W.modelId}`)}),$=f("model_load_error",W=>{Ue(!1),qe(""),t(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: ${W.error}`)});return()=>{R(),E(),$()}},[f,t]),r.useEffect(()=>{const R=f("session_speakers",Q=>{Ke(Q.speakers||[])}),E=f("speaker_renamed",Q=>{Ke(sr=>sr.map(Oe=>Oe.localId===Q.localId?{...Oe,displayName:Q.newName,isRecognized:Q.savedAsVoiceprint||Oe.isRecognized}:Oe))}),$=f("speakers_merged",Q=>{console.log("[MainLayout] Speakers merged:",Q),Q.sessionId&&b({type:"get_session_speakers",sessionId:Q.sessionId})}),W=f("chunk_transcribed",Q=>{Q.sessionId&&b({type:"get_session_speakers",sessionId:Q.sessionId})});return()=>{R(),E(),$(),W()}},[f,b]),r.useEffect(()=>{a?b({type:"get_session_speakers",sessionId:a.id}):Ke([])},[a,b]);const ve=r.useCallback(async()=>{it(!0);try{if(m){const R=await b({type:"list_voiceprints"});R&&R.voiceprints&&st(R.voiceprints)}else{const E=await(await fetch(`${n}/api/voiceprints`)).json();st(E.voiceprints||[])}}catch(R){console.error("[refreshVoiceprints] Error:",R)}finally{it(!1)}},[n,m,b]);r.useEffect(()=>{ve()},[ve]);const Wt=r.useCallback((R,E,$)=>{a&&(b({type:"rename_session_speaker",sessionId:a.id,localSpeakerId:R,speakerName:E,saveAsVoiceprint:$}),console.log(`[MainLayout] Renaming speaker ${R} to "${E}"${$?" (saving voiceprint)":""}`))},[a,b]),Ft=r.useCallback((R,E,$,W,Q)=>{a&&(b({type:"merge_speakers",sessionId:a.id,sourceSpeakerIds:R,targetSpeakerId:E,speakerName:$,mergeEmbeddings:W,saveAsVoiceprint:Q}),console.log(`[MainLayout] Merging speakers ${R.join(", ")} into ${E} as "${$}"`))},[a,b]),Ot=r.useCallback(R=>{if(!a)return;ce.current&&(ce.current.pause(),ce.current=null);const E=`${n}/api/speaker-sample/${a.id}/${R}`,$=new Audio(E);ce.current=$,Ee(R),$.onended=()=>{Ee(null),ce.current=null},$.onerror=()=>{Ee(null),ce.current=null},$.play().catch(()=>{Ee(null),ce.current=null})},[a,n]),Vt=r.useCallback(()=>{ce.current&&(ce.current.pause(),ce.current=null),Ee(null)},[]),Ht=r.useCallback(async(R,E)=>{try{m?await b({type:"rename_voiceprint",id:R,name:E}):await fetch(`${n}/api/voiceprints/${R}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:E})}),ve()}catch($){console.error("[handleRenameVoiceprint] Error:",$)}},[n,m,b,ve]),Nt=r.useCallback(async R=>{try{m?await b({type:"delete_voiceprint",id:R}):await fetch(`${n}/api/voiceprints/${R}`,{method:"DELETE"}),ve()}catch(E){console.error("[handleDeleteVoiceprint] Error:",E)}},[n,m,b,ve]),Ut=r.useCallback((R,E,$)=>{I(R,E,$)},[I]),qt=r.useCallback(()=>{P()},[P]);r.useEffect(()=>{c&&X?(b({type:"enable_streaming",streamingChunkSeconds:re,streamingConfirmationThreshold:ye}),t(`Streaming transcription enabled (chunk=${re}s, threshold=${Math.round(ye*100)}%)`)):c||b({type:"disable_streaming"})},[c,X,re,ye,b,t]);const Ye=r.useCallback(async()=>{if(h&&!c){t("Cannot start recording during retranscription");return}if(c)await o(),t("Recording stopped");else{if(!d){alert("Please select a model first");return}if(m&&!await le()){if(t("Requesting microphone permission..."),!await G()){t("Microphone permission denied. Please grant access in System Preferences > Privacy & Security > Microphone"),alert(`–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.

–û—Ç–∫—Ä–æ–π—Ç–µ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ > –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å > –ú–∏–∫—Ä–æ—Ñ–æ–Ω –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –¥–ª—è AIWisper.`);return}t("Microphone permission granted")}try{await s({model:d,language:ae,micDevice:Z,captureSystem:V,useVoiceIsolation:Y,echoCancel:se,pauseThreshold:J,useNativeCapture:!0,hybridEnabled:x.enabled,hybridSecondaryModelId:x.secondaryModelId,hybridConfidenceThreshold:x.confidenceThreshold,hybridContextWords:x.contextWords,hybridUseLLMForMerge:x.useLLMForMerge,hybridMode:x.mode}),t("Recording started"),x.enabled&&x.secondaryModelId&&t(`Hybrid transcription enabled: secondary model = ${x.secondaryModelId}`)}catch(R){t(`Error starting session: ${R.message}`)}}},[c,h,o,s,d,ae,Z,V,Y,se,J,x,t,m,le,G]),Kt=r.useCallback(R=>{F(R)},[F]),Ge=r.useCallback(async R=>{if(m)try{const E=await b({type:"get_full_audio",sessionId:R});E&&typeof E=="string"?F(E):t("Failed to load session audio")}catch(E){console.error("[handlePlaySession] IPC error:",E),t("Error loading session audio")}else{const E=`${n}/api/sessions/${R}/full.mp3`;F(E)}},[n,F,m,b,t]),Xt=r.useCallback(()=>{if(console.log("[handleRetranscribeAll] Called, selectedSession:",a?.id),h){t("Retranscription already in progress");return}if(c){t("Cannot retranscribe during recording");return}if(!a){t("No session selected for retranscription");return}const R=i.find(Q=>Q.id===d),E=R?.id||d,$=D.activeProvider||"local";if(console.log("[handleRetranscribeAll] activeModel:",R?.name,"modelId:",E,"sttProvider:",$),!(R?.status==="downloaded"||R?.status==="active")&&d&&$==="local"){t(`Model not downloaded (status: ${R?.status}). Open model manager to download.`),be(!0);return}if(!E&&$==="local"){t("No model selected. Please select a model in settings."),be(!0);return}console.log("[handleRetranscribeAll] Sending retranscribe_full message"),b({type:"retranscribe_full",sessionId:a.id,model:E,language:ae,sttProvider:$,diarizationEnabled:!1,hybridEnabled:x.enabled,hybridSecondaryModelId:x.secondaryModelId,hybridConfidenceThreshold:x.confidenceThreshold,hybridContextWords:x.contextWords,hybridUseLLMForMerge:x.useLLMForMerge,hybridMode:x.mode,hybridHotwords:x.hotwords,hybridOllamaModel:me,hybridOllamaUrl:q}),t(`Starting full retranscription with ${$==="local"?"model: "+(R?.name||E):"cloud: "+$}, hybrid: ${x.enabled}`)},[a,i,d,ae,b,t,x,me,q,h,c,D]),Yt=r.useCallback(()=>{g(he.ollamaUrl)},[g,he.ollamaUrl]),{copyToClipboard:dt,exportTXT:ct}=Ct(),Gt=r.useCallback(()=>{a&&!c&&(O?H():Ge(a.id))},[a,c,O,H,Ge]),Jt=r.useCallback(()=>{!c&&ne>0&&N(Math.min(ee+10,ne))},[c,ne,ee,N]),Qt=r.useCallback(()=>{c||N(Math.max(ee-10,0))},[c,ee,N]),Zt=r.useCallback(async()=>{a&&await dt(a)&&t("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")},[a,dt,t]),er=r.useCallback(()=>{a&&(ct(a),t("–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT –∑–∞–≤–µ—Ä—à—ë–Ω"))},[a,ct,t]);Jr({shortcuts:Qr({onStartStop:Ye,onPlayPause:Gt,onSeekForward:Jt,onSeekBackward:Qt,onToggleSettings:()=>Ie(R=>!R),onCopyTranscription:Zt,onExportTXT:er,onShowHelp:()=>ze(!0),isRecording:c,isPlaying:O}),enabled:!ge&&!$e});const tr=r.useCallback(async R=>{try{if(m){t("Import not yet implemented in Tauri build");return}const E=new FormData;E.append("audio",R),E.append("model",d||""),E.append("language",ae);const $=await fetch(`${n}/api/import`,{method:"POST",body:E});if(!$.ok){const Q=await $.text();throw new Error(Q||`HTTP ${$.status}`)}const W=await $.json();t(`–§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, —Å–µ—Å—Å–∏—è: ${W.sessionId||"—Å–æ–∑–¥–∞–Ω–∞"}`),t("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ")}catch(E){throw t(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${E.message}`),E}},[t,n,d,ae,m]),{isDragging:rr,isProcessing:nr,dragHandlers:or}=en({onFileDrop:tr,enabled:!c});return ue?e.jsxs("div",{className:"app-frame",style:{display:"flex",flexDirection:"column",height:"100vh",background:"var(--app-bg)",color:"var(--text-primary)"},...or,children:[rr&&e.jsx("div",{style:Le.container,children:e.jsxs("div",{style:Le.content,children:[e.jsx("div",{style:Le.icon,children:"üìÅ"}),e.jsx("div",{style:Le.title,children:"–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å—é–¥–∞"}),e.jsx("div",{style:Le.subtitle,children:"MP3, WAV, M4A, OGG, FLAC"})]})}),nr&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"1px solid var(--glass-border)"},children:[e.jsx("div",{style:{width:"48px",height:"48px",margin:"0 auto 1.5rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)"},children:"–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞..."})]})}),Mt&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"1px solid var(--glass-border)",maxWidth:"400px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",margin:"0 auto 1.5rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)",marginBottom:"0.5rem"},children:"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏"}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginBottom:"1rem"},children:Tt}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",opacity:.7},children:"–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 30 —Å–µ–∫—É–Ω–¥"})]})}),e.jsx("style",{children:`
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `}),e.jsx(Yr,{onStop:Ye}),y&&u&&e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:100,background:"linear-gradient(180deg, rgba(245, 158, 11, 0.15) 0%, transparent 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",borderBottom:"1px solid rgba(245, 158, 11, 0.2)",padding:"0.5rem 1.5rem",paddingTop:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",WebkitAppRegion:"drag"},children:[e.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(245, 158, 11, 0.3)",borderTopColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:600,color:"#f59e0b",letterSpacing:"0.02em"},children:"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç..."})]}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden",marginTop:c||y&&u?"48px":0,transition:"margin-top 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx(wr,{onStartRecording:Ye}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(Cr,{showSettings:Be,setShowSettings:Ie,onShowHelp:()=>ze(!0)}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsx(Tr,{children:e.jsx(Kr,{onPlayChunk:Kt,playingUrl:K,ollamaModel:me,isPlaying:O,isPlayingFullSession:K?.includes("/full.mp3")??!1,onPlaySession:Ge,onPauseSession:H,currentTime:ee,duration:ne,onSeek:N,sessionSpeakers:zt,onRetranscribeAll:Xt,onRenameSpeaker:Wt,onMergeSpeakers:Ft,onPlaySpeakerSample:Ot,onStopSpeakerSample:Vt,playingSpeakerId:Et,waveformData:at,waveformLoading:lt==="loading",waveformError:lt==="error"?Lt||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ":null})}),e.jsx(mr,{micLevel:O?xe:l,sysLevel:O?ie:p,isActive:c||O})]})]})]}),$e&&e.jsx(gr,{models:i,activeModelId:d,onClose:()=>be(!1),onDownload:v,onCancelDownload:w,onDelete:C,onSetActive:T}),e.jsx(hr,{isOpen:Be,onClose:()=>Ie(!1),devices:Rt.map(R=>({...R,isInput:!0})),micDevice:Z,setMicDevice:pe,captureSystem:V,setCaptureSystem:te,vadMode:Pt,setVADMode:_t,vadMethod:Bt,setVADMethod:$t,screenCaptureKitAvailable:!0,useVoiceIsolation:Y,setUseVoiceIsolation:oe,echoCancel:se,setEchoCancel:ke,language:ae,setLanguage:je,theme:Te,setTheme:Se,ollamaModel:me,setOllamaModel:we,ollamaContextSize:Re,setOllamaContextSize:S,ollamaModels:j,ollamaModelsLoading:A,ollamaError:z,loadOllamaModels:Yt,onShowModelManager:()=>be(!0),activeModelId:d,models:i,diarizationStatus:k,diarizationLoading:L,diarizationError:B,segmentationModels:M,embeddingModels:U,onEnableDiarization:Ut,onDisableDiarization:qt,hybridTranscription:x,onHybridTranscriptionChange:_,voiceprints:At,voiceprintsLoading:Dt,onRenameVoiceprint:Ht,onDeleteVoiceprint:Nt,onRefreshVoiceprints:ve,appVersion:yt}),e.jsx(fr,{isOpen:ge,onClose:()=>ze(!1),appVersion:yt}),e.jsx(Mr,{})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"var(--app-bg)",color:"var(--text-primary)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",margin:"0 auto 1rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫..."})]})})};export{cn as A,dn as D,an as M,ln as S,un as a};
