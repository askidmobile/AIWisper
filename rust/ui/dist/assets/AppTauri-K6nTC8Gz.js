import{r as c,j as o}from"./index-CEWwOppT.js";import{invoke as b,transformCallback as v}from"./core-DhEqZVGG.js";import{B as I,P as w,S as M}from"./AudioMeterSidebar-GSMkGYtm.js";import{M as E,S as x,D as T,A,a as S}from"./MainLayout-CDGwocY3.js";var g;(function(r){r.WINDOW_RESIZED="tauri://resize",r.WINDOW_MOVED="tauri://move",r.WINDOW_CLOSE_REQUESTED="tauri://close-requested",r.WINDOW_DESTROYED="tauri://destroyed",r.WINDOW_FOCUS="tauri://focus",r.WINDOW_BLUR="tauri://blur",r.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",r.WINDOW_THEME_CHANGED="tauri://theme-changed",r.WINDOW_CREATED="tauri://window-created",r.WEBVIEW_CREATED="tauri://webview-created",r.DRAG_ENTER="tauri://drag-enter",r.DRAG_OVER="tauri://drag-over",r.DRAG_DROP="tauri://drag-drop",r.DRAG_LEAVE="tauri://drag-leave"})(g||(g={}));async function D(r,d){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(r,d),await b("plugin:event|unlisten",{event:r,eventId:d})}async function m(r,d,h){var l;const _=(l=void 0)!==null&&l!==void 0?l:{kind:"Any"};return b("plugin:event|listen",{event:r,target:_,handler:v(d)}).then(p=>async()=>D(r,p))}const f=()=>"__TAURI__"in window,P={start_session:"start_recording",stop_session:"stop_recording",get_sessions:"list_sessions",get_session:"get_session",get_session_speakers:"get_session_speakers",delete_session:"delete_session",rename_session:"rename_session",update_session_tags:"update_session_tags",export_session:"export_session",get_models:"list_models",download_model:"download_model",cancel_download:"cancel_download",delete_model:"delete_model",set_active_model:"set_active_model",get_ollama_models:"get_ollama_models",set_language:"set_language",set_hotwords:"set_hotwords",transcribe_file:"transcribe_file",get_waveform:"get_waveform",get_chunk_audio:"get_chunk_audio",get_full_audio:"get_full_audio",retranscribe_chunk:"retranscribe_chunk",retranscribe_full:"retranscribe_full",get_settings:"get_settings",set_settings:"set_settings",get_audio_devices:"get_audio_devices",list_voiceprints:"list_voiceprints",create_voiceprint:"create_voiceprint",rename_voiceprint:"rename_voiceprint",delete_voiceprint:"delete_voiceprint",get_speaker_sample:"get_speaker_sample",enable_diarization:"enable_diarization",disable_diarization:"disable_diarization",get_diarization_status:"get_diarization_status",generate_summary:"generate_summary",cancel_full_transcription:"cancel_full_transcription"},z={"transcript-segment":"chunk_transcribed","recording-state":"audio_level","audio-level":"audio_level","session-started":"session_started","session-stopped":"session_stopped","model-download-progress":"model_download_progress","model-loading":"model_loading","model-loaded":"model_loaded","model-load-error":"model_load_error","active-model-changed":"active_model_changed",error:"error",full_transcription_started:"full_transcription_started",full_transcription_progress:"full_transcription_progress",full_transcription_completed:"full_transcription_completed",full_transcription_cancelled:"full_transcription_cancelled",chunk_transcribed:"chunk_transcribed",summary_started:"summary_started",summary_completed:"summary_completed",summary_error:"summary_error"},O=({children:r})=>{const[d,h]=c.useState(!1),l=c.useRef(new Map),_=c.useRef([]),p=c.useCallback((e,i)=>(l.current.has(e)||l.current.set(e,new Set),l.current.get(e)?.add(i),()=>{l.current.get(e)?.delete(i)}),[]),t=c.useCallback((e,i)=>{const n=l.current.get(e);n&&n.forEach(s=>s(i))},[]),k=c.useCallback(async e=>{if(!f()){console.warn("[Tauri] Not running in Tauri, message dropped:",e);return}const i=e.type;if(i==="disable_streaming")return;const n=P[i];if(!n){console.warn("[Tauri] Unknown message type:",i);return}try{let s={};switch(i){case"start_session":s={deviceId:e.deviceId||null,captureSystem:e.captureSystem??!1,language:e.language||null};break;case"get_session":case"delete_session":case"get_session_speakers":s={sessionId:e.sessionId};break;case"rename_session":s={sessionId:e.sessionId,newTitle:e.title||e.newTitle};break;case"update_session_tags":s={sessionId:e.sessionId,tags:e.tags||[]};break;case"export_session":s={sessionId:e.sessionId,format:e.format,path:e.path};break;case"set_language":s={language:e.language};break;case"set_hotwords":s={hotwords:e.hotwords||[]};break;case"download_model":case"cancel_download":case"delete_model":case"set_active_model":s={modelId:e.modelId};break;case"get_ollama_models":s={url:e.url||"http://localhost:11434"};break;case"set_settings":s={settings:e.settings};break;case"transcribe_file":s={path:e.path};break;case"get_waveform":s={sessionId:e.sessionId};break;case"get_chunk_audio":s={sessionId:e.sessionId,chunkIndex:e.chunkIndex};break;case"get_full_audio":s={sessionId:e.sessionId};break;case"rename_voiceprint":s={id:e.id,name:e.name};break;case"delete_voiceprint":s={id:e.id};break;case"create_voiceprint":s={name:e.name,embedding:e.embedding,source:e.source};break;case"get_speaker_sample":s={sessionId:e.sessionId,speakerId:e.speakerId};break;case"enable_diarization":s={segmentationModelPath:e.segmentationModelPath||"",embeddingModelPath:e.embeddingModelPath||"",provider:e.diarizationProvider||"coreml"};break;case"disable_diarization":s={};break;case"get_diarization_status":s={};break;case"retranscribe_chunk":s={sessionId:e.sessionId,chunkId:e.data,model:e.model||"",language:e.language||"",sttProvider:e.sttProvider||"local",hybridEnabled:e.hybridEnabled||null,hybridSecondaryModelId:e.hybridSecondaryModelId||null,hybridUseLlmForMerge:e.hybridUseLLMForMerge||!1,hybridMode:e.hybridMode||"parallel",ollamaModel:e.hybridOllamaModel||"",ollamaUrl:e.hybridOllamaUrl||"http://localhost:11434"};break;case"retranscribe_full":s={sessionId:e.sessionId,model:e.model||"",language:e.language||"",sttProvider:e.sttProvider||"local",hybridEnabled:e.hybridEnabled||!1,hybridSecondaryModelId:e.hybridSecondaryModelId||"",hybridUseLlmForMerge:e.hybridUseLLMForMerge||!1,hybridMode:e.hybridMode||"parallel",ollamaModel:e.hybridOllamaModel||"",ollamaUrl:e.hybridOllamaUrl||"http://localhost:11434"};break;case"generate_summary":s={sessionId:e.sessionId,ollamaModel:e.ollamaModel||"llama3.2",ollamaUrl:e.ollamaUrl||"http://localhost:11434",ollamaContextSize:e.ollamaContextSize||8};break}console.log(`[Tauri] Invoking command: ${n}`,s);const a=await b(n,s);switch(console.log(`[Tauri] Command ${n} returned:`,typeof a,Array.isArray(a)?`array of ${a.length}`:a),i){case"start_session":t("session_started",{session:a});break;case"stop_session":t("session_stopped",{session:a});break;case"get_sessions":t("sessions_list",{sessions:a});break;case"get_session":t("session_details",{session:a});break;case"get_session_speakers":t("session_speakers",{speakers:a});break;case"get_models":return console.log("[Tauri] get_models result:",a),console.log("[Tauri] First model status:",Array.isArray(a)&&a.length>0?a[0].status:"N/A"),t("models_list",{models:a}),{models:a};case"get_ollama_models":return a;case"get_settings":return t("settings",{settings:a}),a;case"get_waveform":return console.log("[Tauri] get_waveform result:",a),console.log("[Tauri] waveform has peaks?",a?.peaks?`yes, ${a.peaks.length} channels`:"no"),{waveform:a};case"get_chunk_audio":case"get_full_audio":case"get_speaker_sample":return a;case"list_voiceprints":return console.log("[Tauri] list_voiceprints result:",a),a;case"enable_diarization":t("diarization_enabled",{diarizationProvider:a?.provider||"coreml"});break;case"disable_diarization":t("diarization_disabled",{});break;case"get_diarization_status":const u=a;t("diarization_status",{diarizationEnabled:u?.enabled||!1,diarizationProvider:u?.provider||""});break;case"retranscribe_chunk":t("chunk_transcribed",a);break;case"retranscribe_full":break}}catch(s){console.error(`[Tauri] Command ${n} failed:`,s),t("error",{message:String(s)})}},[t]);c.useEffect(()=>{if(!f()){console.log("[Tauri] Not running in Tauri environment");return}return console.log("[Tauri] Setting up event listeners"),h(!0),(async()=>{for(const[n,s]of Object.entries(z)){const a=await m(n,u=>{console.log(`[Tauri] Event received: ${n}`,u.payload),t(s,u.payload)});_.current.push(a)}const i=await m("message",n=>{const s=n.payload;s?.type&&t(s.type,s)});_.current.push(i)})(),()=>{_.current.forEach(i=>i()),_.current=[]}},[t]);const y={isConnected:d,isTauri:!0,sendMessage:k,subscribe:p};return o.jsx(I.Provider,{value:y,children:r})},R=()=>"__TAURI__"in window,L=()=>{const r=c.useCallback(d=>{console.log(`[AIWisper] ${d}`)},[]);return R()?o.jsx(O,{children:o.jsx(E,{children:o.jsx(C,{children:o.jsx(x,{children:o.jsx(w,{children:o.jsx(T,{children:o.jsx(A,{children:o.jsx(S,{addLog:r})})})})})})})}):o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"#0a0a14",color:"#fff",flexDirection:"column",gap:"1rem"},children:[o.jsx("h1",{children:"AIWisper"}),o.jsx("p",{children:"This app requires Tauri runtime."}),o.jsxs("p",{style:{color:"#888",fontSize:"0.875rem"},children:["Please run with: ",o.jsx("code",{children:"cargo tauri dev"})]})]})},C=({children:r})=>o.jsx(M,{children:r});export{L as AppTauri,L as default};
