var i={};let n=null;try{n=require("@grpc/grpc-js")}catch{n=null}const s={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},a="/aiwisper.Control/Stream",o=e=>Buffer.from(JSON.stringify(e)),l=e=>JSON.parse(e.toString("utf8"));function c(){const e=typeof process<"u"?i.AIWISPER_GRPC_ADDR:void 0;return e&&e.trim().length>0?e:typeof process<"u"&&process.platform==="win32"?"npipe:\\\\.\\pipe\\aiwisper-grpc":"unix:/tmp/aiwisper-grpc.sock"}class h{readyState=s.CONNECTING;onopen=null;onmessage=null;onclose=null;onerror=null;client=null;call=null;address;constructor(t){this.address=t||c(),this.connect()}connect(){if(!n){this.readyState=s.CLOSED,setTimeout(()=>{this.onerror?.(new Error("gRPC not available in this environment")),this.onclose?.()},0);return}this.client=new n.Client(this.address,n.credentials.createInsecure(),{"grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1}),this.call=this.client.makeBidiStreamRequest(a,o,l),this.readyState=s.OPEN,setTimeout(()=>{this.onopen?.()},0),this.call.on("data",t=>{const r=JSON.stringify(t);this.onmessage?.({data:r})}),this.call.on("end",()=>{this.readyState=s.CLOSED,this.onclose?.()}),this.call.on("error",t=>{this.readyState=s.CLOSED,this.onerror?.(t),this.onclose?.(t)})}send(t){if(this.readyState!==s.OPEN||!this.call)throw new Error("gRPC not connected");let r={};try{r=JSON.parse(t)}catch{r={raw:t}}this.call.write(r)}close(){this.readyState=s.CLOSING,this.call&&this.call.end(),this.client&&this.client.close(),this.readyState=s.CLOSED}}function d(e){return new h(e)}export{s as R,d as c};
