import{r,j as e,_ as yt,a as or}from"./index-CEWwOppT.js";import{u as le,j as he,a as De,g as sr,f as Ge,b as ir,W as ar,k as bt,d as lr,i as ct,e as dr,h as cr,A as ur,M as pr,c as mr,H as gr}from"./AudioMeterSidebar-GSMkGYtm.js";import{invoke as Ve}from"./core-DhEqZVGG.js";const vt=r.createContext(null),on=({children:t})=>{const{sendMessage:n,subscribe:s,isConnected:o}=le(),[d,p]=r.useState([]),[c,m]=r.useState(null),[a,l]=r.useState(!1),[h,u]=r.useState([]),[i,g]=r.useState(null),[y,C]=r.useState(!1),M=r.useRef(!1);r.useEffect(()=>{if(!o||M.current)return;M.current=!0,(async()=>{try{const f=await n({type:"get_settings"});console.log("[Model] Loaded settings from backend:",f);const w=f?.whisperModel||f?.whisper_model;w&&(console.log("[Model] Setting active model from backend settings:",w),m(w))}catch(f){console.error("[Model] Failed to load settings:",f)}})()},[o,n]),r.useEffect(()=>{console.log("[Model] isConnected changed to:",o),o&&(async()=>{console.log("[Model] Fetching models...");try{const f=await n({type:"get_models"});console.log("[Model] Result from sendMessage:",f),console.log("[Model] Result type:",typeof f),console.log("[Model] Result keys:",f?Object.keys(f):"null"),f&&f.models?(console.log("[Model] Setting models from direct result:",f.models.length,"models"),console.log("[Model] Downloaded models:",f.models.filter(w=>w.status==="downloaded").map(w=>w.id)),p(f.models)):console.warn("[Model] No models in result, result was:",f)}catch(f){console.error("[Model] Error fetching models:",f)}})()},[o,n]),r.useEffect(()=>{if(!o||d.length===0||!c)return;const x=d.find(f=>f.id===c);x&&(x.status==="downloaded"||x.status==="active")&&(console.log("[Model] Confirming active model with backend:",c),n({type:"set_active_model",modelId:c}))},[o,d]),r.useEffect(()=>{o||l(!1)},[o]),r.useEffect(()=>{const x=s("models_list",R=>{console.log("[Model] models_list event received:",R),console.log("[Model] Downloaded models from event:",(R.models||[]).filter(E=>E.status==="downloaded").map(E=>E.id)),p(R.models||[]);const N=(R.models||[]).find(E=>E.status==="active");N&&(console.log("[Model] Backend confirmed active model from models_list:",N.id),l(!0),m(N.id))}),f=s("model_progress",R=>{p(N=>N.map(E=>E.id===R.modelId?{...E,status:R.data,progress:R.progress,error:R.error}:E))}),w=s("active_model_changed",R=>{console.log("[Model] Backend confirmed active model changed:",R.modelId),l(!0),m(R.modelId)}),_=s("model_deleted",()=>n({type:"get_models"})),B=s("ollama_models",R=>{C(!1),R.error?(g(R.error),u([])):(g(null),u(R.ollamaModels||[]))});return()=>{x(),f(),w(),_(),B()}},[s,n]);const I=x=>n({type:"download_model",modelId:x}),v=x=>n({type:"cancel_download",modelId:x}),S=x=>n({type:"delete_model",modelId:x}),T=x=>{n({type:"set_active_model",modelId:x})},j=async x=>{C(!0),g(null);try{const f=await n({type:"get_ollama_models",url:x});if(f&&Array.isArray(f)){const w=f.map(_=>({name:_.name||_.id,size:_.sizeBytes||_.size||0,isCloud:!1,family:"",parameters:""}));u(w)}}catch(f){g(f.message||"Failed to fetch Ollama models")}finally{C(!1)}};return e.jsx(vt.Provider,{value:{models:d,activeModelId:c,backendModelConfirmed:a,ollamaModels:h,ollamaError:i,ollamaModelsLoading:y,downloadModel:I,cancelDownload:v,deleteModel:S,setActiveModel:T,fetchOllamaModels:j},children:t})},nt=()=>{const t=r.useContext(vt);if(!t)throw new Error("useModelContext must be used within a ModelProvider");return t},hr=typeof window<"u"&&window.require?window.require("electron"):null,He=hr?.ipcRenderer,tt=()=>"__TAURI__"in window;let Re=null;tt()&&yt(()=>import("./core-DhEqZVGG.js"),[],import.meta.url).then(t=>{Re=t.invoke});const ut={language:"ru",modelId:"ggml-large-v3-turbo",micDevice:"",captureSystem:!0,useVoiceIsolation:!1,echoCancel:.4,vadMode:"auto",vadMethod:"auto",pauseThreshold:.5,enableStreaming:!1,streamingChunkSeconds:15,streamingConfirmationThreshold:.85,ollamaModel:"llama3.2",ollamaUrl:"http://localhost:11434",ollamaContextSize:8,theme:"dark",diarizationEnabled:!1,diarizationSegModelId:"",diarizationEmbModelId:"",diarizationProvider:"auto",showSessionStats:!0,hybridTranscription:{enabled:!1,secondaryModelId:"",confidenceThreshold:.7,contextWords:3,useLLMForMerge:!1,mode:"parallel"}},fr=()=>{const[t,n]=r.useState(ut),[s,o]=r.useState(!1);r.useEffect(()=>{(async()=>{if(tt()){try{let h=0;for(;!Re&&h<50;)await new Promise(u=>setTimeout(u,100)),h++;if(Re){const u=await Re("load_ui_settings");console.log("[useSettings] Loaded from Tauri:",u),u&&n(i=>({...i,...u}))}else console.warn("[useSettings] Tauri invoke not available, using defaults")}catch(l){console.error("[useSettings] Failed to load settings from Tauri:",l)}o(!0);return}if(He){try{const l=await He.invoke("load-settings");l&&n(h=>({...h,...l})),o(!0)}catch(l){console.error("Failed to load settings:",l),o(!0)}return}try{const l=localStorage.getItem("aiwisper_settings");if(l){const h=JSON.parse(l);n(u=>({...u,...h}))}}catch(l){console.error("Failed to load settings from localStorage:",l)}o(!0)})()},[]),r.useEffect(()=>{if(!s)return;(async()=>{if(tt()){try{Re&&(await Re("save_ui_settings",{settings:t}),console.log("[useSettings] Saved to Tauri"))}catch(l){console.error("[useSettings] Failed to save settings to Tauri:",l)}return}if(He){try{await He.invoke("save-settings",t)}catch(l){console.error("Failed to save settings:",l)}return}try{localStorage.setItem("aiwisper_settings",JSON.stringify(t))}catch(l){console.error("Failed to save settings to localStorage:",l)}})()},[t,s]),r.useEffect(()=>{let a=t.theme;t.theme==="system"&&(a=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme",a),document.body.setAttribute("data-theme",a)},[t.theme]);const d=r.useCallback((a,l)=>{n(h=>({...h,[a]:l}))},[]),p=r.useCallback(a=>{n(l=>({...l,...a}))},[]),c=r.useCallback(()=>{n(ut)},[]),m=r.useCallback(()=>{n(a=>({...a,theme:a.theme==="dark"?"light":"dark"}))},[]);return{settings:t,isLoaded:s,updateSetting:d,updateSettings:p,resetSettings:c,toggleTheme:m,language:t.language,setLanguage:a=>d("language",a),theme:t.theme,setTheme:a=>d("theme",a),micDevice:t.micDevice,setMicDevice:a=>d("micDevice",a),captureSystem:t.captureSystem,setCaptureSystem:a=>d("captureSystem",a),useVoiceIsolation:t.useVoiceIsolation,setUseVoiceIsolation:a=>d("useVoiceIsolation",a),echoCancel:t.echoCancel,setEchoCancel:a=>d("echoCancel",a),pauseThreshold:t.pauseThreshold,setPauseThreshold:a=>d("pauseThreshold",a),enableStreaming:t.enableStreaming,setEnableStreaming:a=>d("enableStreaming",a),streamingChunkSeconds:t.streamingChunkSeconds,setStreamingChunkSeconds:a=>d("streamingChunkSeconds",a),streamingConfirmationThreshold:t.streamingConfirmationThreshold,setStreamingConfirmationThreshold:a=>d("streamingConfirmationThreshold",a),ollamaModel:t.ollamaModel,setOllamaModel:a=>d("ollamaModel",a),ollamaUrl:t.ollamaUrl,setOllamaUrl:a=>d("ollamaUrl",a),ollamaContextSize:t.ollamaContextSize,setOllamaContextSize:a=>d("ollamaContextSize",a),hybridTranscription:t.hybridTranscription,setHybridTranscription:a=>d("hybridTranscription",a)}},St=r.createContext(null),sn=({children:t})=>{const n=fr(),s={...n,vadMode:n.settings.vadMode,setVADMode:o=>n.updateSetting("vadMode",o),vadMethod:n.settings.vadMethod,setVADMethod:o=>n.updateSetting("vadMethod",o),showSessionStats:n.settings.showSessionStats,setShowSessionStats:o=>n.updateSetting("showSessionStats",o)};return e.jsx(St.Provider,{value:s,children:t})},jt=()=>{const t=r.useContext(St);if(!t)throw new Error("useSettingsContext must be used within a SettingsProvider");return t},xr=typeof window<"u"&&window.require?window.require("electron"):null,_e=xr?.ipcRenderer,rt="aiwisper_settings",kt=r.createContext(null),yr=async()=>{try{let t=null;if(_e)t=await _e.invoke("load-settings");else{const n=localStorage.getItem(rt);n&&(t=JSON.parse(n))}if(t&&t.diarizationEnabled!==void 0)return{enabled:t.diarizationEnabled,segModelId:t.diarizationSegModelId||"",embModelId:t.diarizationEmbModelId||"",provider:t.diarizationProvider||"auto"}}catch(t){console.error("Failed to load diarization settings:",t)}return null},Je=async t=>{try{let n={};if(_e){n=await _e.invoke("load-settings")||{};const s={...n,diarizationEnabled:t.enabled,diarizationSegModelId:t.segModelId,diarizationEmbModelId:t.embModelId,diarizationProvider:t.provider};await _e.invoke("save-settings",s)}else{const s=localStorage.getItem(rt);s&&(n=JSON.parse(s));const o={...n,diarizationEnabled:t.enabled,diarizationSegModelId:t.segModelId,diarizationEmbModelId:t.embModelId,diarizationProvider:t.provider};localStorage.setItem(rt,JSON.stringify(o))}}catch(n){console.error("Failed to save diarization settings:",n)}},an=({children:t})=>{const{sendMessage:n,subscribe:s,isConnected:o}=le(),{models:d,downloadModel:p,backendModelConfirmed:c,activeModelId:m}=nt(),[a,l]=r.useState({enabled:!1,provider:""}),[h,u]=r.useState(!1),[i,g]=r.useState(null),[y,C]=r.useState(null),M=r.useRef(!1),I=r.useRef(!1),v=d.filter(f=>f.engine==="diarization"&&f.diarizationType==="segmentation"),S=d.filter(f=>f.engine==="diarization"&&f.diarizationType==="embedding");r.useEffect(()=>{I.current||(I.current=!0,yr().then(f=>{console.log("[Diarization] Loaded settings:",f),C(f)}))},[]),r.useEffect(()=>{o?n({type:"get_diarization_status"}):M.current=!1},[o,n]),r.useEffect(()=>{if(!o||M.current||!y)return;if(console.log("[Diarization] Auto-enable check:",{isConnected:o,autoEnableAttempted:M.current,savedSettingsEnabled:y?.enabled,provider:y?.provider,modelsCount:d.length,backendModelConfirmed:c,activeModelId:m}),!y.enabled){console.log("[Diarization] Auto-enable skipped: savedSettings.enabled is false");return}if(y.provider==="coreml"){M.current=!0,console.log("[Diarization] Auto-enabling FluidAudio (coreml)..."),u(!0),g(null),n({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"});return}if(d.length===0){console.log("[Diarization] Auto-enable waiting: models not loaded yet");return}const f=d.find(_=>_.id===y.segModelId),w=d.find(_=>_.id===y.embModelId);if(console.log("[Diarization] Models found:",{segModel:f?{id:f.id,status:f.status,path:f.path}:null,embModel:w?{id:w.id,status:w.status,path:w.path}:null}),!f||!w){console.log("[Diarization] Auto-enable skipped: models not found");return}if(f.status!=="downloaded"&&f.status!=="active"){console.log("[Diarization] Auto-enable skipped: segModel not downloaded");return}if(w.status!=="downloaded"&&w.status!=="active"){console.log("[Diarization] Auto-enable skipped: embModel not downloaded");return}if(!f.path||!w.path){console.log("[Diarization] Auto-enable skipped: model paths missing");return}M.current=!0,console.log("[Diarization] Auto-enabling with settings:",y),u(!0),g(null),n({type:"enable_diarization",segmentationModelPath:f.path,embeddingModelPath:w.path,diarizationProvider:y.provider})},[o,y,d,n,c,m]),r.useEffect(()=>{const f=s("diarization_enabled",R=>{console.log("[Diarization] Enabled successfully:",R.diarizationProvider),l({enabled:!0,provider:R.diarizationProvider||"cpu"}),u(!1),g(null)}),w=s("diarization_disabled",()=>{l({enabled:!1,provider:""}),u(!1)}),_=s("diarization_status",R=>{console.log("[Diarization] Status received:",{enabled:R.diarizationEnabled,provider:R.diarizationProvider}),l({enabled:R.diarizationEnabled||!1,provider:R.diarizationProvider||""})}),B=s("diarization_error",R=>{console.error("[Diarization] Error from backend:",R.error),g(R.error||"–û—à–∏–±–∫–∞ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏"),u(!1)});return()=>{f(),w(),_(),B()}},[s]);const T=r.useCallback((f,w,_="auto")=>{if(u(!0),g(null),_==="coreml"){console.log("[Diarization] Enabling FluidAudio (coreml)...");const E={enabled:!0,segModelId:"",embModelId:"",provider:"coreml"};Je(E),C(E),n({type:"enable_diarization",segmentationModelPath:"",embeddingModelPath:"",diarizationProvider:"coreml"});return}const B=v.find(E=>E.id===f),R=S.find(E=>E.id===w);if(!B||!R){g("–ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),u(!1);return}if(B.status!=="downloaded"&&B.status!=="active"){g("–°–Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏"),p(f),u(!1);return}if(R.status!=="downloaded"&&R.status!=="active"){g("–°–Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤"),p(w),u(!1);return}if(!B.path||!R.path){g("–ü—É—Ç–∏ –∫ –º–æ–¥–µ–ª—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),u(!1);return}const N={enabled:!0,segModelId:f,embModelId:w,provider:_};Je(N),C(N),n({type:"enable_diarization",segmentationModelPath:B.path,embeddingModelPath:R.path,diarizationProvider:_})},[v,S,n,p]),j=r.useCallback(()=>{if(u(!0),y){const f={...y,enabled:!1};Je(f),C(f)}n({type:"disable_diarization"})},[n,y]),x=r.useCallback(()=>{n({type:"get_diarization_status"})},[n]);return e.jsx(kt.Provider,{value:{status:a,isLoading:h,error:i,segmentationModels:v,embeddingModels:S,savedSettings:y,enableDiarization:T,disableDiarization:j,refreshStatus:x},children:t})},br=()=>{const t=r.useContext(kt);if(!t)throw new Error("useDiarizationContext must be used within a DiarizationProvider");return t},vr=r.createContext(null),ln=({children:t})=>{const[n,s]=r.useState(0),[o,d]=r.useState(0),[p,c]=r.useState(0),[m,a]=r.useState(0),l=r.useRef(null),h=r.useRef(null),u=r.useRef(null),i=r.useRef(null),g=r.useRef(null),y=r.useRef(null),[C,M]=r.useState(!1),I=r.useCallback((j=800,x=150,f=.3)=>{try{const w=new(window.AudioContext||window.webkitAudioContext),_=w.createOscillator(),B=w.createGain();_.connect(B),B.connect(w.destination),_.frequency.value=j,_.type="sine",B.gain.setValueAtTime(f,w.currentTime),B.gain.exponentialRampToValueAtTime(.01,w.currentTime+x/1e3),_.start(w.currentTime),_.stop(w.currentTime+x/1e3),setTimeout(()=>w.close(),x+100)}catch(w){console.error("[AudioContext] Failed to play beep:",w)}},[]),v=r.useCallback(j=>{try{l.current||(l.current=new(window.AudioContext||window.webkitAudioContext));const x=l.current;if(i.current)try{i.current.disconnect()}catch{}i.current=x.createMediaElementSource(j),g.current=x.createChannelSplitter(2),h.current=x.createAnalyser(),u.current=x.createAnalyser(),h.current.fftSize=256,u.current.fftSize=256,i.current.connect(g.current),g.current.connect(h.current,0),g.current.connect(u.current,1),i.current.connect(x.destination),M(!0),T(),console.log("[AudioContext] Analysers connected")}catch(x){console.error("[AudioContext] Failed to connect analysers:",x)}},[]),S=r.useCallback(()=>{if(y.current&&(cancelAnimationFrame(y.current),y.current=null),i.current){try{i.current.disconnect()}catch{}i.current=null}c(0),a(0),M(!1),console.log("[AudioContext] Analysers disconnected")},[]),T=r.useCallback(()=>{const j=()=>{if(!h.current||!u.current)return;const x=new Uint8Array(h.current.frequencyBinCount),f=new Uint8Array(u.current.frequencyBinCount);h.current.getByteFrequencyData(x),u.current.getByteFrequencyData(f);const w=pt(x),_=pt(f);c(w),a(_),y.current=requestAnimationFrame(j)};j()},[]);return r.useEffect(()=>()=>{y.current&&cancelAnimationFrame(y.current),l.current&&l.current.close()},[]),e.jsx(vr.Provider,{value:{micLevel:n,sysLevel:o,setMicLevel:s,setSysLevel:d,playbackMicLevel:p,playbackSysLevel:m,playBeep:I,connectAnalysers:v,disconnectAnalysers:S,isAnalyserConnected:C},children:t})},pt=t=>{let n=0;for(let o=0;o<t.length;o++){const d=t[o]/255;n+=d*d}const s=Math.sqrt(n/t.length);return Math.min(100,s*200)},Sr=async()=>{try{if("__TAURI__"in window){const{invoke:n}=await yt(async()=>{const{invoke:o}=await import("./core-DhEqZVGG.js");return{invoke:o}},[],import.meta.url),s=await n("open_data_folder");console.log("[Sidebar] Opened data folder:",s);return}const t=window.require?window.require("electron"):null;t&&await t.ipcRenderer.invoke("open-data-folder")}catch(t){console.error("[Sidebar] Failed to open data folder:",t),alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É: ${t}`)}},jr=({onStartRecording:t})=>{const{sessions:n,selectedSession:s,selectSession:o,deleteSession:d,isRecording:p,isFullTranscribing:c,fullTranscriptionSessionId:m,fullTranscriptionProgress:a}=he(),{sendMessage:l}=le(),[h,u]=r.useState(!1),[i,g]=r.useState(""),[y,C]=r.useState(null),[M,I]=r.useState(null),[v,S]=r.useState(null),[T,j]=r.useState(""),x=r.useRef(null);r.useEffect(()=>{v&&x.current&&(x.current.focus(),x.current.select())},[v]);const f=(E,D)=>{S(E),j(D)},w=E=>{T.trim()&&l({type:"rename_session",sessionId:E,data:T.trim()}),S(null),j("")},_=()=>{S(null),j("")},B=r.useMemo(()=>{if(!i.trim())return n;const E=i.toLowerCase().trim();return n.filter(D=>!!((D.title||`–ó–∞–ø–∏—Å—å ${De(D.startTime)}`).toLowerCase().includes(E)||De(D.startTime).toLowerCase().includes(E)))},[n,i]),R=r.useMemo(()=>sr(B),[B]),N=r.useMemo(()=>{if(n.length===0)return{totalSessions:0,totalDuration:0,avgDuration:0,totalChunks:0};let E=0,D=0;return n.forEach(L=>{E+=(L.totalDuration||0)/1e3,D+=L.chunksCount||0}),{totalSessions:n.length,totalDuration:E,avgDuration:E/n.length,totalChunks:D}},[n]);return e.jsxs("aside",{className:"glass-surface-elevated",style:{width:"300px",margin:"var(--spacing-inset)",marginRight:0,borderRadius:"var(--radius-xl)",background:"var(--sidebar-bg)",backdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",WebkitBackdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",border:"1px solid var(--glass-border)",boxShadow:"var(--shadow-glass)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[p&&e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"var(--radius-xl)"},children:e.jsxs("div",{style:{textAlign:"center",padding:"1.5rem"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.2)",border:"2px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem"},children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("div",{style:{color:"var(--text-primary)",fontWeight:600,marginBottom:"0.25rem"},children:"–ó–∞–ø–∏—Å—å –∏–¥—ë—Ç"}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–ù–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞"})]})}),e.jsxs("div",{style:{padding:"0.75rem 1rem",paddingTop:"0.5rem",marginTop:"28px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.2rem",fontWeight:"var(--font-weight-bold)",letterSpacing:"-0.02em",color:"var(--text-primary)"},children:"–í—Å–µ –∑–∞–ø–∏—Å–∏"}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:()=>window.location.reload(),title:"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫",style:{width:"32px",height:"32px"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:Sr,title:"–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É —Å –∑–∞–ø–∏—Å—è–º–∏",style:{width:"32px",height:"32px"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),e.jsx("button",{className:"btn-icon btn-icon-sm",onClick:()=>u(!h),title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",style:{width:"32px",height:"32px",background:h?"var(--primary-alpha)":void 0},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})})]})]}),e.jsxs("div",{style:{padding:"0 1rem 0.75rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"var(--text-muted)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",left:"0.75rem",pointerEvents:"none",opacity:.6},children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π...",value:i,onChange:E=>g(E.target.value),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.25rem",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)",color:"var(--text-primary)",fontSize:"0.85rem",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:E=>{E.target.style.borderColor="var(--primary)",E.target.style.boxShadow="0 0 0 2px var(--primary-alpha)"},onBlur:E=>{E.target.style.borderColor="var(--glass-border-subtle)",E.target.style.boxShadow="none"}}),i&&e.jsx("button",{onClick:()=>g(""),style:{position:"absolute",right:"0.5rem",padding:"0.25rem",background:"transparent",border:"none",cursor:"pointer",color:"var(--text-muted)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%"},title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),i&&e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--text-muted)"},children:["–ù–∞–π–¥–µ–Ω–æ: ",B.length," –∏–∑ ",n.length]})]}),h&&n.length>0&&e.jsx("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid var(--glass-border-subtle)",background:"var(--surface-alpha)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--primary)"},children:N.totalSessions}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ó–∞–ø–∏—Å–µ–π"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--success)"},children:Ge(N.totalDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–í—Å–µ–≥–æ"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--warning)"},children:Ge(N.avgDuration)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–°—Ä–µ–¥–Ω—è—è"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--info)"},children:N.totalChunks}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ß–∞–Ω–∫–æ–≤"})]})]})}),e.jsx("div",{className:"scroll-soft-edges",style:{flex:1,overflowY:"auto",paddingBottom:"1rem"},children:B.length===0?e.jsx("div",{style:{padding:"2rem 1rem",color:"var(--text-muted)",textAlign:"center",fontSize:"0.9rem"},children:n.length===0?"–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π":"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"}):R.map(E=>e.jsxs("div",{children:[e.jsx("div",{className:"group-header",children:E.label}),E.sessions.map(D=>{const L=s?.id===D.id,U=D.totalDuration/1e3,F=y===D.id,V=c&&m===D.id;return e.jsxs("div",{className:`session-item ${L?"selected":""}`,onClick:()=>o(D.id),onMouseEnter:()=>C(D.id),onMouseLeave:()=>C(null),style:{position:"relative"},children:[F&&!p&&e.jsx("button",{onClick:q=>{q.stopPropagation(),I(D.id)},title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",style:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"24px",height:"24px",padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"4px",cursor:"pointer",color:"#ef4444",transition:"all 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="rgba(239, 68, 68, 0.2)"},onMouseLeave:q=>{q.currentTarget.style.background="rgba(239, 68, 68, 0.1)"},children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),v===D.id?e.jsx("input",{ref:x,type:"text",value:T,onChange:q=>j(q.target.value),onBlur:()=>w(D.id),onKeyDown:q=>{q.key==="Enter"?w(D.id):q.key==="Escape"&&_()},onClick:q=>q.stopPropagation(),style:{width:"100%",fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",padding:"0.125rem 0.25rem",border:"1px solid var(--primary)",borderRadius:"4px",background:"var(--surface-alpha)",outline:"none"}}):e.jsx("div",{onDoubleClick:q=>{q.stopPropagation(),p||f(D.id,D.title||`–ó–∞–ø–∏—Å—å ${De(D.startTime)}`)},title:"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",style:{fontSize:"0.95rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.35rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingRight:F?"2rem":0,cursor:p?"default":"text"},children:D.title||`–ó–∞–ø–∏—Å—å ${De(D.startTime)}`}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem",color:"var(--text-muted)"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:[De(D.startTime),", ",ir(D.startTime)]}),e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.6},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.jsx("span",{children:Ge(U)})]}),V&&e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"var(--primary)",animation:"pulse 1s infinite"}}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--primary)"},children:["–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è ",Math.round(a*100),"%"]})]}),e.jsx("div",{style:{height:"3px",background:"var(--glass-bg)",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${a*100}%`,background:"var(--primary)",borderRadius:"2px",transition:"width 0.3s ease"}})})]})]},D.id)})]},E.label))}),e.jsx("div",{style:{padding:"0.75rem 1rem",borderTop:"1px solid var(--glass-border-subtle)"},children:e.jsx("button",{className:"btn-capsule",onClick:t,disabled:p||c,style:{width:"100%",justifyContent:"center",padding:"0.6rem 1rem",gap:"0.4rem",background:p?"linear-gradient(135deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 38, 0.8))":c?"linear-gradient(135deg, rgba(100, 100, 100, 0.6), rgba(80, 80, 80, 0.6))":"linear-gradient(135deg, var(--primary), var(--primary-dark))",border:"none",color:"white",cursor:p||c?"not-allowed":"pointer",opacity:c?.6:1},children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"white",animation:"pulse 1s infinite"}}),"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å..."]}):c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å"]})})}),M&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>I(null),children:e.jsxs("div",{style:{background:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"var(--radius-lg)",padding:"1.5rem",maxWidth:"320px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset",border:"1px solid rgba(255, 255, 255, 0.15)"},onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"1rem"},children:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:"–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>I(null),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border)",background:"transparent",color:"var(--text-primary)",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{onClick:()=>{d(M),I(null)},style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",border:"none",background:"#ef4444",color:"white",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},children:"–£–¥–∞–ª–∏—Ç—å"})]})]})})]})},kr=({showSettings:t,setShowSettings:n,onShowHelp:s})=>{const{isConnected:o}=le(),{isRecording:d,isFullTranscribing:p}=he(),c=d||p;return e.jsxs("header",{style:{padding:"0.75rem 1.5rem",paddingLeft:"88px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"transparent",WebkitAppRegion:"drag",userSelect:"none",minHeight:"52px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:o?"var(--success)":"var(--danger)",boxShadow:o?"0 0 12px var(--success)":"0 0 12px var(--danger)",transition:"all var(--duration-normal) var(--transition-smooth)"}})}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",WebkitAppRegion:"no-drag"},children:[s&&e.jsx("button",{className:"btn-icon",onClick:s,title:"–°–ø—Ä–∞–≤–∫–∞ (?)",style:{width:"36px",height:"36px"},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsx("button",{className:"btn-icon",onClick:()=>n(!t),title:c?"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã":"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (‚åò,)",disabled:c,style:{width:"36px",height:"36px",background:t?"var(--glass-bg-active)":void 0,opacity:c?.4:1,pointerEvents:c?"none":"auto",transition:"opacity 0.2s ease"},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]})]})},wr=({playbackMicLevel:t,playbackSysLevel:n})=>{const{micLevel:s,sysLevel:o,isRecording:d}=he(),p=t!==void 0?t:s,c=n!==void 0?n:o;return d||t!==void 0||n!==void 0?e.jsxs("div",{style:{width:"24px",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"4px",padding:"8px 4px",background:"var(--surface)",borderLeft:"1px solid var(--border)"},children:[e.jsx("div",{style:{flex:1,width:"8px",background:"var(--surface-strong)",borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${p}%`,background:"linear-gradient(to top, #4caf50, #8bc34a)",borderRadius:"4px",transition:"height 0.1s ease"}})}),e.jsx("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)"},children:"üé§"}),e.jsx("div",{style:{flex:1,width:"8px",background:"var(--surface-strong)",borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${c}%`,background:"linear-gradient(to top, #2196f3, #03a9f4)",borderRadius:"4px",transition:"height 0.1s ease"}})}),e.jsx("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)"},children:"üîä"})]}):null};class Cr extends r.Component{state={hasError:!1,error:null};static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error("Uncaught error:",n,s)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{style:{padding:"2rem",color:"#ff6b6b"},children:[e.jsx("h2",{children:"Something went wrong."}),e.jsx("pre",{style:{backgroundColor:"#2d2d2d",padding:"1rem",borderRadius:"4px",overflow:"auto"},children:this.state.error?.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"1rem",padding:"0.5rem 1rem",cursor:"pointer"},children:"Reload Application"})]}):this.props.children}}const mt=t=>{const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3),d=t%1e3;return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")},${d.toString().padStart(3,"0")}`},gt=t=>{const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3),d=t%1e3;return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${d.toString().padStart(3,"0")}`},Te=t=>t==="mic"||t==="–í—ã"?"–í—ã":t==="sys"||t==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫"?"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫":t?.startsWith("Speaker ")?`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${parseInt(t.replace("Speaker ",""),10)+1}`:t||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",wt=()=>{const t=r.useCallback(async c=>{if(!c?.chunks)return!1;const m=c.chunks.filter(l=>l.status==="completed"&&l.dialogue).flatMap(l=>l.dialogue||[]).sort((l,h)=>(l.start||0)-(h.start||0));if(m.length===0)return!1;const a=m.map(l=>`${Te(l.speaker)}: ${l.text}`).join(`
`);try{return await navigator.clipboard.writeText(a),!0}catch(l){return console.error("Failed to copy to clipboard:",l),!1}},[]),n=r.useCallback(c=>{if(!c?.chunks)return;const a=c.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)).map(i=>{const g=Math.floor((i.start||0)/6e4),y=Math.floor((i.start||0)%6e4/1e3);return`[${`${g.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`}] ${Te(i.speaker)}: ${i.text}`}).join(`
`),l=new Blob([a],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(l),u=document.createElement("a");u.href=h,u.download=`${c.title||"transcription"}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h)},[]),s=r.useCallback(c=>{if(!c?.chunks)return;const a=c.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)).map((i,g)=>{const y=mt(i.start||0),C=mt(i.end||i.start||0);return`${g+1}
${y} --> ${C}
${Te(i.speaker)}: ${i.text}
`}).join(`
`),l=new Blob([a],{type:"text/plain;charset=utf-8"}),h=URL.createObjectURL(l),u=document.createElement("a");u.href=h,u.download=`${c.title||"transcription"}.srt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h)},[]),o=r.useCallback(c=>{if(!c?.chunks)return;const m=c.chunks.filter(i=>i.status==="completed"&&i.dialogue).flatMap(i=>i.dialogue||[]).sort((i,g)=>(i.start||0)-(g.start||0)),a=[`WEBVTT
`].concat(m.map((i,g)=>{const y=gt(i.start||0),C=gt(i.end||i.start||0);return`${g+1}
${y} --> ${C}
${Te(i.speaker)}: ${i.text}
`})).join(`
`),l=new Blob([a],{type:"text/vtt;charset=utf-8"}),h=URL.createObjectURL(l),u=document.createElement("a");u.href=h,u.download=`${c.title||"transcription"}.vtt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h)},[]),d=r.useCallback(c=>{if(!c?.chunks)return;const m=c.chunks.filter(g=>g.status==="completed"&&g.dialogue).flatMap(g=>g.dialogue||[]).sort((g,y)=>(g.start||0)-(y.start||0)),a={session:{id:c.id,title:c.title,startTime:c.startTime,endTime:c.endTime,totalDuration:c.totalDuration,language:c.language,model:c.model},dialogue:m.map(g=>({start:g.start,end:g.end,speaker:Te(g.speaker),text:g.text})),summary:c.summary||null},l=JSON.stringify(a,null,2),h=new Blob([l],{type:"application/json;charset=utf-8"}),u=URL.createObjectURL(h),i=document.createElement("a");i.href=u,i.download=`${c.title||"transcription"}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)},[]),p=r.useCallback(c=>{if(!c?.chunks)return;const m=c.chunks.filter(M=>M.status==="completed"&&M.dialogue).flatMap(M=>M.dialogue||[]).sort((M,I)=>(M.start||0)-(I.start||0)),a=new Date(c.startTime).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=(c.totalDuration||0)/1e3,h=Math.floor(l/60),u=Math.floor(l%60);let i=`# ${c.title||"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"}

`;i+=`**–î–∞—Ç–∞:** ${a}
`,i+=`**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ${h}:${u.toString().padStart(2,"0")}

`,c.summary&&(i+=`## –°–≤–æ–¥–∫–∞

${c.summary}

`),i+=`## –î–∏–∞–ª–æ–≥

`,m.forEach(M=>{const I=Math.floor((M.start||0)/6e4),v=Math.floor((M.start||0)%6e4/1e3),S=`${I.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`;i+=`**[${S}] ${Te(M.speaker)}:** ${M.text}

`});const g=new Blob([i],{type:"text/markdown;charset=utf-8"}),y=URL.createObjectURL(g),C=document.createElement("a");C.href=y,C.download=`${c.title||"transcription"}.md`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(y)},[]);return{copyToClipboard:t,exportTXT:n,exportSRT:s,exportVTT:o,exportJSON:d,exportMarkdown:p}},Mr=({session:t,isPlaying:n,isPlayingFullSession:s=!1,onPlayPause:o,onSeek:d,currentTime:p,duration:c,onRetranscribe:m,onImprove:a,waveformData:l,waveformLoading:h,waveformError:u})=>{const i=r.useRef(null),[g,y]=r.useState(null),[C,M]=r.useState(1),[I,v]=r.useState(!1),[S,T]=r.useState(!1),[j,x]=r.useState(!1),[f,w]=r.useState(t.title||""),[_,B]=r.useState(!1),[R,N]=r.useState(""),{sendMessage:E}=le(),{isFullTranscribing:D,fullTranscriptionProgress:L,fullTranscriptionStatus:U,fullTranscriptionError:F,fullTranscriptionSessionId:V,cancelFullTranscription:q,isRecording:ee}=he();r.useEffect(()=>{w(t.title||"")},[t.title]);const de=D&&V===t.id,[X,me]=r.useState(()=>{const b=localStorage.getItem("waveformViewMode");return b==="simple"||b==="detailed"||b==="hidden"?b:"simple"});r.useEffect(()=>{localStorage.setItem("waveformViewMode",X)},[X]);const{copyToClipboard:ie,exportTXT:fe,exportSRT:ue,exportVTT:ae,exportJSON:be,exportMarkdown:xe}=wt(),ve=b=>{if(!i.current||c===0)return;const G=i.current.getBoundingClientRect(),Z=b.clientX-G.left,O=Math.min(Math.max(Z/G.width,0),1);d(O*c)},te=b=>{if(!i.current||c===0)return;const G=i.current.getBoundingClientRect(),Z=b.clientX-G.left,O=Math.min(Math.max(Z/G.width,0),1);y(O*c)},pe=b=>{if(!isFinite(b)||isNaN(b))return"0:00";const G=Math.floor(b/60),Z=Math.floor(b%60);return`${G}:${Z.toString().padStart(2,"0")}`},H=(t.totalDuration||0)/1e3,re=isFinite(c)&&c>0?c:H,Y=b=>{const G=Math.max(0,Math.min(p+b,re));d(G)},oe=()=>{const b=[.5,.75,1,1.25,1.5,2],Z=(b.indexOf(C)+1)%b.length;M(b[Z])},ne=s&&H>0?p/H*100:0,Se=()=>{f.trim()&&f!==t.title&&E({type:"update_session_title",sessionId:t.id,title:f.trim()}),x(!1)},je=()=>{w(t.title||""),x(!1)},ke=()=>{const b=R.trim();b&&!t.tags?.includes(b)&&(E({type:"add_session_tag",sessionId:t.id,tag:b}),N(""))},we=b=>{E({type:"remove_session_tag",sessionId:t.id,tag:b})};return e.jsxs("div",{className:"glass-surface",style:{margin:"0 1rem 1rem",padding:"1rem 1.25rem",borderRadius:"var(--radius-lg)",background:"var(--glass-bg)",backdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",WebkitBackdropFilter:"blur(var(--glass-blur)) saturate(var(--glass-saturation))",border:"1px solid var(--glass-border)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",gap:"1rem"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[j?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsx("input",{type:"text",value:f,onChange:b=>w(b.target.value),onKeyDown:b=>{b.key==="Enter"&&Se(),b.key==="Escape"&&je()},autoFocus:!0,style:{flex:1,padding:"0.4rem 0.6rem",fontSize:"1.1rem",fontWeight:600,background:"var(--glass-bg)",border:"1px solid var(--primary)",borderRadius:"8px",color:"var(--text-primary)",outline:"none"}}),e.jsx("button",{onClick:Se,style:{padding:"0.4rem",background:"var(--primary)",border:"none",borderRadius:"6px",color:"white",cursor:"pointer"},title:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",children:"‚úì"}),e.jsx("button",{onClick:je,style:{padding:"0.4rem",background:"var(--glass-bg)",border:"1px solid var(--border)",borderRadius:"6px",color:"var(--text-muted)",cursor:"pointer"},title:"–û—Ç–º–µ–Ω–∞",children:"‚úï"})]}):e.jsxs("h3",{onClick:()=>x(!0),style:{margin:0,fontSize:"1.1rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-primary)",marginBottom:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},title:"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",children:[t.title||"–ó–∞–ø–∏—Å—å –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{opacity:.4},children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:t.startTime?new Date(t.startTime).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞"}),t.tags&&t.tags.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-muted)",opacity:.4},children:"‚Ä¢"}),t.tags.map(b=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.2rem",padding:"0.1rem 0.4rem",fontSize:"0.7rem",background:"var(--primary-alpha)",color:"var(--primary)",borderRadius:"4px",fontWeight:500},children:[b,e.jsx("button",{onClick:()=>we(b),style:{background:"none",border:"none",padding:"0 0 0 2px",cursor:"pointer",color:"var(--primary)",fontSize:"0.6rem",lineHeight:1,opacity:.6},title:"–£–¥–∞–ª–∏—Ç—å —Ç–µ–≥",children:"‚úï"})]},b))]})]})]}),e.jsx("div",{style:{position:"relative"},children:_?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[e.jsx("input",{type:"text",value:R,onChange:b=>N(b.target.value),onKeyDown:b=>{b.key==="Enter"&&ke(),b.key==="Escape"&&(B(!1),N(""))},placeholder:"–ù–æ–≤—ã–π —Ç–µ–≥...",autoFocus:!0,style:{width:"120px",padding:"0.35rem 0.6rem",fontSize:"0.8rem",background:"var(--glass-bg)",border:"1px solid var(--primary)",borderRadius:"8px",color:"var(--text-primary)",outline:"none"}}),e.jsx("button",{onClick:ke,disabled:!R.trim(),style:{padding:"0.35rem 0.5rem",background:R.trim()?"var(--primary)":"var(--glass-bg)",border:"none",borderRadius:"6px",color:R.trim()?"white":"var(--text-muted)",cursor:R.trim()?"pointer":"not-allowed",fontSize:"0.8rem"},children:"+"}),e.jsx("button",{onClick:()=>{B(!1),N("")},style:{padding:"0.35rem 0.5rem",background:"var(--glass-bg)",border:"1px solid var(--border)",borderRadius:"6px",color:"var(--text-muted)",cursor:"pointer",fontSize:"0.8rem"},children:"‚úï"})]}):e.jsxs("button",{className:"btn-capsule",onClick:()=>B(!0),style:{padding:"0.35rem 0.75rem",fontSize:"0.8rem",gap:"0.3rem"},children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥"]})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx("button",{className:"btn-icon",onClick:()=>Y(-10),title:"–ù–∞–∑–∞–¥ 10 —Å–µ–∫",style:{width:"36px",height:"36px"},children:e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"var(--font-weight-semibold)"},children:"10"})}),e.jsx("button",{className:"btn-icon btn-icon-lg",onClick:o,title:n?"–ü–∞—É–∑–∞":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",style:{width:"52px",height:"52px",background:"var(--glass-bg-elevated)",border:"1px solid var(--glass-border)"},children:n?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("polygon",{points:"6 3 20 12 6 21 6 3"})})}),e.jsx("button",{className:"btn-icon",onClick:()=>Y(10),title:"–í–ø–µ—Ä—ë–¥ 10 —Å–µ–∫",style:{width:"36px",height:"36px"},children:e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"var(--font-weight-semibold)"},children:"10"})}),e.jsxs("button",{className:"btn-capsule",onClick:oe,title:"–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è",style:{marginLeft:"0.5rem",padding:"0.3rem 0.6rem",fontSize:"0.8rem",minWidth:"42px"},children:[C,"x"]}),e.jsxs("div",{style:{display:"flex",gap:"2px",marginLeft:"0.75rem",background:"var(--glass-bg-elevated)",borderRadius:"var(--radius-sm)",padding:"2px",border:"1px solid var(--glass-border-subtle)"},children:[e.jsx("button",{onClick:()=>me("simple"),title:"–ü—Ä–æ—Å—Ç–æ–π –≤–∏–¥",style:{padding:"6px 8px",background:X==="simple"?"var(--primary)":"transparent",color:X==="simple"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"10",width:"3",height:"4",rx:"1"}),e.jsx("rect",{x:"8",y:"7",width:"3",height:"10",rx:"1"}),e.jsx("rect",{x:"13",y:"9",width:"3",height:"6",rx:"1"}),e.jsx("rect",{x:"18",y:"6",width:"3",height:"12",rx:"1"})]})}),e.jsx("button",{onClick:()=>me("detailed"),title:"–î–µ—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥ (Mic/Sys)",style:{padding:"6px 8px",background:X==="detailed"?"var(--primary)":"transparent",color:X==="detailed"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M2 6h20"}),e.jsx("path",{d:"M4 6v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1z"}),e.jsx("path",{d:"M10 6v-2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z"}),e.jsx("path",{d:"M2 18h20"}),e.jsx("path",{d:"M6 18v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-1z"}),e.jsx("path",{d:"M12 18v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1z"})]})}),e.jsx("button",{onClick:()=>me("hidden"),title:"–°–≤–µ—Ä–Ω—É—Ç—å",style:{padding:"6px 8px",background:X==="hidden"?"var(--primary)":"transparent",color:X==="hidden"?"white":"var(--text-muted)",border:"none",borderRadius:"var(--radius-xs)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"4 14 10 14 10 20"}),e.jsx("polyline",{points:"20 10 14 10 14 4"}),e.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),e.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[e.jsxs("button",{className:"btn-capsule",onClick:m,title:"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å",disabled:D||ee,style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem",opacity:D||ee?.5:1,cursor:D||ee?"not-allowed":"pointer"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),de?"–ò–¥—ë—Ç...":"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å"]}),e.jsxs("button",{className:"btn-capsule btn-capsule-primary",onClick:a,title:"–£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç",style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),"–£–ª—É—á—à–∏—Ç—å"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{className:"btn-capsule",onClick:()=>v(!I),title:"–≠–∫—Å–ø–æ—Ä—Ç",style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",gap:"0.4rem"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"–≠–∫—Å–ø–æ—Ä—Ç"]}),I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>v(!1)}),e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:0,background:"rgba(30, 30, 35, 0.75)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",borderRadius:"var(--radius-lg)",border:"1px solid rgba(255, 255, 255, 0.12)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.08)",padding:"0.5rem",minWidth:"180px",zIndex:100},children:[e.jsxs("button",{onClick:async()=>{await ie(t)&&(T(!0),setTimeout(()=>T(!1),2e3)),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:["–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç ",S&&"(–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!)"]}),e.jsx("div",{style:{height:"1px",background:"rgba(255, 255, 255, 0.08)",margin:"0.25rem 0.5rem"}}),e.jsx("button",{onClick:()=>{fe(t),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:"–¢–µ–∫—Å—Ç (.txt)"}),e.jsx("button",{onClick:()=>{ue(t),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:"–°—É–±—Ç–∏—Ç—Ä—ã (.srt)"}),e.jsx("button",{onClick:()=>{ae(t),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:"WebVTT (.vtt)"}),e.jsx("button",{onClick:()=>{be(t),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:"JSON (.json)"}),e.jsx("button",{onClick:()=>{xe(t),v(!1)},style:{width:"100%",padding:"0.6rem 0.75rem",background:"transparent",border:"none",borderRadius:"var(--radius-md)",color:"rgba(255, 255, 255, 0.95)",fontSize:"0.85rem",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.6rem",transition:"background 0.15s ease"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:"Markdown (.md)"})]})]})]})]})]}),X!=="hidden"&&e.jsx("div",{children:X==="simple"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:i,onClick:ve,onMouseMove:te,onMouseLeave:()=>y(null),style:{height:"48px",background:"var(--glass-bg)",borderRadius:"var(--radius-md)",position:"relative",cursor:"pointer",overflow:"hidden",border:"1px solid var(--glass-border-subtle)"},children:[e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",gap:"2px",padding:"0 4px"},children:(t.chunks||[]).length>0?(t.chunks||[]).filter(b=>b).map((b,G,Z)=>{const O=G/Z.length*100<ne,Ie=30+(b.transcription||"").length%60;return e.jsx("div",{style:{flex:1,height:`${Ie}%`,background:O?"linear-gradient(to top, var(--primary), var(--accent))":"var(--glass-bg-hover)",borderRadius:"2px",transition:"background var(--duration-fast)"}},b.id||G)}):Array.from({length:50}).map((b,G)=>{const Z=G/50*100<ne,O=20+Math.random()*60;return e.jsx("div",{style:{flex:1,height:`${O}%`,background:Z?"linear-gradient(to top, var(--primary), var(--accent))":"var(--glass-bg-hover)",borderRadius:"2px",transition:"background var(--duration-fast)"}},G)})}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:`${ne}%`,width:"2px",background:"white",boxShadow:"0 0 10px rgba(255, 255, 255, 0.8)",pointerEvents:"none",transition:"left 0.1s linear"}}),g!==null&&e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:`${g/re*100}%`,width:"1px",background:"var(--text-muted)",pointerEvents:"none"},children:e.jsx("div",{style:{position:"absolute",bottom:"calc(100% + 4px)",left:"50%",transform:"translateX(-50%)",background:"var(--glass-bg-elevated)",backdropFilter:"blur(10px)",padding:"2px 6px",borderRadius:"var(--radius-xs)",fontSize:"0.7rem",fontFamily:"SF Mono, monospace",color:"var(--text-primary)",whiteSpace:"nowrap",border:"1px solid var(--glass-border)"},children:pe(g)})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"SF Mono, Menlo, monospace",color:"var(--text-muted)"},children:[e.jsx("span",{children:pe(p)}),e.jsx("span",{children:pe(re)})]})]}):e.jsx(ar,{currentTime:p,playbackOffset:0,totalDuration:l?.duration||re,isPlaying:n,waveformData:l,loading:h,error:u,channelLabels:["Mic","Sys"],onSeek:d})}),de&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--glass-bg-elevated)",borderRadius:"var(--radius-md)",border:"1px solid var(--primary-alpha)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"var(--primary)",animation:"pulse 1s infinite"}}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:600,color:"var(--text-primary)"},children:"–†–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"})]}),e.jsx("button",{onClick:q,title:"–û—Ç–º–µ–Ω–∏—Ç—å",style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"var(--radius-sm)",color:"#ef4444",cursor:"pointer",transition:"all 0.2s"},children:"–û—Ç–º–µ–Ω–∞"})]}),e.jsx("div",{style:{height:"6px",background:"var(--glass-bg)",borderRadius:"3px",overflow:"hidden",marginBottom:"0.5rem"},children:e.jsx("div",{style:{height:"100%",width:`${L*100}%`,background:"linear-gradient(90deg, var(--primary), var(--accent))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:U||"–û–±—Ä–∞–±–æ—Ç–∫–∞..."}),e.jsxs("span",{style:{fontSize:"0.75rem",fontFamily:"SF Mono, monospace",color:"var(--text-muted)"},children:[Math.round(L*100),"%"]})]})]}),F&&V===t.id&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"0.85rem"},children:[e.jsx("strong",{children:"–û—à–∏–±–∫–∞:"})," ",F]})]})},Tr=({enabled:t,className:n="",compact:s=!1})=>{const{subscribe:o}=le(),[d,p]=r.useState(""),[c,m]=r.useState(""),[a,l]=r.useState(0),[,h]=r.useState(0),u=r.useRef(null),[i,g]=r.useState(!0),[y,C]=r.useState(!1),M=async()=>{const x=d+(c?" "+c:"");if(x.trim())try{await navigator.clipboard.writeText(x.trim()),C(!0),setTimeout(()=>C(!1),2e3)}catch(f){console.error("Failed to copy text:",f)}};r.useEffect(()=>{if(!t){p(""),m(""),l(0);return}const x=o("streaming_update",f=>{const w={text:f.streamingText||"",isConfirmed:f.streamingIsConfirmed||!1,confidence:f.streamingConfidence||0,timestamp:f.streamingTimestamp||Date.now()};h(w.timestamp),l(w.confidence),w.isConfirmed?(p(_=>(_?`${_} ${w.text}`:w.text).trim()),m("")):m(w.text),g(!0)});return()=>x()},[t,o]),r.useEffect(()=>{i&&u.current&&(u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"}),g(!1))},[i,d,c]);const I=()=>{if(!u.current)return;const{scrollTop:x,scrollHeight:f,clientHeight:w}=u.current,_=f-x-w<50;g(_)};if(!t)return null;const v=d||c,S=Math.round(a*100),T=a>=.85?"#10b981":a>=.7?"#f59e0b":"#ef4444",j=s?{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem 0.25rem 0",borderRadius:"6px",overflow:"hidden"}:{display:"flex",flexDirection:"column",height:"100%",background:"linear-gradient(180deg, rgba(59, 130, 246, 0.05) 0%, transparent 100%)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)",overflow:"hidden"};return e.jsxs("div",{className:`streaming-transcription ${n}`,style:j,children:[!s&&e.jsxs("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid rgba(59, 130, 246, 0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(59, 130, 246, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#3b82f6",animation:"pulse 2s ease-in-out infinite"}}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"#1f2937"},children:"Live –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è"})]}),v&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"12px",background:"rgba(255, 255, 255, 0.8)",border:`1px solid ${T}20`},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:T}}),e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:600,color:T},children:[S,"%"]})]})]}),e.jsx("button",{onClick:M,title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç",style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.3)",background:y?"rgba(16, 185, 129, 0.1)":"rgba(255, 255, 255, 0.8)",cursor:"pointer",fontSize:"0.75rem",color:y?"#10b981":"#6b7280",transition:"all 0.2s ease"},children:y?e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),e.jsx("span",{children:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),e.jsx("span",{children:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"})]})})]})]}),e.jsx("div",{ref:u,onScroll:I,style:s?{flex:"unset",padding:"0.4rem 0.5rem",overflowY:"hidden",fontSize:"0.9rem",lineHeight:"1.5",color:"#1f2937"}:{flex:1,padding:"1rem",overflowY:"auto",fontSize:"0.9375rem",lineHeight:"1.6",color:"#1f2937"},children:v?e.jsxs("div",{children:[d&&e.jsx("span",{style:{color:"#1f2937",fontWeight:400,transition:"all 0.3s ease"},children:d}),d&&c&&" ",c&&e.jsx("span",{style:{color:"#9ca3af",fontStyle:"italic",fontWeight:300,opacity:.8,transition:"all 0.3s ease",animation:"fadeIn 0.3s ease-in-out"},children:c})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#9ca3af",fontSize:"0.875rem"},children:"–û–∂–∏–¥–∞–Ω–∏–µ –∞—É–¥–∏–æ..."})}),v&&!s&&e.jsxs("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid rgba(59, 130, 246, 0.1)",fontSize:"0.75rem",color:"#9ca3af",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{style:{width:"12px",height:"2px",background:"#1f2937",borderRadius:"1px"}}),e.jsx("span",{children:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{style:{width:"12px",height:"2px",background:"#9ca3af",borderRadius:"1px",opacity:.6}}),e.jsx("span",{style:{fontStyle:"italic"},children:"–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π"})]})]}),e.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                    50% {
                        opacity: 0.5;
                        transform: scale(0.95);
                    }
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(-2px);
                    }
                    to {
                        opacity: 0.8;
                        transform: translateY(0);
                    }
                }

                .streaming-transcription::-webkit-scrollbar {
                    width: 6px;
                }

                .streaming-transcription::-webkit-scrollbar-track {
                    background: rgba(0, 0, 0, 0.05);
                    border-radius: 3px;
                }

                .streaming-transcription::-webkit-scrollbar-thumb {
                    background: rgba(59, 130, 246, 0.3);
                    border-radius: 3px;
                }

                .streaming-transcription::-webkit-scrollbar-thumb:hover {
                    background: rgba(59, 130, 246, 0.5);
                }
            `})]})},Rr=`http://localhost:${globalThis.AIWISPER_HTTP_PORT||18080}`,Ir=({chunks:t,sessionId:n,transcribingChunkId:s,highlightedChunkId:o,onPlayChunk:d})=>{const p=r.useRef(null),{isTauri:c,sendMessage:m}=le(),[a,l]=r.useState(!0),[h,u]=r.useState(!0),[i,g]=r.useState(0),y=r.useRef(t.length);r.useEffect(()=>{a&&p.current&&(p.current.scrollTo({top:p.current.scrollHeight,behavior:"smooth"}),l(!1),g(0))},[a,t.length]),r.useEffect(()=>{t.length>y.current&&(h?l(!0):g(I=>I+(t.length-y.current))),y.current=t.length},[t.length,h]);const C=()=>{if(!p.current)return;const{scrollTop:I,scrollHeight:v,clientHeight:S}=p.current,T=v-I-S<50;u(T),T&&g(0)},M=()=>l(!0);return t.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-muted)",fontSize:"0.9rem",fontStyle:"italic"},children:"–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞..."}):e.jsxs("div",{style:{position:"relative",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx("div",{ref:p,onScroll:C,style:{flex:1,overflowY:"auto",padding:"1rem",fontSize:"0.9rem"},children:t.map((I,v)=>{const S=v===t.length-1,T=s===I.id||I.status==="transcribing",j=o===I.id;return e.jsx(zr,{chunk:I,sessionId:n,isTauri:c,sendMessage:m,isLast:S,isTranscribing:T,isHighlighted:j,onPlayChunk:d},I.id)})}),!h&&i>0&&e.jsxs("button",{onClick:M,style:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",padding:"0.5rem 1rem",background:"var(--primary)",color:"white",border:"none",borderRadius:"9999px",fontSize:"0.85rem",fontWeight:600,cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s ease"},children:[e.jsxs("span",{children:["–ù–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤: ",i]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M19 12l-7 7-7-7"})})]})]})},Qe=new Map,zr=({chunk:t,sessionId:n,isTauri:s,sendMessage:o,isLast:d,isTranscribing:p,isHighlighted:c,onPlayChunk:m})=>{const[a,l]=r.useState(null),[h,u]=r.useState(!1),i=r.useMemo(()=>(t.duration/1e9).toFixed(1),[t.duration]),g=t.status==="completed"?"#4caf50":t.status==="error"?"#f44336":"#ff9800",y=t.status==="completed"?"‚úì":t.status==="error"?"‚úó":"‚è≥",C=async()=>{const M=`${n}:${t.index}`;if(a){m(a);return}const I=Qe.get(M);if(I){l(I),m(I);return}u(!0);try{if(s===!0){const v=await o({type:"get_chunk_audio",sessionId:n,chunkIndex:t.index});v&&typeof v=="string"&&(Qe.set(M,v),l(v),m(v))}else{const v=`${Rr}/api/sessions/${n}/chunk/${t.index}.mp3`;Qe.set(M,v),l(v),m(v)}}catch(v){console.error("[LiveChunkItem] Failed to load audio",v)}finally{u(!1)}};return e.jsxs("div",{style:{padding:"0.8rem 1rem",marginBottom:"0.75rem",backgroundColor:p?"rgba(59, 130, 246, 0.08)":c?"rgba(16, 185, 129, 0.08)":"var(--surface)",borderRadius:"10px",border:`1px solid ${p?"rgba(59, 130, 246, 0.3)":c?"rgba(16, 185, 129, 0.3)":"var(--border)"}`,borderLeft:`3px solid ${g}`,transition:"all 0.3s ease",animation:p?"transcribing-pulse 2s ease-in-out infinite":c?"highlight-flash 0.5s ease-in-out 2":"fadeIn 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",fontWeight:600},children:["–ß–∞–Ω–∫ #",t.index]}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:"‚Ä¢"}),e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:[i,"s"]}),e.jsx("span",{style:{color:g,fontSize:"0.9rem"},children:y})]}),t.status==="completed"&&e.jsx("button",{onClick:C,disabled:h,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",opacity:h?.7:1},children:"‚ñ∂"})]}),e.jsx(Er,{chunk:t}),p&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"#3b82f6",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{animation:"pulse 1s infinite"},children:"‚è≥"})," –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è..."]}),t.error&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"#f44336",fontSize:"0.85rem"},children:["–û—à–∏–±–∫–∞: ",t.error]}),d&&e.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px dashed var(--border)",color:"var(--text-muted)"},children:e.jsx(Tr,{enabled:!0,className:"compact-streaming"})})]})},Er=({chunk:t})=>{const n=s=>{if(s==="mic"||s==="–í—ã")return{name:"–í—ã",color:"#4caf50"};if(s?.startsWith("Speaker ")){const o=parseInt(s.replace("Speaker ",""),10);return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${o+1}`,color:["#2196f3","#e91e63","#ff9800","#9c27b0","#00bcd4","#8bc34a"][o%6]}}return s==="sys"?{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}:{name:s||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}};return t.dialogue&&t.dialogue.length>0?e.jsx("div",{style:{marginTop:"0.5rem",lineHeight:1.6},children:t.dialogue.map((s,o)=>e.jsx(Ar,{segment:s,getSpeakerDisplayName:n},o))}):t.micText||t.sysText?e.jsxs("div",{style:{marginTop:"0.5rem",lineHeight:1.5},children:[t.micText&&e.jsxs("div",{style:{color:"#4caf50",marginBottom:"0.3rem"},children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–í—ã: "}),t.micText]}),t.sysText&&e.jsxs("div",{style:{color:"#2196f3"},children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),t.sysText]})]}):t.transcription?e.jsx("div",{style:{marginTop:"0.5rem",color:"#ccc",lineHeight:1.5},children:t.transcription}):null},Ar=({segment:t,getSpeakerDisplayName:n})=>{const s=n(t.speaker),o=`${ht(t.start)}‚Äì${ht(t.end)}`;return e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"baseline",marginBottom:"0.35rem"},children:[e.jsx("span",{style:{color:s.color,fontWeight:700,minWidth:"110px",fontSize:"0.85rem"},children:s.name}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",minWidth:"88px",textAlign:"right",fontFamily:"monospace"},children:o}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t.text})]})},ht=t=>{const n=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},Dr=()=>{const{currentSession:t}=he(),{subscribe:n,sendMessage:s}=le(),o=t?.chunks||[],[d,p]=r.useState(null),[c,m]=r.useState(null);return r.useEffect(()=>{if(!t)return;const a=i=>{i.sessionId===t.id&&(p(i.chunk.id),setTimeout(()=>p(null),1200))},l=i=>{i.sessionId===t.id&&(m(g=>g===i.chunk.id?null:g),p(i.chunk.id),setTimeout(()=>p(null),2e3))},h=n("chunk_created",a),u=n("chunk_transcribed",l);return()=>{h?.(),u?.()}},[t,n]),t?e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.jsx(Ir,{chunks:o,sessionId:t.id,transcribingChunkId:c,highlightedChunkId:d,onPlayChunk:a=>{s({type:"play_audio_url",url:a})}})}):e.jsxs("div",{style:{color:"var(--text-muted)",textAlign:"center",marginTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üî¥"}),e.jsx("div",{children:"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å... –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"})]})},Lr=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("div",{style:{width:"120px",height:"56px",borderRadius:"28px",background:"linear-gradient(135deg, var(--primary), var(--primary-dark))",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem",marginBottom:"1.5rem",boxShadow:"var(--shadow-glow-primary)"},children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"var(--font-weight-bold)",color:"var(--text-primary)",marginBottom:"0.15rem",textAlign:"center",lineHeight:1.1},children:"AIWisper"}),e.jsx("p",{style:{fontSize:"0.95rem",color:"var(--text-secondary)",marginBottom:"2rem",marginTop:0,textAlign:"center",lineHeight:1.2},children:"–£–º–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ç–æ—Ä —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ø–∏–∫–µ—Ä–æ–≤"}),e.jsxs("div",{style:{width:"100%",background:"var(--glass-bg)",backdropFilter:"blur(var(--glass-blur-light))",borderRadius:"var(--radius-lg)",border:"1px solid var(--glass-border)",padding:"1.25rem",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{fontSize:"0.85rem",fontWeight:"var(--font-weight-semibold)",color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.04em",marginBottom:"1rem"},children:"–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx(Ze,{number:1,title:"–ù–∞–∂–º–∏—Ç–µ ¬´–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å¬ª",description:"–ö–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏"}),e.jsx(Ze,{number:2,title:"–ì–æ–≤–æ—Ä–∏—Ç–µ –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –∑–≤–æ–Ω–æ–∫",description:"–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∑–≤—É–∫"}),e.jsx(Ze,{number:3,title:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞",description:"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º ¬´–í—ã¬ª / ¬´–°–æ–±–µ—Å–µ–¥–Ω–∏–∫¬ª"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.75rem",width:"100%"},children:[e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),text:"–¢–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),text:"–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∏–∫–µ—Ä–æ–≤"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),text:"AI-—Å–≤–æ–¥–∫–∞"}),e.jsx(Ne,{icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),text:"–õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:"1.5rem",textAlign:"center"},children:"–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å —Å–ª–µ–≤–∞ –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é"})]}),Ze=({number:t,title:n,description:s})=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--glass-bg-elevated)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:"0.85rem",fontWeight:"var(--font-weight-semibold)",color:"var(--primary)"},children:t}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"0.9rem",fontWeight:"var(--font-weight-medium)"},children:n}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"0.8rem",marginTop:"2px"},children:s})]})]}),Ne=({icon:t,text:n})=>e.jsxs("div",{style:{padding:"0.75rem 1rem",background:"var(--glass-bg)",borderRadius:"var(--radius-md)",border:"1px solid var(--glass-border-subtle)",display:"flex",alignItems:"center",gap:"0.6rem",color:"var(--text-muted)"},children:[e.jsx("span",{style:{display:"flex",alignItems:"center",flexShrink:0},children:t}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:n})]}),ft=["#2196f3","#e91e63","#ff9800","#9c27b0","#00bcd4","#8bc34a"],Pr=t=>{if(t==="mic"||t==="–í—ã")return{name:"–í—ã",color:"#4caf50"};if(t?.startsWith("Speaker ")){const n=parseInt(t.replace("Speaker ",""),10);return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${n+1}`,color:ft[n%ft.length]}}else return t==="sys"?{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}:{name:t||"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:"#2196f3"}},_r=t=>{const n=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},et=new Map,Br=({chunks:t,sessionId:n,playingUrl:s,highlightedChunkId:o,transcribingChunkId:d,isFullTranscribing:p=!1,onPlayChunk:c,onRetranscribe:m})=>{const{isTauri:a,sendMessage:l}=le(),h=(t||[]).filter(u=>u);return h.length===0?e.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",padding:"2rem"},children:"–ù–µ—Ç —á–∞–Ω–∫–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"}):e.jsx("div",{children:h.map(u=>{const i=u.index??0,g=o===u.id,y=d===u.id||u.status==="transcribing";return e.jsx($r,{chunk:u,sessionId:n,chunkIndex:i,isTauri:a,sendMessage:l,playingUrl:s,isHighlighted:g,isTranscribing:y,isRetranscribeDisabled:p,onPlayChunk:c,onRetranscribe:()=>u.id&&m(u.id)},u.id||`chunk-${i}`)})})},$r=({chunk:t,sessionId:n,chunkIndex:s,isTauri:o,sendMessage:d,playingUrl:p,isHighlighted:c,isTranscribing:m,isRetranscribeDisabled:a=!1,onPlayChunk:l,onRetranscribe:h})=>{const[u,i]=r.useState(null),[g,y]=r.useState(!1),C=((t.duration||0)/1e9).toFixed(1),M=u&&p===u,I=async()=>{const T=`${n}:${s}`;if(u){l(u);return}const j=et.get(T);if(j){i(j),l(j);return}y(!0);try{if(o===!0){const x=await d({type:"get_chunk_audio",sessionId:n,chunkIndex:s});x&&typeof x=="string"&&(et.set(T,x),i(x),l(x))}else{const f=`${`http://localhost:${globalThis.AIWISPER_HTTP_PORT||18080}`}/api/sessions/${n}/chunk/${s}.mp3`;et.set(T,f),i(f),l(f)}}catch(x){console.error("[ChunkItem] Failed to load audio:",x)}finally{y(!1)}},v=t.dialogue&&t.dialogue.length>0,S=t.micText||t.sysText;return e.jsxs("div",{style:{padding:"0.75rem 1rem",marginBottom:"0.5rem",backgroundColor:m?"rgba(255, 152, 0, 0.1)":c?"rgba(76, 175, 80, 0.1)":"var(--surface)",borderRadius:"var(--radius-md)",transition:"background-color 0.3s ease",border:"1px solid var(--glass-border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.85rem"},children:["#",t.index??0," ‚Ä¢ ",C,"s"]}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{onClick:I,disabled:g,title:g?"–ó–∞–≥—Ä—É–∑–∫–∞...":M?"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",style:{padding:"0.25rem 0.5rem",backgroundColor:M?"var(--danger)":"var(--primary)",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:g?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:g?.6:1},children:g?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}):M?e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})})}),e.jsx("button",{onClick:h,disabled:a||m,title:a?"–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",style:{padding:"0.25rem 0.5rem",backgroundColor:"var(--surface-strong)",border:"1px solid var(--glass-border)",borderRadius:"var(--radius-sm)",color:"var(--text-muted)",cursor:a||m?"not-allowed":"pointer",opacity:a||m?.4:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})})]})]}),e.jsx("div",{style:{marginTop:"0.5rem",lineHeight:1.6},children:v?e.jsx(Wr,{dialogue:t.dialogue,chunkStartMs:t.startMs}):S?e.jsx(Fr,{micText:t.micText,sysText:t.sysText}):e.jsx("div",{style:{color:"var(--text-secondary)"},children:t.transcription||""})}),m&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--warning)",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),"–†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è..."]}),t.error&&e.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--danger)",fontSize:"0.8rem"},children:["–û—à–∏–±–∫–∞: ",t.error]})]})},Wr=({dialogue:t})=>e.jsx("div",{children:t.map((n,s)=>{const{name:o,color:d}=Pr(n.speaker),p=_r(n.start);return e.jsxs("div",{style:{marginBottom:"0.4rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderLeft:`3px solid ${d}`,borderRadius:"0 4px 4px 0"},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:"0.8rem",fontFamily:"monospace"},children:["[",p,"]"]})," ",e.jsxs("span",{style:{color:d,fontWeight:"bold"},children:[o,":"]})," ",e.jsx("span",{style:{color:"var(--text-primary)",wordBreak:"break-word"},children:n.text})]},s)})}),Fr=({micText:t,sysText:n})=>e.jsxs("div",{children:[t&&e.jsxs("div",{style:{marginBottom:"0.4rem",borderLeft:"3px solid #4caf50",paddingLeft:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold",fontSize:"0.85rem"},children:"–í—ã: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:t})]}),n&&e.jsxs("div",{style:{marginBottom:"0.4rem",borderLeft:"3px solid #2196f3",paddingLeft:"0.5rem",paddingTop:"0.2rem",paddingBottom:"0.2rem",borderRadius:"0 4px 4px 0"},children:[e.jsx("span",{style:{color:"#2196f3",fontWeight:"bold",fontSize:"0.85rem"},children:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: "}),e.jsx("span",{style:{color:"var(--text-primary)"},children:n})]})]}),Or=({currentTimeMs:t,segments:n,dialogueContainerRef:s,segmentRefs:o})=>{const[d,p]=r.useState(null);return r.useEffect(()=>{if(!s.current||n.length===0){p(null);return}const c=s.current;if(n.length>0&&t<n[0].start){const l=o.current.get(0);if(l){const h=l.getBoundingClientRect(),u=c.getBoundingClientRect();p(h.top-u.top-4)}return}for(let l=0;l<n.length;l++){const h=n[l],u=o.current.get(l);if(!u)continue;const i=u.getBoundingClientRect(),g=c.getBoundingClientRect(),y=i.top-g.top,C=i.height;if(t>=h.start&&t<=h.end){const M=h.end-h.start,I=M>0?(t-h.start)/M:0;p(y+C*I);return}if(l<n.length-1){const M=n[l+1];if(t>h.end&&t<M.start){const I=o.current.get(l+1);if(I){const S=I.getBoundingClientRect().top-g.top,T=y+C,j=S,x=M.start-h.end,f=x>0?(t-h.end)/x:0;p(T+(j-T)*f)}else p(y+C+4);return}}}const m=n.length-1,a=n[m];if(t>=a.end){const l=o.current.get(m);if(l){const h=l.getBoundingClientRect(),u=c.getBoundingClientRect();p(h.top-u.top+h.height+2)}}},[t,n,s,o]),d===null?null:e.jsx("div",{style:{position:"absolute",left:0,right:0,top:d,height:"2px",background:"linear-gradient(90deg, var(--primary) 0%, var(--primary) 80%, transparent 100%)",boxShadow:"0 0 8px var(--primary), 0 0 4px var(--primary)",zIndex:50,pointerEvents:"none",transition:"top 0.15s linear"}})},Vr=({currentTimeMs:t,segments:n,scrollContainerRef:s,dialogueContainerRef:o,segmentRefs:d,onClickScrollToPlayback:p})=>{const[c,m]=r.useState({top:0,visible:!1,isOutOfView:!1});return r.useEffect(()=>{const a=s.current,l=o.current;if(!a||!l||n.length===0){m({top:0,visible:!1,isOutOfView:!1});return}let h=null;const u=l.getBoundingClientRect(),i=a.getBoundingClientRect(),g=u.top-i.top+a.scrollTop;for(let T=0;T<n.length;T++){const j=n[T],x=d.current.get(T);if(!x)continue;const f=x.getBoundingClientRect(),w=f.top-u.top,_=g+w,B=f.height;if(t>=j.start&&t<=j.end){const R=j.end-j.start,N=R>0?(t-j.start)/R:0;h=_+B*N;break}if(T<n.length-1){const R=n[T+1];if(t>j.end&&t<R.start){h=_+B;break}}if(T===n.length-1&&t>=j.start){const R=j.end-j.start,N=R>0?Math.min(1,(t-j.start)/R):1;h=_+B*N}}if(h===null){m({top:0,visible:!1,isOutOfView:!1});return}const y=a.scrollHeight,C=a.clientHeight,M=a.scrollTop,v=h/y*C,S=h<M||h>M+C-20;m({top:Math.max(8,Math.min(C-8,v)),visible:!0,isOutOfView:S})},[t,n,s,o,d]),c.visible?e.jsx("div",{onClick:p,style:{position:"absolute",right:"4px",top:c.top,width:c.isOutOfView?"10px":"6px",height:c.isOutOfView?"10px":"6px",borderRadius:"50%",backgroundColor:"var(--primary)",boxShadow:c.isOutOfView?"0 0 10px var(--primary), 0 0 20px var(--primary)":"0 0 4px var(--primary)",zIndex:100,cursor:"pointer",transform:"translateY(-50%)",transition:"top 0.15s linear, width 0.2s ease, height 0.2s ease, box-shadow 0.2s ease",animation:c.isOutOfView?"pulse 1.5s ease-in-out infinite":"none"},title:"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è"}):null},Hr=({word:t,showConfidence:n})=>{if(!n||!t.p||t.p>=.7)return e.jsxs("span",{children:[t.text," "]});const s=t.p<.4,o=t.p<.7,d={backgroundColor:s?"rgba(255, 152, 0, 0.25)":o?"rgba(255, 193, 7, 0.15)":"transparent",borderRadius:"2px",padding:"0 2px",cursor:"help",borderBottom:s?"1px dashed rgba(255, 152, 0, 0.6)":void 0};return e.jsxs("span",{style:d,title:`–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${Math.round(t.p*100)}%`,children:[t.text," "]})},Nr=({segment:t,showConfidence:n,isCurrentSegment:s})=>!n||!t.words||t.words.length===0?e.jsx("span",{style:{color:"var(--text-primary)"},children:t.text||""}):e.jsx("span",{style:{color:"var(--text-primary)"},children:t.words.map((o,d)=>e.jsx(Hr,{word:o,showConfidence:n},d))}),Ur=({onPlayChunk:t,playingUrl:n,ollamaModel:s,isPlaying:o,isPlayingFullSession:d,onPlaySession:p,onPauseSession:c,currentTime:m,duration:a,onSeek:l,sessionSpeakers:h=[],onRetranscribeAll:u,onRenameSpeaker:i,onMergeSpeakers:g,onPlaySpeakerSample:y,onStopSpeakerSample:C,playingSpeakerId:M,waveformData:I,waveformLoading:v,waveformError:S})=>{const{currentSession:T,selectedSession:j,isRecording:x,generateSummary:f,isFullTranscribing:w}=he(),{sendMessage:_,subscribe:B}=le(),{activeModelId:R}=nt(),{sttSettings:N}=bt(),{language:E,hybridTranscription:D,ollamaModel:L,ollamaUrl:U,ollamaContextSize:F}=jt(),[V,q]=r.useState("dialogue"),[ee,de]=r.useState(!1),[X,me]=r.useState(!1),ie=r.useRef(null),fe=r.useRef(null),ue=r.useRef(new Map),[ae,be]=r.useState(null),[xe,ve]=r.useState(null),[te,pe]=r.useState(!0),H=j||T,re=H?.chunks||[];r.useEffect(()=>{const k=B("chunk_created",()=>{de(!0)}),P=B("chunk_transcribed",K=>{x&&de(!0),ve(J=>J===K.chunk.id?null:J),be(K.chunk.id),setTimeout(()=>be(null),2e3)});return()=>{k(),P()}},[B,x]),r.useEffect(()=>{ee&&ie.current&&(ie.current.scrollTo({top:ie.current.scrollHeight,behavior:"smooth"}),de(!1))},[ee]);const Y=r.useMemo(()=>(re||[]).filter(k=>k&&k.status==="completed").flatMap(k=>k.dialogue&&Array.isArray(k.dialogue)&&k.dialogue.length>0?k.dialogue.filter(P=>P&&typeof P.start=="number").map(P=>({...P,start:P.start||0,end:P.end||0,text:P.text||"",speaker:P.speaker||"unknown"})):[]).sort((k,P)=>k.start-P.start),[re]),oe=m*1e3,ne=r.useMemo(()=>{if(!o||Y.length===0)return-1;for(let k=0;k<Y.length;k++){const P=Y[k];if(oe>=P.start&&oe<P.end||k<Y.length-1&&oe>=P.end&&oe<Y[k+1].start)return k}return Y.length>0&&oe>=Y[Y.length-1].start?Y.length-1:-1},[oe,o,Y]);r.useEffect(()=>{if(!o||!te||ne<0)return;const k=ue.current.get(ne);if(k&&ie.current){const P=ie.current,K=k.getBoundingClientRect(),J=P.getBoundingClientRect();K.top>=J.top&&K.bottom<=J.bottom||k.scrollIntoView({behavior:"smooth",block:"center"})}},[ne,o,te]);const Se=r.useCallback(k=>{const P=k/1e3;l(P)},[l]),je=r.useCallback((k,P)=>{P?ue.current.set(k,P):ue.current.delete(k)},[]),ke=r.useCallback(k=>{const P={mic:"#4caf50",sys:"#2196f3",speakers:["#2196f3","#00bcd4","#3f51b5","#03a9f4","#673ab7","#5c6bc0"]};if(h.length>0){const K=h.find(J=>{if(k==="mic"||k==="–í—ã")return J.isMic;if(k==="sys"||k==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫")return!J.isMic&&J.localId===0;if(k.startsWith("Speaker ")){const se=parseInt(k.replace("Speaker ",""),10);return!J.isMic&&J.localId===se}if(k.startsWith("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ")){const se=parseInt(k.replace("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ",""),10);return!J.isMic&&J.localId===se-1}return J.displayName===k});if(K){const J=K.isMic?-1:K.localId,se=K.isMic?P.mic:P.speakers[Math.abs(J)%P.speakers.length];return{name:K.displayName,color:se}}}if(k==="mic"||k==="–í—ã")return{name:"–í—ã",color:P.mic};if(k==="sys"||k==="–°–æ–±–µ—Å–µ–¥–Ω–∏–∫")return{name:"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫",color:P.sys};if(k.startsWith("Speaker ")){const K=parseInt(k.replace("Speaker ",""),10)||0;return{name:`–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ${K+1}`,color:P.speakers[Math.abs(K)%P.speakers.length]}}if(k.startsWith("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ")){const K=parseInt(k.replace("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ ",""),10)||1;return{name:k,color:P.speakers[Math.abs(K-1)%P.speakers.length]}}return{name:k,color:P.sys}},[h]),we=k=>{if(!H)return;const P=s||L,K=N.activeProvider||"local";console.log("[handleRetranscribe] sttProvider:",K,"ollamaModel prop:",s,"settingsOllamaModel:",L,"effective:",P),ve(k),_({type:"retranscribe_chunk",sessionId:H.id,data:k,model:R,language:E,sttProvider:K,hybridEnabled:D.enabled,hybridSecondaryModelId:D.secondaryModelId,hybridConfidenceThreshold:D.confidenceThreshold,hybridContextWords:D.contextWords,hybridUseLLMForMerge:D.useLLMForMerge,hybridMode:D.mode,hybridHotwords:D.hotwords,hybridOllamaModel:P,hybridOllamaUrl:U})},[b,G]=r.useState(!1),[Z,O]=r.useState(null);r.useEffect(()=>{const k=B("summary_started",()=>{G(!0),O(null)}),P=B("summary_completed",()=>{G(!1)}),K=B("summary_error",J=>{G(!1),O(J.error)});return()=>{k(),P(),K()}},[B]);const Ie=()=>{H&&f(H.id,s,U||"http://localhost:11434",F)};return e.jsxs("main",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(j||x)&&e.jsxs("div",{style:{flexShrink:0,backgroundColor:"var(--app-bg)",borderBottom:"1px solid var(--border)",padding:"0 0"},children:[H&&!x&&e.jsx(Mr,{session:H,isPlaying:o,isPlayingFullSession:d,onPlayPause:()=>{o?c():p(H.id)},onSeek:l,currentTime:m,duration:a||H.totalDuration/1e3,onRetranscribe:()=>u?.(),onImprove:()=>q("summary"),waveformData:I,waveformLoading:v,waveformError:S}),H&&re.length>0&&e.jsx("div",{style:{padding:"0 1.5rem"},children:e.jsx(lr,{activeTab:V,onTabChange:q,hasSummary:!!H.summary,isGeneratingSummary:b,isRecording:x,speakersCount:h.length})})]}),e.jsxs("div",{ref:ie,style:{flex:1,padding:"1rem 1.5rem",overflowY:"auto",overflowX:"hidden",position:"relative"},onScroll:()=>{o&&pe(!1)},children:[o&&Y.length>0&&V==="dialogue"&&e.jsx(Vr,{currentTimeMs:oe,segments:Y,scrollContainerRef:ie,dialogueContainerRef:fe,segmentRefs:ue,onClickScrollToPlayback:()=>pe(!0)}),re.length===0&&!x&&!j?e.jsx(Lr,{}):re.length===0&&x?e.jsx(Dr,{}):e.jsxs(e.Fragment,{children:[V==="dialogue"&&e.jsx(e.Fragment,{children:Y.length>0?e.jsxs("div",{ref:fe,style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"var(--surface)",borderRadius:"8px",lineHeight:"1.9",fontSize:"0.95rem",position:"relative"},children:[o&&e.jsx(Or,{currentTimeMs:oe,segments:Y,dialogueContainerRef:fe,segmentRefs:ue}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("h4",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.9rem"},children:"–î–∏–∞–ª–æ–≥"}),H&&e.jsx(ct,{dialogue:Y,totalDuration:H.totalDuration,isCompact:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o&&e.jsx("button",{onClick:()=>pe(!te),style:{padding:"4px 10px",fontSize:"0.75rem",backgroundColor:te?"var(--glass-bg-elevated)":"transparent",color:te?"var(--text-primary)":"var(--text-muted)",border:te?"1px solid var(--glass-border)":"1px solid var(--border)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s",backdropFilter:te?"blur(8px)":"none",WebkitBackdropFilter:te?"blur(8px)":"none"},title:te?"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–∫–ª—é—á—ë–Ω":"–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤—ã–∫–ª—é—á–µ–Ω",children:"üìç –°–ª–µ–¥–∏—Ç—å"}),e.jsx("button",{onClick:()=>me(!X),style:{padding:"4px 10px",fontSize:"0.75rem",backgroundColor:X?"var(--glass-bg-elevated)":"transparent",color:X?"var(--text-primary)":"var(--text-muted)",border:X?"1px solid var(--glass-border)":"1px solid var(--border)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s",backdropFilter:X?"blur(8px)":"none",WebkitBackdropFilter:X?"blur(8px)":"none"},title:X?"–°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞ —Å –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–∂—ë–ª—Ç—ã–π <70%, –æ—Ä–∞–Ω–∂–µ–≤—ã–π <40%)",children:"üéØ Confidence"})]})]}),Y.map((k,P)=>{const K=k.start||0,J=Math.floor(K/6e4)||0,se=Math.floor(K%6e4/1e3)||0,Be=Math.floor(K%1e3/100)||0,Ce=`${J.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}.${Be}`,{name:$e,color:Me}=ke(k.speaker||""),ge=P===ne;return e.jsxs("div",{ref:ze=>je(P,ze),onClick:()=>Se(k.start),style:{marginBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.25rem",paddingBottom:"0.25rem",borderLeft:`3px solid ${Me}`,backgroundColor:ge?"rgba(138, 43, 226, 0.15)":"transparent",borderRadius:ge?"0 4px 4px 0":"0",transition:"background-color 0.2s ease",cursor:"pointer",position:"relative"},children:[ge&&e.jsx("div",{style:{position:"absolute",left:"-3px",top:0,bottom:0,width:"3px",backgroundColor:"var(--primary)",boxShadow:"0 0 8px var(--primary)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsxs("span",{style:{color:ge?"var(--primary)":"var(--text-muted)",fontSize:"0.8rem",fontFamily:"monospace",fontWeight:ge?"bold":"normal"},children:["[",Ce,"]"]})," ",e.jsxs("span",{style:{color:Me,fontWeight:"bold"},children:[$e,":"]})," ",e.jsx(Nr,{segment:k,showConfidence:X,isCurrentSegment:ge})]},P)})]}):(re||[]).filter(k=>k).map(k=>e.jsx("div",{style:{marginBottom:"0.8rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.03)",borderRadius:"4px",color:"#ccc"},children:k.transcription||""},k.id||Math.random()))}),V==="chunks"&&H&&e.jsx(Br,{chunks:re,sessionId:H.id,playingUrl:n,highlightedChunkId:ae,transcribingChunkId:xe,isFullTranscribing:w,onPlayChunk:t,onRetranscribe:we}),V==="stats"&&H&&e.jsx(ct,{dialogue:Y,totalDuration:H.totalDuration}),V==="speakers"&&H&&i&&e.jsx(dr,{sessionId:H.id,speakers:h,onRename:i,onMergeSpeakers:g,onPlaySample:y,onStopSample:C,playingSpeakerId:M}),V==="summary"&&H&&e.jsx(cr,{summary:H.summary||null,isGenerating:b,error:Z,onGenerate:Ie,hasTranscription:re.some(k=>k.status==="completed"),sessionDate:H.startTime,ollamaModel:s})]})]})]})},qr=t=>{const n=Math.floor(t/3600),s=Math.floor(t%3600/60),o=Math.floor(t%60);return n>0?`${n}:${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},Kr=({onStop:t})=>{const{isRecording:n,currentSession:s}=he(),[o,d]=r.useState(0),[p,c]=r.useState(Array(32).fill(.3)),m=r.useRef(null),[a,l]=r.useState(n),[h,u]=r.useState(!1);return r.useEffect(()=>{if(n)l(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u(!0)})});else{u(!1);const i=setTimeout(()=>{l(!1)},300);return()=>clearTimeout(i)}},[n]),r.useEffect(()=>{let i;if(n&&s){const g=new Date(s.startTime).getTime();i=setInterval(()=>{const y=new Date().getTime();d(Math.floor((y-g)/1e3))},100)}else d(0);return()=>clearInterval(i)},[n,s]),r.useEffect(()=>{if(!n)return;const i=()=>{c(g=>g.map((y,C)=>{const M=.3+Math.sin(Date.now()/200+C*.5)*.2,I=Math.random()*.4;return Math.min(1,Math.max(.1,M+I))})),m.current=requestAnimationFrame(i)};return i(),()=>{m.current&&cancelAnimationFrame(m.current)}},[n]),a?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:100,background:"linear-gradient(180deg, rgba(239, 68, 68, 0.15) 0%, transparent 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",borderBottom:"1px solid rgba(239, 68, 68, 0.2)",padding:"0.5rem 1.5rem",paddingTop:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"2rem",WebkitAppRegion:"drag",opacity:h?1:0,transform:h?"translateY(0)":"translateY(-100%)",transition:"opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("div",{style:{position:"relative",width:"12px",height:"12px"},children:[e.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"#ef4444",animation:"recordPulseRing 1.5s infinite"}}),e.jsx("div",{style:{position:"absolute",inset:"2px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 12px rgba(239, 68, 68, 0.8)"}})]}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:600,color:"#ef4444",textTransform:"uppercase",letterSpacing:"0.05em"},children:"–ó–∞–ø–∏—Å—å"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"2px",height:"28px"},children:p.map((i,g)=>e.jsx("div",{style:{width:"3px",height:`${i*100}%`,minHeight:"4px",background:`linear-gradient(to top, rgba(239, 68, 68, 0.6), rgba(239, 68, 68, ${.3+i*.7}))`,borderRadius:"2px",transition:"height 0.1s ease-out"}},g))}),e.jsx("div",{style:{fontFamily:"SF Mono, Menlo, Monaco, monospace",fontSize:"1.2rem",fontWeight:700,color:"var(--text-primary)",minWidth:"80px",textAlign:"center",letterSpacing:"0.02em"},children:qr(o)}),e.jsxs("button",{onClick:t,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1.25rem",background:"rgba(239, 68, 68, 0.9)",border:"none",borderRadius:"9999px",color:"white",fontSize:"0.9rem",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",boxShadow:"0 2px 12px rgba(239, 68, 68, 0.4)",WebkitAppRegion:"no-drag"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(220, 38, 38, 1)",i.currentTarget.style.transform="scale(1.02)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(239, 68, 68, 0.9)",i.currentTarget.style.transform="scale(1)"},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})}),"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"]}),e.jsx("style",{children:`
                @keyframes recordPulseRing {
                    0%, 100% {
                        transform: scale(1);
                        opacity: 1;
                    }
                    50% {
                        transform: scale(1.8);
                        opacity: 0;
                    }
                }
            `})]})}):null},Xr=()=>{const t=r.useRef(null),[n,s]=r.useState(null),[o,d]=r.useState(!1),[p,c]=r.useState(0),[m,a]=r.useState(0),[l,h]=r.useState(0),[u,i]=r.useState(0),g=r.useRef(null),y=r.useRef(null),C=r.useRef(null),M=r.useRef(!1),I=r.useRef(null),v=r.useRef(null),S=r.useRef(null),T=r.useRef(0);r.useEffect(()=>{const L=new Audio;return L.crossOrigin="anonymous",L.onended=()=>{s(null),d(!1),j()},L.onerror=U=>{console.error("[useAudioPlayer] Audio error:",U),s(null),d(!1),j()},L.ontimeupdate=()=>c(L.currentTime),L.onloadedmetadata=()=>a(L.duration),L.onplay=()=>d(!0),L.onpause=()=>d(!1),t.current=L,()=>{L.pause(),S.current!==null&&cancelAnimationFrame(S.current),g.current&&g.current.close(),t.current=null}},[]);const j=r.useCallback(()=>{h(0),i(0),S.current!==null&&(cancelAnimationFrame(S.current),S.current=null)},[]),x=L=>{let U=0;for(let F=0;F<L.length;F++){const V=L[F];U+=V*V}return Math.sqrt(U/L.length)},f=L=>{if(L<=0)return 0;const U=20*Math.log10(L),F=-50,q=(U-F)/(0-F)*100;return Math.max(0,Math.min(100,q))},w=r.useCallback(()=>{const L=t.current;if(!L||M.current)return;g.current||(g.current=new AudioContext),g.current.state==="suspended"&&g.current.resume();const U=g.current.createMediaElementSource(L),F=g.current.createChannelSplitter(2);y.current=g.current.createAnalyser(),C.current=g.current.createAnalyser(),y.current.fftSize=128,C.current.fftSize=128,y.current.smoothingTimeConstant=0,C.current.smoothingTimeConstant=0,I.current=new Float32Array(y.current.fftSize),v.current=new Float32Array(C.current.fftSize);const V=g.current.createChannelMerger(2);U.connect(F),F.connect(y.current,0),F.connect(C.current,1),y.current.connect(V,0,0),C.current.connect(V,0,1),V.connect(g.current.destination),M.current=!0},[]),_=r.useCallback(()=>{const L=y.current,U=C.current,F=t.current;if(!F||F.paused||F.ended){j();return}const V=F.currentTime;if(Math.abs(V-T.current)>.02&&(T.current=V,c(V)),L&&U&&I.current&&v.current){L.getFloatTimeDomainData(I.current),U.getFloatTimeDomainData(v.current);const q=x(I.current),ee=x(v.current),de=f(q),X=f(ee);or.flushSync(()=>{h(de),i(X)})}S.current=requestAnimationFrame(_)},[j]),B=r.useCallback(L=>{const U=t.current;if(U){if(S.current!==null&&(cancelAnimationFrame(S.current),S.current=null),n===L){U.pause(),U.currentTime=0,s(null),c(0),T.current=0,j();return}U.src=L,c(0),T.current=0,w(),U.play().then(()=>{s(L),S.current=requestAnimationFrame(_)}).catch(F=>{console.error("Failed to play audio:",F),j(),s(null)})}},[n,w,_,j]),R=r.useCallback(()=>{t.current&&!t.current.paused&&t.current.pause()},[]),N=r.useCallback(()=>{t.current&&(t.current.pause(),t.current.currentTime=0,s(null),d(!1),j())},[j]),E=r.useCallback(L=>{t.current&&(t.current.currentTime=L)},[]),D=r.useCallback(L=>n===L&&o,[n,o]);return{play:B,pause:R,stop:N,seek:E,isPlayingUrl:D,isPlaying:o,playingUrl:n,currentTime:p,duration:m,micLevel:l,sysLevel:u}},Yr=({shortcuts:t,enabled:n=!0})=>{const s=r.useCallback(o=>{if(!n)return;const d=o.target,p=document.activeElement;if(!(d.tagName==="INPUT"||d.tagName==="TEXTAREA"||d.isContentEditable||p?.tagName==="INPUT"||p?.tagName==="TEXTAREA"||p?.isContentEditable))for(const m of t){if(m.enabled===!1)continue;const a=o.key.toLowerCase()===m.key.toLowerCase(),l=m.ctrl?o.ctrlKey||o.metaKey:!o.ctrlKey,h=m.shift?o.shiftKey:!o.shiftKey,u=m.alt?o.altKey:!o.altKey;if(m.meta&&o.metaKey,m.meta){if(a&&o.metaKey&&!o.shiftKey&&!o.altKey){o.preventDefault(),m.action();return}}else if(m.ctrl){if(a&&(o.ctrlKey||o.metaKey)&&!o.shiftKey&&!o.altKey){o.preventDefault(),m.action();return}}else if(a&&l&&h&&u&&!o.ctrlKey&&!o.metaKey&&!o.altKey){o.preventDefault(),m.action();return}}},[t,n]);return r.useEffect(()=>(window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)),[s]),{shortcuts:t.filter(o=>o.enabled!==!1).map(o=>({key:o.key,modifiers:[o.meta&&"‚åò",o.ctrl&&"Ctrl",o.shift&&"‚áß",o.alt&&"‚å•"].filter(Boolean).join("+"),description:o.description}))}},Gr=t=>{const n=[];return t.onStartStop&&n.push({key:"r",meta:!0,action:t.onStartStop,description:t.isRecording?"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å":"–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"}),t.onPlayPause&&n.push({key:" ",action:t.onPlayPause,description:t.isPlaying?"–ü–∞—É–∑–∞":"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏",enabled:!t.isRecording}),t.onSeekForward&&n.push({key:"ArrowRight",action:t.onSeekForward,description:"–í–ø–µ—Ä—ë–¥ 10 —Å–µ–∫",enabled:!t.isRecording}),t.onSeekBackward&&n.push({key:"ArrowLeft",action:t.onSeekBackward,description:"–ù–∞–∑–∞–¥ 10 —Å–µ–∫",enabled:!t.isRecording}),t.onToggleSettings&&n.push({key:",",meta:!0,action:t.onToggleSettings,description:"–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"}),t.onCopyTranscription&&n.push({key:"c",meta:!0,shift:!0,action:t.onCopyTranscription,description:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é"}),t.onExportTXT&&n.push({key:"e",meta:!0,action:t.onExportTXT,description:"–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT"}),t.onShowHelp&&n.push({key:"?",action:t.onShowHelp,description:"–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"}),n},Jr=["audio/mp3","audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/m4a","audio/x-m4a","audio/mp4","audio/ogg","audio/webm","audio/flac"],Qr=({onFileDrop:t,acceptedTypes:n=Jr,enabled:s=!0})=>{const[o,d]=r.useState(!1),[p,c]=r.useState(!1),[m,a]=r.useState(null),[l,h]=r.useState(null),u=r.useRef(0),i=r.useCallback(v=>{if(n.includes(v.type))return!0;const S=v.name.split(".").pop()?.toLowerCase();return!!(S&&["mp3","wav","m4a","ogg","webm","flac","aac"].includes(S))},[n]),g=r.useCallback(v=>{s&&(v.preventDefault(),v.stopPropagation())},[s]),y=r.useCallback(v=>{s&&(v.preventDefault(),v.stopPropagation(),u.current++,v.dataTransfer.items&&v.dataTransfer.items.length>0&&d(!0))},[s]),C=r.useCallback(v=>{s&&(v.preventDefault(),v.stopPropagation(),u.current--,u.current===0&&d(!1))},[s]),M=r.useCallback(async v=>{if(!s)return;v.preventDefault(),v.stopPropagation(),d(!1),u.current=0;const S=Array.from(v.dataTransfer.files);if(S.length===0)return;const T=S[0];if(!i(T)){h(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: ${T.type||T.name.split(".").pop()}`);return}c(!0),a("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞..."),h(null);try{await t(T),a(null)}catch(j){h(j.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞")}finally{c(!1)}},[s,i,t]),I=r.useCallback(()=>{h(null)},[]);return r.useEffect(()=>()=>{u.current=0},[]),{isDragging:o,isProcessing:p,progress:m,error:l,dragHandlers:{onDragOver:g,onDragEnter:y,onDragLeave:C,onDrop:M},clearError:I}},Le={container:{position:"fixed",inset:0,background:"rgba(138, 43, 226, 0.15)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,pointerEvents:"none"},content:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"2px dashed var(--primary)"},icon:{fontSize:"3rem",marginBottom:"1rem"},title:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)"},subtitle:{fontSize:"0.85rem",color:"var(--text-muted)",marginTop:"0.5rem"}},Pe=()=>"__TAURI__"in window,Zr=()=>{const[t,n]=r.useState({microphone:!1,screenRecording:!1,loading:!0,error:null}),s=r.useCallback(async()=>{if(!Pe())return!0;try{const m=await Ve("plugin:macos-permissions|check_microphone_permission");return console.log("[Permissions] Microphone permission:",m),n(a=>({...a,microphone:m})),m}catch(m){return console.error("[Permissions] Failed to check microphone permission:",m),n(a=>({...a,error:String(m)})),!1}},[]),o=r.useCallback(async()=>{if(!Pe())return!0;try{return console.log("[Permissions] Requesting microphone permission..."),await Ve("plugin:macos-permissions|request_microphone_permission"),await new Promise(a=>setTimeout(a,1e3)),await s()}catch(m){return console.error("[Permissions] Failed to request microphone permission:",m),n(a=>({...a,error:String(m)})),!1}},[s]),d=r.useCallback(async()=>{if(!Pe())return!0;try{const m=await Ve("plugin:macos-permissions|check_screen_recording_permission");return console.log("[Permissions] Screen recording permission:",m),n(a=>({...a,screenRecording:m})),m}catch(m){return console.error("[Permissions] Failed to check screen recording permission:",m),n(a=>({...a,error:String(m)})),!1}},[]),p=r.useCallback(async()=>{if(!Pe())return!0;try{return console.log("[Permissions] Requesting screen recording permission..."),await Ve("plugin:macos-permissions|request_screen_recording_permission"),await new Promise(a=>setTimeout(a,500)),await d()}catch(m){return console.error("[Permissions] Failed to request screen recording permission:",m),n(a=>({...a,error:String(m)})),!1}},[d]),c=r.useCallback(async()=>{if(!Pe()){n({microphone:!0,screenRecording:!0,loading:!1,error:null});return}n(m=>({...m,loading:!0,error:null}));try{const[m,a]=await Promise.all([s(),d()]);n({microphone:m,screenRecording:a,loading:!1,error:null})}catch(m){n(a=>({...a,loading:!1,error:String(m)}))}},[s,d]);return r.useEffect(()=>{c()},[c]),{status:t,checkMicrophonePermission:s,requestMicrophonePermission:o,checkScreenRecordingPermission:d,requestScreenRecordingPermission:p,checkAllPermissions:c}};var en={};const xt="2.0.6",dn=({addLog:t})=>{const n=`http://localhost:${typeof process<"u"&&en?.AIWISPER_HTTP_PORT||18080}`,{startSession:s,stopSession:o,isRecording:d,selectedSession:p,micLevel:c,sysLevel:m,isFullTranscribing:a}=he(),{activeModelId:l,models:h,fetchOllamaModels:u,downloadModel:i,cancelDownload:g,deleteModel:y,setActiveModel:C,ollamaModels:M,ollamaModelsLoading:I,ollamaError:v}=nt(),{sendMessage:S,subscribe:T,isTauri:j}=le(),{status:x,isLoading:f,error:w,segmentationModels:_,embeddingModels:B,enableDiarization:R,disableDiarization:N}=br(),{sttSettings:E}=bt(),{play:D,pause:L,playingUrl:U,seek:F,currentTime:V,duration:q,isPlaying:ee,micLevel:de,sysLevel:X}=Xr(),{settings:me,isLoaded:ie,theme:fe,setTheme:ue,language:ae,setLanguage:be,micDevice:xe,setMicDevice:ve,captureSystem:te,setCaptureSystem:pe,useVoiceIsolation:H,setUseVoiceIsolation:re,echoCancel:Y,setEchoCancel:oe,ollamaModel:ne,setOllamaModel:Se,ollamaContextSize:je,setOllamaContextSize:ke,enableStreaming:we,pauseThreshold:b,streamingChunkSeconds:G,streamingConfirmationThreshold:Z,hybridTranscription:O,setHybridTranscription:Ie,ollamaUrl:k}=jt(),{requestMicrophonePermission:P,checkMicrophonePermission:K}=Zr(),[J,se]=r.useState(!1),[Be,Ce]=r.useState(!1),[$e,Me]=r.useState(!1),[ge,ze]=r.useState(!1),[Ct,Ue]=r.useState(""),[Mt,Tt]=r.useState([]),[Rt,qe]=r.useState([]),[It,Ee]=r.useState(null),ce=r.useRef(null),[zt,ot]=r.useState([]),[Et,st]=r.useState(!1),[it,Ke]=r.useState(null),[at,Ae]=r.useState("idle"),[At,We]=r.useState(null),Fe=r.useRef(null),[Dt,Lt]=r.useState("auto"),[Pt,_t]=r.useState("auto");r.useEffect(()=>{const z=p?.id;if(!z){Fe.current=null,Ke(null),Ae("idle"),We(null);return}if(Fe.current===z&&it)return;let A=!1;return Ae("loading"),We(null),(async()=>{try{if(!j){Ae("error"),We("–¢—Ä–µ–±—É–µ—Ç—Å—è Tauri backend");return}const W=await S({type:"get_waveform",sessionId:z});if(A)return;if(W?.waveform)Ke(W.waveform),Fe.current=z,Ae("ready");else throw W?.error?new Error(W.error):new Error("waveform not available")}catch(W){if(A)return;console.error("Failed to build waveform",W),Ke(null),Fe.current=null,Ae("error"),We(W instanceof Error?W.message:String(W))}})(),()=>{A=!0}},[p?.id,j,S]),r.useEffect(()=>{(async()=>{try{const $=(await navigator.mediaDevices.enumerateDevices()).filter(W=>W.kind==="audioinput").map(W=>({id:W.deviceId,name:W.label||`Microphone ${W.deviceId}`,isInput:!0,isOutput:!1}));Tt($)}catch(A){console.error("Error fetching devices",A)}})()},[]),r.useEffect(()=>{const z=T("model_loading",W=>{ze(!0),Ue(W.modelName||W.modelId||"–º–æ–¥–µ–ª—å"),t(`–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏: ${W.modelName||W.modelId}...`)}),A=T("model_loaded",W=>{ze(!1),Ue(""),t(`–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${W.modelName||W.modelId}`)}),$=T("model_load_error",W=>{ze(!1),Ue(""),t(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: ${W.error}`)});return()=>{z(),A(),$()}},[T,t]),r.useEffect(()=>{const z=T("session_speakers",Q=>{qe(Q.speakers||[])}),A=T("speaker_renamed",Q=>{qe(nr=>nr.map(Oe=>Oe.localId===Q.localId?{...Oe,displayName:Q.newName,isRecognized:Q.savedAsVoiceprint||Oe.isRecognized}:Oe))}),$=T("speakers_merged",Q=>{console.log("[MainLayout] Speakers merged:",Q),Q.sessionId&&S({type:"get_session_speakers",sessionId:Q.sessionId})}),W=T("chunk_transcribed",Q=>{Q.sessionId&&S({type:"get_session_speakers",sessionId:Q.sessionId})});return()=>{z(),A(),$(),W()}},[T,S]),r.useEffect(()=>{p?S({type:"get_session_speakers",sessionId:p.id}):qe([])},[p,S]);const ye=r.useCallback(async()=>{st(!0);try{if(j){const z=await S({type:"list_voiceprints"});z&&z.voiceprints&&ot(z.voiceprints)}else{const A=await(await fetch(`${n}/api/voiceprints`)).json();ot(A.voiceprints||[])}}catch(z){console.error("[refreshVoiceprints] Error:",z)}finally{st(!1)}},[n,j,S]);r.useEffect(()=>{ye()},[ye]);const Bt=r.useCallback((z,A,$)=>{p&&(S({type:"rename_session_speaker",sessionId:p.id,localSpeakerId:z,speakerName:A,saveAsVoiceprint:$}),console.log(`[MainLayout] Renaming speaker ${z} to "${A}"${$?" (saving voiceprint)":""}`))},[p,S]),$t=r.useCallback((z,A,$,W,Q)=>{p&&(S({type:"merge_speakers",sessionId:p.id,sourceSpeakerIds:z,targetSpeakerId:A,speakerName:$,mergeEmbeddings:W,saveAsVoiceprint:Q}),console.log(`[MainLayout] Merging speakers ${z.join(", ")} into ${A} as "${$}"`))},[p,S]),Wt=r.useCallback(z=>{if(!p)return;ce.current&&(ce.current.pause(),ce.current=null);const A=`${n}/api/speaker-sample/${p.id}/${z}`,$=new Audio(A);ce.current=$,Ee(z),$.onended=()=>{Ee(null),ce.current=null},$.onerror=()=>{Ee(null),ce.current=null},$.play().catch(()=>{Ee(null),ce.current=null})},[p,n]),Ft=r.useCallback(()=>{ce.current&&(ce.current.pause(),ce.current=null),Ee(null)},[]),Ot=r.useCallback(async(z,A)=>{try{j?await S({type:"rename_voiceprint",id:z,name:A}):await fetch(`${n}/api/voiceprints/${z}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:A})}),ye()}catch($){console.error("[handleRenameVoiceprint] Error:",$)}},[n,j,S,ye]),Vt=r.useCallback(async z=>{try{j?await S({type:"delete_voiceprint",id:z}):await fetch(`${n}/api/voiceprints/${z}`,{method:"DELETE"}),ye()}catch(A){console.error("[handleDeleteVoiceprint] Error:",A)}},[n,j,S,ye]),Ht=r.useCallback((z,A,$)=>{R(z,A,$)},[R]),Nt=r.useCallback(()=>{N()},[N]);r.useEffect(()=>{d&&we?(S({type:"enable_streaming",streamingChunkSeconds:G,streamingConfirmationThreshold:Z}),t(`Streaming transcription enabled (chunk=${G}s, threshold=${Math.round(Z*100)}%)`)):d||S({type:"disable_streaming"})},[d,we,G,Z,S,t]);const Xe=r.useCallback(async()=>{if(a&&!d){t("Cannot start recording during retranscription");return}if(d)await o(),t("Recording stopped");else{if(!l){alert("Please select a model first");return}if(j&&!await K()){if(t("Requesting microphone permission..."),!await P()){t("Microphone permission denied. Please grant access in System Preferences > Privacy & Security > Microphone"),alert(`–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.

–û—Ç–∫—Ä–æ–π—Ç–µ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ > –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å > –ú–∏–∫—Ä–æ—Ñ–æ–Ω –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –¥–ª—è AIWisper.`);return}t("Microphone permission granted")}try{await s({model:l,language:ae,micDevice:xe,captureSystem:te,useVoiceIsolation:H,echoCancel:Y,pauseThreshold:b,useNativeCapture:!0,hybridEnabled:O.enabled,hybridSecondaryModelId:O.secondaryModelId,hybridConfidenceThreshold:O.confidenceThreshold,hybridContextWords:O.contextWords,hybridUseLLMForMerge:O.useLLMForMerge,hybridMode:O.mode}),t("Recording started"),O.enabled&&O.secondaryModelId&&t(`Hybrid transcription enabled: secondary model = ${O.secondaryModelId}`)}catch(z){t(`Error starting session: ${z.message}`)}}},[d,a,o,s,l,ae,xe,te,H,Y,b,O,t,j,K,P]),Ut=r.useCallback(z=>{D(z)},[D]),Ye=r.useCallback(async z=>{if(j)try{const A=await S({type:"get_full_audio",sessionId:z});A&&typeof A=="string"?D(A):t("Failed to load session audio")}catch(A){console.error("[handlePlaySession] IPC error:",A),t("Error loading session audio")}else{const A=`${n}/api/sessions/${z}/full.mp3`;D(A)}},[n,D,j,S,t]),qt=r.useCallback(()=>{if(console.log("[handleRetranscribeAll] Called, selectedSession:",p?.id),a){t("Retranscription already in progress");return}if(d){t("Cannot retranscribe during recording");return}if(!p){t("No session selected for retranscription");return}const z=h.find(Q=>Q.id===l),A=z?.id||l,$=E.activeProvider||"local";if(console.log("[handleRetranscribeAll] activeModel:",z?.name,"modelId:",A,"sttProvider:",$),!(z?.status==="downloaded"||z?.status==="active")&&l&&$==="local"){t(`Model not downloaded (status: ${z?.status}). Open model manager to download.`),Ce(!0);return}if(!A&&$==="local"){t("No model selected. Please select a model in settings."),Ce(!0);return}console.log("[handleRetranscribeAll] Sending retranscribe_full message"),S({type:"retranscribe_full",sessionId:p.id,model:A,language:ae,sttProvider:$,diarizationEnabled:!1,hybridEnabled:O.enabled,hybridSecondaryModelId:O.secondaryModelId,hybridConfidenceThreshold:O.confidenceThreshold,hybridContextWords:O.contextWords,hybridUseLLMForMerge:O.useLLMForMerge,hybridMode:O.mode,hybridHotwords:O.hotwords,hybridOllamaModel:ne,hybridOllamaUrl:k}),t(`Starting full retranscription with ${$==="local"?"model: "+(z?.name||A):"cloud: "+$}, hybrid: ${O.enabled}`)},[p,h,l,ae,S,t,O,ne,k,a,d,E]),Kt=r.useCallback(()=>{u(me.ollamaUrl)},[u,me.ollamaUrl]),{copyToClipboard:lt,exportTXT:dt}=wt(),Xt=r.useCallback(()=>{p&&!d&&(ee?L():Ye(p.id))},[p,d,ee,L,Ye]),Yt=r.useCallback(()=>{!d&&q>0&&F(Math.min(V+10,q))},[d,q,V,F]),Gt=r.useCallback(()=>{d||F(Math.max(V-10,0))},[d,V,F]),Jt=r.useCallback(async()=>{p&&await lt(p)&&t("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")},[p,lt,t]),Qt=r.useCallback(()=>{p&&(dt(p),t("–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT –∑–∞–≤–µ—Ä—à—ë–Ω"))},[p,dt,t]);Yr({shortcuts:Gr({onStartStop:Xe,onPlayPause:Xt,onSeekForward:Yt,onSeekBackward:Gt,onToggleSettings:()=>se(z=>!z),onCopyTranscription:Jt,onExportTXT:Qt,onShowHelp:()=>Me(!0),isRecording:d,isPlaying:ee}),enabled:!$e&&!Be});const Zt=r.useCallback(async z=>{try{if(j){t("Import not yet implemented in Tauri build");return}const A=new FormData;A.append("audio",z),A.append("model",l||""),A.append("language",ae);const $=await fetch(`${n}/api/import`,{method:"POST",body:A});if(!$.ok){const Q=await $.text();throw new Error(Q||`HTTP ${$.status}`)}const W=await $.json();t(`–§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, —Å–µ—Å—Å–∏—è: ${W.sessionId||"—Å–æ–∑–¥–∞–Ω–∞"}`),t("–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ")}catch(A){throw t(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${A.message}`),A}},[t,n,l,ae,j]),{isDragging:er,isProcessing:tr,dragHandlers:rr}=Qr({onFileDrop:Zt,enabled:!d});return ie?e.jsxs("div",{className:"app-frame",style:{display:"flex",flexDirection:"column",height:"100vh",background:"var(--app-bg)",color:"var(--text-primary)"},...rr,children:[er&&e.jsx("div",{style:Le.container,children:e.jsxs("div",{style:Le.content,children:[e.jsx("div",{style:Le.icon,children:"üìÅ"}),e.jsx("div",{style:Le.title,children:"–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å—é–¥–∞"}),e.jsx("div",{style:Le.subtitle,children:"MP3, WAV, M4A, OGG, FLAC"})]})}),tr&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"1px solid var(--glass-border)"},children:[e.jsx("div",{style:{width:"48px",height:"48px",margin:"0 auto 1.5rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)"},children:"–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞..."})]})}),ge&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"var(--surface-elevated)",borderRadius:"var(--radius-xl)",padding:"2rem 3rem",textAlign:"center",boxShadow:"var(--shadow-lg)",border:"1px solid var(--glass-border)",maxWidth:"400px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",margin:"0 auto 1.5rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)",marginBottom:"0.5rem"},children:"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏"}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginBottom:"1rem"},children:Ct}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",opacity:.7},children:"–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 30 —Å–µ–∫—É–Ω–¥"})]})}),e.jsx("style",{children:`
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `}),e.jsx(Kr,{onStop:Xe}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden",marginTop:d?"48px":0,transition:"margin-top 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx(jr,{onStartRecording:Xe}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(kr,{showSettings:J,setShowSettings:se,onShowHelp:()=>Me(!0)}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsx(Cr,{children:e.jsx(Ur,{onPlayChunk:Ut,playingUrl:U,ollamaModel:ne,isPlaying:ee,isPlayingFullSession:U?.includes("/full.mp3")??!1,onPlaySession:Ye,onPauseSession:L,currentTime:V,duration:q,onSeek:F,sessionSpeakers:Rt,onRetranscribeAll:qt,onRenameSpeaker:Bt,onMergeSpeakers:$t,onPlaySpeakerSample:Wt,onStopSpeakerSample:Ft,playingSpeakerId:It,waveformData:it,waveformLoading:at==="loading",waveformError:at==="error"?At||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ":null})}),e.jsx(ur,{micLevel:ee?de:c,sysLevel:ee?X:m,isActive:d||ee})]})]})]}),Be&&e.jsx(pr,{models:h,activeModelId:l,onClose:()=>Ce(!1),onDownload:i,onCancelDownload:g,onDelete:y,onSetActive:C}),e.jsx(mr,{isOpen:J,onClose:()=>se(!1),devices:Mt.map(z=>({...z,isInput:!0})),micDevice:xe,setMicDevice:ve,captureSystem:te,setCaptureSystem:pe,vadMode:Dt,setVADMode:Lt,vadMethod:Pt,setVADMethod:_t,screenCaptureKitAvailable:!0,useVoiceIsolation:H,setUseVoiceIsolation:re,echoCancel:Y,setEchoCancel:oe,language:ae,setLanguage:be,theme:fe,setTheme:ue,ollamaModel:ne,setOllamaModel:Se,ollamaContextSize:je,setOllamaContextSize:ke,ollamaModels:M,ollamaModelsLoading:I,ollamaError:v,loadOllamaModels:Kt,onShowModelManager:()=>Ce(!0),activeModelId:l,models:h,diarizationStatus:x,diarizationLoading:f,diarizationError:w,segmentationModels:_,embeddingModels:B,onEnableDiarization:Ht,onDisableDiarization:Nt,hybridTranscription:O,onHybridTranscriptionChange:Ie,voiceprints:zt,voiceprintsLoading:Et,onRenameVoiceprint:Ot,onDeleteVoiceprint:Vt,onRefreshVoiceprints:ye,appVersion:xt}),e.jsx(gr,{isOpen:$e,onClose:()=>Me(!1),appVersion:xt}),e.jsx(wr,{})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"var(--app-bg)",color:"var(--text-primary)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",margin:"0 auto 1rem",border:"3px solid var(--glass-border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("div",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫..."})]})})};export{ln as A,an as D,on as M,sn as S,dn as a};
