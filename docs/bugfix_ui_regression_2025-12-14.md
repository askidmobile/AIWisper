# План исправления UI регрессий v1.41.x

**Дата**: 2025-12-14
**Версия**: 1.41.1 → 1.41.2
**Статус**: ✅ Завершено

## Обнаруженные проблемы

### 1. Настройки стали блоком вместо модального окна
**Приоритет**: Высокий
**Описание**: Настройки отображаются как встроенный блок в интерфейсе вместо отдельного модального окна (SettingsModal).
**Ожидаемое поведение**: Настройки должны открываться в модальном окне при клике на иконку шестерёнки.
**Файлы для проверки**:
- `frontend/src/AppWithProviders.tsx`
- `frontend/src/components/SettingsModal.tsx`
- `frontend/src/components/layout/MainLayout.tsx`

### 2. Раздел "Собеседники" пустой
**Приоритет**: Высокий
**Описание**: Вкладка "Собеседники" не показывает список спикеров.
**Ожидаемое поведение**: Должен отображаться список спикеров с возможностью переименования и прослушивания образцов.
**Файлы для проверки**:
- `frontend/src/components/modules/TranscriptionView.tsx`
- `frontend/src/components/modules/SpeakersTab.tsx`
- Проверить передачу props `speakers` в SpeakersTab

### 3. Версия в справке неправильная (1.39.0)
**Приоритет**: Средний
**Описание**: В модальном окне "О программе" показывается версия 1.39.0 вместо актуальной.
**Решение**: Версия должна формироваться автоматически из package.json. Также добавить просмотр CHANGELOG.
**Файлы для проверки**:
- `frontend/src/components/HelpModal.tsx`
- `frontend/electron/main.ts` (для передачи версии через IPC)

### 4. Отрезки (Chunks) неверно показывают собеседников
**Приоритет**: Высокий
**Описание**: В разделе "Отрезки" все сегменты показываются как "Вы:", нет цветовой подсветки спикеров.
**Ожидаемое поведение**: Каждый спикер должен иметь свой цвет и правильное имя.
**Файлы для проверки**:
- `frontend/src/components/chunks/ChunksViewSimple.tsx`
- `frontend/src/components/chunks/ChunksView.tsx`

### 5. Summary (Сводка) - неправильный цвет подложки и кнопки
**Приоритет**: Средний
**Описание**: Синяя подложка и яркие кнопки не соответствуют общей цветовой схеме (тёмная тема с фиолетовыми акцентами).
**Файлы для проверки**:
- `frontend/src/components/modules/TranscriptionView.tsx` (секция Summary)
- Стили для SummaryTab

### 6. Waveform стал одноканальным
**Приоритет**: Средний
**Описание**: Визуализация аудио показывает один канал вместо двух (mic + sys).
**Ожидаемое поведение**: Двухканальная визуализация с разными цветами для микрофона и системного звука.
**Файлы для проверки**:
- `frontend/src/components/modules/TranscriptionView.tsx`
- `frontend/src/hooks/useWaveform.ts`
- Компонент AudioWaveform

### 7. Пропала индикация уровней громкости (VU meters)
**Приоритет**: Средний
**Описание**: Справа от waveform должны быть VU-метры для каждого канала.
**Файлы для проверки**:
- `frontend/src/components/common/VUMeter.tsx`
- `frontend/src/components/modules/TranscriptionView.tsx`

### 8. Статистика: неправильная длительность и темп речи
**Приоритет**: Высокий
**Описание**: Длительность показывает "377126ч 23м 20с", темп речи "0 сл/мин".
**Причина**: Вероятно, неправильный расчёт или передача данных в SessionStats.
**Файлы для проверки**:
- `frontend/src/components/modules/SessionStats.tsx`
- Проверить формат данных `totalDuration`

---

## План исправлений

### Этап 1: Критические баги
1. [x] Исправить настройки (модальное окно) - заменён SettingsPanel на SettingsModal
2. [x] Исправить раздел "Собеседники" - добавлена загрузка sessionSpeakers через WebSocket
3. [x] Исправить отображение спикеров в "Отрезках" - передаётся sessionSpeakers в TranscriptionView
4. [x] Исправить расчёт статистики - исправлена конвертация наносекунд в секунды

### Этап 2: UI/UX улучшения
5. [x] Исправить версию в справке - добавлена константа APP_VERSION
6. [x] Исправить стили Summary - заменены хардкод цвета на CSS переменные
7. [ ] Восстановить двухканальный waveform - требует отдельной задачи
8. [ ] Восстановить VU-метры - требует отдельной задачи

---

## Выполненные изменения

### MainLayout.tsx
- Заменён `SettingsPanel` на `SettingsModal`
- Добавлено состояние `sessionSpeakers` с загрузкой через WebSocket
- Добавлены обработчики для спикеров: `handleRenameSpeaker`, `handlePlaySpeakerSample`, `handleStopSpeakerSample`
- Добавлена поддержка voiceprints
- Добавлена поддержка diarization
- Исправлена версия в HelpModal (APP_VERSION = '1.41.2')

### TranscriptionView.tsx
- Добавлены пропсы для управления спикерами
- Добавлена вкладка "Собеседники" (SpeakersTab)
- Передаётся `speakersCount` в SessionTabs

### SessionStats.tsx
- Исправлен расчёт длительности: теперь корректно конвертируется из наносекунд
- Исправлен расчёт темпа речи (слов в минуту)

### SummaryView.tsx
- Заменены хардкод цвета (#1a1a2e, #333, #fff) на CSS переменные
- Улучшена консистентность стилей с остальным UI
